name: Crowdin Translation Sync

on:
  schedule:
    - cron: '0 2 * * 1'  # Weekly on Monday at 2 AM UTC
  workflow_dispatch:  # Manual trigger

jobs:
  synchronize-with-crowdin:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18
      
      - name: Setup pnpm
        uses: pnpm/action-setup@v4
        with:
          version: 10
      
      - name: Install dependencies
        working-directory: documentation
        run: pnpm install
      
      - name: Install Crowdin CLI
        run: npm install -g @crowdin/cli
      
      - name: Download translations
        working-directory: documentation
        env:
          CROWDIN_PROJECT_ID: ${{ secrets.CROWDIN_PROJECT_ID }}
          CROWDIN_PERSONAL_TOKEN: ${{ secrets.CROWDIN_PERSONAL_TOKEN }}
        run: |
          if [ -z "$CROWDIN_PROJECT_ID" ] || [ -z "$CROWDIN_PERSONAL_TOKEN" ]; then
            echo "Crowdin credentials not configured. Skipping translation download."
            exit 0
          fi
          crowdin download translations
      
      - name: Commit translations
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: 'chore: update translations from Crowdin'
          file_pattern: 'documentation/docs/* documentation/i18n/*'
          skip_dirty_check: true
