"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[1436],{49477(e,n,s){s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>p,frontMatter:()=>l,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"development/test-scripts","title":"Scripts de test","description":"test-scripts}","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/development/test-scripts.md","sourceDirName":"development","slug":"/development/test-scripts","permalink":"/duplistatus/fr/development/test-scripts","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"translation_last_updated":"2026-03-01T00:45:04.819Z","source_file_mtime":"2026-02-16T00:30:39.430Z","source_file_hash":"6f3df4c1ef3576bd","translation_language":"fr","source_file_path":"development/test-scripts.md"},"sidebar":"mainSidebar","previous":{"title":"Gestion des versions","permalink":"/duplistatus/fr/development/release-management"},"next":{"title":"Scripts et Commandes Admin de l\'Espace de Travail","permalink":"/duplistatus/fr/development/workspace-admin-scripts-commands"}}');var i=s(36259),r=s(73230);const l={translation_last_updated:"2026-03-01T00:45:04.819Z",source_file_mtime:"2026-02-16T00:30:39.430Z",source_file_hash:"6f3df4c1ef3576bd",translation_language:"fr",source_file_path:"development/test-scripts.md"},c="Scripts de test {#test-scripts}",o={},a=[{value:"G\xe9n\xe9rer des donn\xe9es de test",id:"generate-test-data",level:2},{value:"Afficher le contenu des notifications en retard (pour d\xe9boguer le syst\xe8me de notifications)",id:"show-the-overdue-notifications-contents-to-debug-notification-system",level:2},{value:"V\xe9rifier les \xe9l\xe9ments en retard \xe0 une date/heure sp\xe9cifique (pour d\xe9boguer le syst\xe8me de notification)",id:"run-overdue-check-at-a-specific-datetime-to-debug-notification-system",level:2},{value:"Tester la connectivit\xe9 du port du service cron",id:"test-cron-service-port-connectivity",level:2},{value:"Tester la d\xe9tection en retard",id:"test-overdue-detection",level:2},{value:"Valider l&#39;export CSV",id:"validate-csv-export",level:2},{value:"Bloquer temporairement le serveur NTFY (pour les tests)",id:"temporarily-block-ntfy-server-for-testing",level:2},{value:"Test de Migration de Base de Donn\xe9es",id:"database-migration-testing",level:2},{value:"G\xe9n\xe9rer les donn\xe9es de test de migration",id:"generate-migration-test-data",level:3},{value:"Tester les migrations de base de donn\xe9es",id:"test-database-migrations",level:3},{value:"Configurer la configuration de test SMTP",id:"set-smtp-test-configuration",level:2},{value:"Tester la compatibilit\xe9 crois\xe9e du Type de connexion SMTP",id:"test-smtp-connection-type-cross-compatibility",level:2},{value:"Tester le script Docker Entrypoint",id:"test-docker-entrypoint-script",level:2}];function d(e){const n={code:"code",div:"div",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"test-scripts",children:"Scripts de test"})}),"\n",(0,i.jsx)(n.p,{children:"Le projet inclut plusieurs scripts de test pour faciliter le d\xe9veloppement et les tests :"}),"\n",(0,i.jsx)(n.h2,{id:"generate-test-data",children:"G\xe9n\xe9rer des donn\xe9es de test"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pnpm generate-test-data --servers=N\n"})}),"\n",(0,i.jsx)(n.p,{children:"Ce script g\xe9n\xe8re des donn\xe9es de sauvegarde de test pour plusieurs serveurs et sauvegardes."}),"\n",(0,i.jsxs)(n.p,{children:["Le param\xe8tre ",(0,i.jsx)(n.code,{children:"--servers=N"})," est ",(0,i.jsx)(n.strong,{children:"obligatoire"})," et sp\xe9cifie le nombre de serveurs \xe0 g\xe9n\xe9rer (1-30)."]}),"\n",(0,i.jsxs)(n.p,{children:["Utilisez l'option ",(0,i.jsx)(n.code,{children:"--upload"})," pour envoyer les donn\xe9es g\xe9n\xe9r\xe9es vers ",(0,i.jsx)(n.code,{children:"/api/upload"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pnpm generate-test-data --servers=N --upload\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Exemples :"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Generate data for 5 servers\npnpm generate-test-data --servers=5\n\n# Generate data for 1 server with upload mode\npnpm generate-test-data --upload --servers=1\n\n# Generate data for all 30 servers\npnpm generate-test-data --servers=30\n"})}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-caution",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",children:[(0,i.jsx)(n.span,{className:"octicon octicon-caution",style:{"--oct-icon":"url(\"data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' class='octicon octicon-stop mr-2' viewBox='0 0 16 16' version='1.1' width='16' height='16' aria-hidden='true'%3E%3Cpath d='M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z'%3E%3C/path%3E%3C/svg%3E\")"}}),"Caution"]}),"\n",(0,i.jsx)(n.p,{children:"Ce script supprime toutes les donn\xe9es pr\xe9c\xe9dentes de la base de donn\xe9es et les remplace par des donn\xe9es de test.\nSauvegardez votre base de donn\xe9es avant d'ex\xe9cuter ce script."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"show-the-overdue-notifications-contents-to-debug-notification-system",children:"Afficher le contenu des notifications en retard (pour d\xe9boguer le syst\xe8me de notifications)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pnpm show-overdue-notifications\n"})}),"\n",(0,i.jsx)(n.h2,{id:"run-overdue-check-at-a-specific-datetime-to-debug-notification-system",children:"V\xe9rifier les \xe9l\xe9ments en retard \xe0 une date/heure sp\xe9cifique (pour d\xe9boguer le syst\xe8me de notification)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'pnpm run-overdue-check "YYYY-MM-DD HH:MM:SS"\n'})}),"\n",(0,i.jsx)(n.h2,{id:"test-cron-service-port-connectivity",children:"Tester la connectivit\xe9 du port du service cron"}),"\n",(0,i.jsx)(n.p,{children:"Pour tester la connectivit\xe9 du service cron, vous pouvez :"}),"\n",(0,i.jsx)(n.p,{children:"V\xe9rifier si le service cron est en cours d'ex\xe9cution :"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl http://localhost:8667/health\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"Ou utilisez directement les points de terminaison de l'API du service cron via l'application principale :"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl http://localhost:8666/api/cron/health\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"Utilisez le script de test pour v\xe9rifier la connectivit\xe9 du port :"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pnpm test-cron-port\n"})}),"\n",(0,i.jsx)(n.p,{children:"Ce script teste la connectivit\xe9 au port du service cron et fournit des informations d\xe9taill\xe9es sur le statut de la connexion."}),"\n",(0,i.jsx)(n.h2,{id:"test-overdue-detection",children:"Tester la d\xe9tection en retard"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pnpm test-overdue-detection\n"})}),"\n",(0,i.jsx)(n.p,{children:"Ce script teste la logique de d\xe9tection des sauvegardes en retard. Il v\xe9rifie :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"L'identification des sauvegardes en retard"}),"\n",(0,i.jsx)(n.li,{children:"Le d\xe9clenchement des notifications"}),"\n",(0,i.jsx)(n.li,{children:"Les calculs de date/heure pour le statut en retard"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Utile pour d\xe9boguer les syst\xe8mes de d\xe9tection et de notification des sauvegardes en retard."}),"\n",(0,i.jsx)(n.h2,{id:"validate-csv-export",children:"Valider l'export CSV"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pnpm validate-csv-export\n"})}),"\n",(0,i.jsx)(n.p,{children:"Ce script valide la fonctionnalit\xe9 d'exportation CSV. Il :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Teste la g\xe9n\xe9ration d'exportation CSV"}),"\n",(0,i.jsx)(n.li,{children:"V\xe9rifie le format et la structure des donn\xe9es"}),"\n",(0,i.jsx)(n.li,{children:"Contr\xf4le l'int\xe9grit\xe9 des donn\xe9es dans les fichiers export\xe9s"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Utile pour s'assurer que les exports CSV fonctionnent correctement avant les versions."}),"\n",(0,i.jsx)(n.h2,{id:"temporarily-block-ntfy-server-for-testing",children:"Bloquer temporairement le serveur NTFY (pour les tests)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo ./scripts/temporary_ntfy.sh_block.sh\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Ce script bloque temporairement l'acc\xe8s r\xe9seau sortant vers le serveur NTFY (",(0,i.jsx)(n.code,{children:"ntfy.sh"}),") pour tester le m\xe9canisme de r\xe9essayer de notification. Il :"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"R\xe9sout l'adresse IP du serveur NTFY"}),"\n",(0,i.jsx)(n.li,{children:"Ajoute une r\xe8gle iptables pour bloquer le trafic sortant"}),"\n",(0,i.jsx)(n.li,{children:"Bloque pendant 10 secondes (configurable)"}),"\n",(0,i.jsx)(n.li,{children:"Supprime automatiquement la r\xe8gle de blocage \xe0 la sortie"}),"\n",(0,i.jsx)(n.li,{children:"N\xe9cessite les privil\xe8ges root (sudo)"}),"\n"]}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-caution",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",children:[(0,i.jsx)(n.span,{className:"octicon octicon-caution",style:{"--oct-icon":"url(\"data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' class='octicon octicon-stop mr-2' viewBox='0 0 16 16' version='1.1' width='16' height='16' aria-hidden='true'%3E%3Cpath d='M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z'%3E%3C/path%3E%3C/svg%3E\")"}}),"Caution"]}),"\n",(0,i.jsx)(n.p,{children:"Ce script modifie les r\xe8gles iptables et n\xe9cessite les privil\xe8ges root. \xc0 utiliser uniquement pour tester les m\xe9canismes de r\xe9essai de notification."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"database-migration-testing",children:"Test de Migration de Base de Donn\xe9es"}),"\n",(0,i.jsx)(n.p,{children:"Le projet inclut des scripts pour tester les migrations de base de donn\xe9es \xe0 partir de versions ant\xe9rieures vers la version actuelle. Ces scripts garantissent que les migrations de base de donn\xe9es fonctionnent correctement et pr\xe9servent l'int\xe9grit\xe9 des donn\xe9es."}),"\n",(0,i.jsx)(n.h3,{id:"generate-migration-test-data",children:"G\xe9n\xe9rer les donn\xe9es de test de migration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./scripts/generate-migration-test-data.sh\n"})}),"\n",(0,i.jsx)(n.p,{children:"Ce script g\xe9n\xe8re des bases de donn\xe9es de test pour plusieurs versions historiques de l'application. Il :"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Arr\xeate et supprime"})," tout conteneur Docker existant"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Pour chaque version"})," (v0.4.0, v0.5.0, v0.6.1, 0.7.27, 0.8.21) :","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Supprime les fichiers de base de donn\xe9es existants"}),"\n",(0,i.jsx)(n.li,{children:"Cr\xe9e un fichier d'\xe9tiquette de version"}),"\n",(0,i.jsx)(n.li,{children:"D\xe9marre un conteneur Docker avec la version sp\xe9cifique"}),"\n",(0,i.jsx)(n.li,{children:"Attend que le conteneur soit pr\xeat"}),"\n",(0,i.jsxs)(n.li,{children:["G\xe9n\xe8re des donn\xe9es de test \xe0 l'aide de ",(0,i.jsx)(n.code,{children:"pnpm generate-test-data"})]}),"\n",(0,i.jsx)(n.li,{children:"Prend une capture d'\xe9cran de l'interface utilisateur avec les donn\xe9es de test"}),"\n",(0,i.jsx)(n.li,{children:"Arr\xeate et supprime le conteneur"}),"\n",(0,i.jsx)(n.li,{children:"Vide les fichiers WAL et enregistre le sch\xe9ma de la base de donn\xe9es"}),"\n",(0,i.jsxs)(n.li,{children:["Copie le fichier de base de donn\xe9es vers ",(0,i.jsx)(n.code,{children:"scripts/migration_test_data/"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Exigences :"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Docker doit \xeatre install\xe9 et configur\xe9"}),"\n",(0,i.jsx)(n.li,{children:"Google Chrome (via Puppeteer) doit \xeatre install\xe9"}),"\n",(0,i.jsx)(n.li,{children:"Acc\xe8s root/sudo pour les op\xe9rations Docker"}),"\n",(0,i.jsxs)(n.li,{children:["Le volume Docker ",(0,i.jsx)(n.code,{children:"duplistatus_data"})," doit exister"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"R\xe9sultat :"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Fichiers de base de donn\xe9es : ",(0,i.jsx)(n.code,{children:"scripts/migration_test_data/backups_<VERSION>.db"})]}),"\n",(0,i.jsxs)(n.li,{children:["Fichiers de sch\xe9ma : ",(0,i.jsx)(n.code,{children:"scripts/migration_test_data/backups_<VERSION>.schema"})]}),"\n",(0,i.jsxs)(n.li,{children:["Captures d'\xe9cran : ",(0,i.jsx)(n.code,{children:"scripts/migration_test_data/duplistatus_test_data_<VERSION>.png"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Configuration :"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Nombre de serveurs : D\xe9fini via la variable ",(0,i.jsx)(n.code,{children:"SERVERS"})," (par d\xe9faut : 3)"]}),"\n",(0,i.jsxs)(n.li,{children:["R\xe9pertoire de donn\xe9es : ",(0,i.jsx)(n.code,{children:"/var/lib/docker/volumes/duplistatus_data/_data"})]}),"\n",(0,i.jsx)(n.li,{children:"Port : 9666 (port du conteneur Docker)"}),"\n"]}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-caution",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",children:[(0,i.jsx)(n.span,{className:"octicon octicon-caution",style:{"--oct-icon":"url(\"data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' class='octicon octicon-stop mr-2' viewBox='0 0 16 16' version='1.1' width='16' height='16' aria-hidden='true'%3E%3Cpath d='M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z'%3E%3C/path%3E%3C/svg%3E\")"}}),"Caution"]}),"\n",(0,i.jsxs)(n.p,{children:["Ce script n\xe9cessite Docker et arr\xeatera/supprimera les conteneurs existants. Il n\xe9cessite \xe9galement un acc\xe8s sudo pour les op\xe9rations Docker et l'acc\xe8s au syst\xe8me de fichiers. Vous devez d'abord ex\xe9cuter le script ",(0,i.jsx)(n.code,{children:"pnpm take-screenshots"})," pour installer Google Chrome si vous ne l'avez pas d\xe9j\xe0 fait."]}),"\n"]}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-important",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",children:[(0,i.jsx)(n.span,{className:"octicon octicon-important",style:{"--oct-icon":"url(\"data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' class='octicon octicon-report mr-2' viewBox='0 0 16 16' version='1.1' width='16' height='16' aria-hidden='true'%3E%3Cpath d='M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z'%3E%3C/path%3E%3C/svg%3E\")"}}),"Important"]}),"\n",(0,i.jsxs)(n.p,{children:["Ce script \xe9tait cens\xe9 s'ex\xe9cuter une seule fois. Pour les nouvelles versions, le d\xe9veloppeur peut copier le fichier de base de donn\xe9es et les captures d'\xe9cran directement dans le r\xe9pertoire ",(0,i.jsx)(n.code,{children:"scripts/migration_test_data/"}),". Pendant le d\xe9veloppement, ex\xe9cutez simplement le script ",(0,i.jsx)(n.code,{children:"./scripts/test-migrations.sh"})," pour tester les migrations."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"test-database-migrations",children:"Tester les migrations de base de donn\xe9es"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./scripts/test-migrations.sh\n"})}),"\n",(0,i.jsx)(n.p,{children:"Ce script teste les migrations de base de donn\xe9es \xe0 partir des anciennes versions vers la version actuelle (4.0). Il :"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Pour chaque version"})," (v0.4.0, v0.5.0, v0.6.1, 0.7.27, 0.8.21):","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Cr\xe9e une copie temporaire de la base de donn\xe9es de test"}),"\n",(0,i.jsxs)(n.li,{children:["Ex\xe9cute le processus de migration en utilisant ",(0,i.jsx)(n.code,{children:"test-migration.ts"})]}),"\n",(0,i.jsx)(n.li,{children:"Valide la structure de la base de donn\xe9es migr\xe9e"}),"\n",(0,i.jsx)(n.li,{children:"V\xe9rifie la pr\xe9sence des tables et colonnes requises"}),"\n",(0,i.jsx)(n.li,{children:"Confirme que la version de la base de donn\xe9es est 4.0"}),"\n",(0,i.jsx)(n.li,{children:"Nettoie les fichiers temporaires"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Exigences :"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Les bases de donn\xe9es de test doivent exister dans ",(0,i.jsx)(n.code,{children:"scripts/migration_test_data/"})]}),"\n",(0,i.jsxs)(n.li,{children:["G\xe9n\xe9r\xe9es en ex\xe9cutant d'abord ",(0,i.jsx)(n.code,{children:"generate-migration-test-data.sh"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"R\xe9sultat :"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"R\xe9sultats de test cod\xe9s par couleur (vert pour r\xe9ussite, rouge pour \xe9chec)"}),"\n",(0,i.jsx)(n.li,{children:"R\xe9sum\xe9 des versions r\xe9ussies et \xe9chou\xe9es"}),"\n",(0,i.jsx)(n.li,{children:"Messages d'erreur d\xe9taill\xe9s pour les migrations \xe9chou\xe9es"}),"\n",(0,i.jsx)(n.li,{children:"Code de sortie 0 si tous les tests r\xe9ussissent, 1 si l'un d'eux \xe9choue"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Ce qu'il valide :"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"La version de la base de donn\xe9es est 4.0 apr\xe8s la migration"}),"\n",(0,i.jsxs)(n.li,{children:["Tous les tableaux requis existent : ",(0,i.jsx)(n.code,{children:"servers"}),", ",(0,i.jsx)(n.code,{children:"backups"}),", ",(0,i.jsx)(n.code,{children:"configurations"}),", ",(0,i.jsx)(n.code,{children:"users"}),", ",(0,i.jsx)(n.code,{children:"sessions"}),", ",(0,i.jsx)(n.code,{children:"audit_log"}),", ",(0,i.jsx)(n.code,{children:"db_version"})]}),"\n",(0,i.jsx)(n.li,{children:"Les colonnes requises existent dans chaque tableau"}),"\n",(0,i.jsx)(n.li,{children:"La structure de la base de donn\xe9es est correcte"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Exemple de sortie :"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"==========================================\nDatabase Migration Test Suite\n==========================================\n\nTesting migrations from old versions to version 4.0\nTest data directory: /path/to/migration_test_data\nTemporary directory: /path/to/migration_test_data/.tmp\n\n----------------------------------------\nTesting version: v0.4.0\n----------------------------------------\n  Copying database file to temporary location...\n  Running migration test...\n\u2705 Version v0.4.0: Migration test PASSED\n\n==========================================\nTest Summary\n==========================================\n\n\u2705 Passed versions (5):\n  \u2713 v0.4.0\n  \u2713 v0.5.0\n  \u2713 v0.6.1\n  \u2713 0.7.27\n  \u2713 0.8.21\n\nAll migration tests passed!\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Utilisation :"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Run all migration tests\n./scripts/test-migrations.sh\n\n# Check exit code\necho $?  # 0 = all passed, 1 = some failed\n"})}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-note",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",children:[(0,i.jsx)(n.span,{className:"octicon octicon-note",style:{"--oct-icon":"url(\"data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' class='octicon octicon-info mr-2' viewBox='0 0 16 16' version='1.1' width='16' height='16' aria-hidden='true'%3E%3Cpath d='M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z'%3E%3C/path%3E%3C/svg%3E\")"}}),"Note"]}),"\n",(0,i.jsxs)(n.p,{children:["Ce script utilise en interne le script de test de migration TypeScript (",(0,i.jsx)(n.code,{children:"test-migration.ts"}),"). Le script de test valide la structure de la base de donn\xe9es apr\xe8s la migration et garantit l'int\xe9grit\xe9 des donn\xe9es."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"set-smtp-test-configuration",children:"Configurer la configuration de test SMTP"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pnpm set-smtp-test-config <connectionType>\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Ce script configure les param\xe8tres de test SMTP \xe0 partir de variables d'environnement. Il accepte un param\xe8tre ",(0,i.jsx)(n.code,{children:"connectionType"})," (",(0,i.jsx)(n.code,{children:"plain"}),", ",(0,i.jsx)(n.code,{children:"starttls"})," ou ",(0,i.jsx)(n.code,{children:"ssl"}),") et lit les variables d'environnement correspondantes avec des pr\xe9fixes (",(0,i.jsx)(n.code,{children:"PLAIN_"}),", ",(0,i.jsx)(n.code,{children:"STARTTLS_"}),", ",(0,i.jsx)(n.code,{children:"SSL_"}),") pour mettre \xe0 jour la configuration SMTP dans la base de donn\xe9es."]}),"\n",(0,i.jsxs)(n.p,{children:["Pour les connexions simples, le script lit la variable d'environnement ",(0,i.jsx)(n.code,{children:"PLAIN_SMTP_FROM"})," pour d\xe9finir l'Adresse d'exp\xe9diteur requise. Cela facilite le test de diff\xe9rents types de connexion SMTP sans mises \xe0 jour manuelles de la base de donn\xe9es."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Utilisation :"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Set Plain SMTP configuration\nPLAIN_SMTP_HOST=smtp.example.com \\\nPLAIN_SMTP_PORT=25 \\\nPLAIN_SMTP_FROM=noreply@example.com \\\npnpm set-smtp-test-config plain\n\n# Set STARTTLS configuration\nSTARTTLS_SMTP_HOST=smtp.example.com \\\nSTARTTLS_SMTP_PORT=587 \\\nSTARTTLS_SMTP_USERNAME=user@example.com \\\nSTARTTLS_SMTP_PASSWORD=password \\\npnpm set-smtp-test-config starttls\n\n# Set Direct SSL/TLS configuration\nSSL_SMTP_HOST=smtp.example.com \\\nSSL_SMTP_PORT=465 \\\nSSL_SMTP_USERNAME=user@example.com \\\nSSL_SMTP_PASSWORD=password \\\npnpm set-smtp-test-config ssl\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Exigences :"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"L'application doit \xeatre en cours d'ex\xe9cution"}),"\n",(0,i.jsx)(n.li,{children:"Les variables d'environnement doivent \xeatre d\xe9finies avec le pr\xe9fixe appropri\xe9 pour le type de connexion"}),"\n",(0,i.jsxs)(n.li,{children:["Pour les connexions en clair, ",(0,i.jsx)(n.code,{children:"PLAIN_SMTP_FROM"})," est requis"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"test-smtp-connection-type-cross-compatibility",children:"Tester la compatibilit\xe9 crois\xe9e du Type de connexion SMTP"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pnpm test-smtp-connections\n"})}),"\n",(0,i.jsx)(n.p,{children:"Ce script effectue un test matriciel complet 3x3 qui valide si les configurations destin\xe9es \xe0 un type de connexion fonctionnent correctement avec diff\xe9rents types de connexion. Pour chaque type de configuration de base (plain, starttls, ssl), le script :"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Lit les variables d'environnement avec les pr\xe9fixes correspondants (",(0,i.jsx)(n.code,{children:"PLAIN_*"}),", ",(0,i.jsx)(n.code,{children:"STARTTLS_*"}),", ",(0,i.jsx)(n.code,{children:"SSL_*"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["Teste les trois types de connexion en modifiant uniquement le champ ",(0,i.jsx)(n.code,{children:"connectionType"})]}),"\n",(0,i.jsx)(n.li,{children:"Envoie des e-mails de test via l'API"}),"\n",(0,i.jsx)(n.li,{children:"Enregistre les r\xe9sultats dans un format matriciel"}),"\n",(0,i.jsx)(n.li,{children:"Affiche un tableau r\xe9capitulatif"}),"\n",(0,i.jsxs)(n.li,{children:["Enregistre les r\xe9sultats d\xe9taill\xe9s dans ",(0,i.jsx)(n.code,{children:"smtp-test-results.json"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Utilisation :"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Set environment variables for all three connection types\nPLAIN_SMTP_HOST=smtp.example.com \\\nPLAIN_SMTP_PORT=25 \\\nPLAIN_SMTP_FROM=noreply@example.com \\\nSTARTTLS_SMTP_HOST=smtp.example.com \\\nSTARTTLS_SMTP_PORT=587 \\\nSTARTTLS_SMTP_USERNAME=user@example.com \\\nSTARTTLS_SMTP_PASSWORD=password \\\nSSL_SMTP_HOST=smtp.example.com \\\nSSL_SMTP_PORT=465 \\\nSSL_SMTP_USERNAME=user@example.com \\\nSSL_SMTP_PASSWORD=password \\\npnpm test-smtp-connections\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Exigences :"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"L'application doit \xeatre en cours d'ex\xe9cution"}),"\n",(0,i.jsx)(n.li,{children:"Les variables d'environnement doivent \xeatre d\xe9finies pour les trois types de connexion"}),"\n",(0,i.jsx)(n.li,{children:"Le script valide la configuration utilis\xe9e par le biais d'une journalisation d\xe9taill\xe9e"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Comportement attendu :"}),"\nLes configurations ne doivent fonctionner qu'avec leur type de connexion pr\xe9vu (par exemple, la configuration simple fonctionne avec le type de connexion simple mais \xe9choue avec STARTTLS/SSL)."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"R\xe9sultat :"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Sortie console avec un tableau r\xe9capitulatif montrant les r\xe9sultats des tests"}),"\n",(0,i.jsxs)(n.li,{children:["Fichier ",(0,i.jsx)(n.code,{children:"smtp-test-results.json"})," avec les r\xe9sultats d\xe9taill\xe9s des tests pour chaque combinaison de configuration et de type de connexion"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"test-docker-entrypoint-script",children:"Tester le script Docker Entrypoint"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pnpm test-entrypoint\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Ce script fournit un wrapper de test pour ",(0,i.jsx)(n.code,{children:"docker-entrypoint.sh"})," en d\xe9veloppement local. Il configure l'environnement pour tester la fonctionnalit\xe9 de journalisation du point d'entr\xe9e et garantit que les journaux sont \xe9crits dans ",(0,i.jsx)(n.code,{children:"data/logs/"})," afin que l'application puisse y acc\xe9der."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Ce qu'il fait :"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cr\xe9e toujours une version r\xe9cente"})," : Ex\xe9cute automatiquement ",(0,i.jsx)(n.code,{children:"pnpm build-local"})," pour cr\xe9er une version r\xe9cente avant les tests (pas besoin de compiler manuellement en premier)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Compile le service cron"})," : Assure que le service cron est compil\xe9 (",(0,i.jsx)(n.code,{children:"dist/cron-service.cjs"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Configure une structure de type Docker"})," : Cr\xe9e les liens symboliques et la structure de r\xe9pertoires n\xe9cessaires pour imiter l'environnement Docker"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Ex\xe9cute le script de point d'entr\xe9e"})," : Lance ",(0,i.jsx)(n.code,{children:"docker-entrypoint.sh"})," avec les variables d'environnement appropri\xe9es"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Nettoie"})," : Supprime automatiquement les fichiers temporaires \xe0 la fermeture"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Utilisation :"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Run the test (builds fresh version automatically)\npnpm test-entrypoint\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Variables d'environnement :"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"PORT=8666"})," - Port pour le serveur Next.js (correspond \xe0 ",(0,i.jsx)(n.code,{children:"start-local"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"CRON_PORT=8667"})," - Port pour le service cron"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"VERSION"})," - D\xe9fini automatiquement au format ",(0,i.jsx)(n.code,{children:"test-YYYYMMDD-HHMMSS"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"R\xe9sultat :"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Les journaux sont \xe9crits dans ",(0,i.jsx)(n.code,{children:"data/logs/application.log"})," (accessible par l'application)"]}),"\n",(0,i.jsx)(n.li,{children:"La sortie console affiche l'ex\xe9cution du script de point d'entr\xe9e"}),"\n",(0,i.jsx)(n.li,{children:"Appuyez sur Ctrl+C pour arr\xeater et tester le vidage des journaux"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Exigences :"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Le script doit \xeatre ex\xe9cut\xe9 \xe0 partir du r\xe9pertoire racine du d\xe9p\xf4t (pnpm g\xe8re cela automatiquement)"}),"\n",(0,i.jsx)(n.li,{children:"Le script g\xe8re automatiquement tous les pr\xe9requis (build, service cron, etc.)"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Cas d'utilisation :"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Tester les modifications du script de point d'entr\xe9e localement avant le d\xe9ploiement Docker"}),"\n",(0,i.jsx)(n.li,{children:"V\xe9rifier la rotation des journaux et la fonctionnalit\xe9 de journalisation"}),"\n",(0,i.jsx)(n.li,{children:"Tester l'arr\xeat gracieux et la gestion des signaux"}),"\n",(0,i.jsx)(n.li,{children:"D\xe9boguer le comportement du script de point d'entr\xe9e dans un environnement local"}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},73230(e,n,s){s.d(n,{R:()=>l,x:()=>c});var t=s(71299);const i={},r=t.createContext(i);function l(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);