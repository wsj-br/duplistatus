# Versi贸n 1.2.1 {#version-121}

## resumen {#overview}

Versi贸n 1.2.1 es una versi贸n menor que introduce mejoras significativas en la gesti贸n de notificaciones de backup, mejora las capacidades de registro de auditor铆a, corrige la detecci贸n de pr贸xima ejecuci贸n/retrasado en casos extremos y a帽ade funcionalidad de backup y restauraci贸n de base de datos. Esta versi贸n se enfoca en mejorar la experiencia del usuario con la configuraci贸n de notificaciones.

## Nuevas caracter铆sticas {#new-features}

### Gesti贸n mejorada de notificaciones de backup {#enhanced-backup-notifications-management}

- **Valores predeterminados a nivel de servidor y sistema de herencia**: Configurar destinos adicionales predeterminados (eventos de notificaci贸n, correos electr贸nicos y temas NTFY) a nivel de servidor que todos los backups heredan autom谩ticamente. Los backups pueden anular estos valores predeterminados cuando sea necesario, con indicadores visuales claros que muestren el estado de herencia.
- **Jerarqu铆a visual mejorada**: Los backups ahora se agrupan por servidor con filas de encabezado de servidor distintas. Los valores heredados est谩n claramente marcados con iconos de enlace, y los valores anulados se pueden revertir f谩cilmente a la herencia.
- **Operaciones masivas**: El bot贸n "Sincronizar a todos" limpia todos los anulados de backup para que todos los backups hereden de los valores predeterminados del servidor. El bot贸n "Limpiar todo" limpia todos los destinos adicionales mientras mantiene la estructura de herencia.
- **Funcionalidad de prueba**: Se a帽adieron botones de prueba de correo electr贸nico y prueba de notificaci贸n directamente en la p谩gina de configuraci贸n de notificaciones de backup. Los botones de prueba est谩n disponibles tanto para la configuraci贸n individual de backup como para operaciones de edici贸n masiva, permiti茅ndole verificar la entrega de notificaciones antes de aplicar cambios.
- **Soporte de c贸digo QR**: Se a帽adi贸 bot贸n de c贸digo QR para temas NTFY para compartir f谩cilmente temas de notificaci贸n con dispositivos m贸viles.

### Mejoras en plantillas de notificaci贸n {#notification-template-enhancements}

- **Nueva variable `{log_text}`**: Se a帽adi贸 la variable `{log_text}` a las plantillas de notificaci贸n, proporcionando acceso a mensajes de texto de registro para usar en mensajes de notificaci贸n. La variable contiene el texto completo de advertencias y errores combinados, formateado como texto sin formato con un elemento por l铆nea.
- **Migraci贸n autom谩tica de plantillas**: El sistema incluye un mecanismo de actualizaci贸n perezosa que detecta y actualiza autom谩ticamente las plantillas predeterminadas antiguas cuando se leen por primera vez despu茅s de una actualizaci贸n. Las plantillas personalizadas se conservan sin cambios.

### Gesti贸n de base de datos {#database-management}

- **Funcionalidad de backup de base de datos**: Los administradores ahora pueden crear backups de toda la base de datos desde la p谩gina de configuraci贸n de mantenimiento de base de datos. Admite formatos binarios (.db) y SQL de texto (.sql) para flexibilidad.
- **Funcionalidad de restauraci贸n de base de datos**: Restaurar la base de datos desde archivos de backup creados anteriormente con creaci贸n autom谩tica de backup de seguridad, validaci贸n de integridad y reversi贸n en caso de fallo. Todas las sesiones se limpian despu茅s de la restauraci贸n por seguridad.

### Detecci贸n de clave maestra {#master-key-detection}

- **Detecci贸n autom谩tica de cambio de clave maestra**: Despu茅s de iniciar sesi贸n, el sistema verifica autom谩ticamente si el archivo `.duplistatus.key` ha cambiado. Si se detecta, todas las contrase帽as cifradas se limpian y un cuadro de di谩logo modal informa a los usuarios que las contrase帽as deben reconfigurarse. Esto previene errores al restaurar desde backups o migrar a un nuevo sistema.

### Mejoras en monitoreo de backups retrasados {#overdue-monitoring-improvements}

- **Exportaci贸n CSV mejorada**: Se a帽adi贸 la columna "Marca de tiempo del 煤ltimo backup (BD)" al archivo CSV generado por el bot贸n "Descargar CSV" en la configuraci贸n de monitoreo de backups retrasados. Esto permite a los usuarios comparar la marca de tiempo real del 煤ltimo backup de la base de datos con la marca de tiempo "ltimo backup" configurada.
- **Informaci贸n sobre pr贸xima ejecuci贸n**: Al pasar el rat贸n sobre el valor "Pr贸xima ejecuci贸n" en cada fila ahora se muestra una informaci贸n sobre herramientas que muestra la marca de tiempo del 煤ltimo backup de la base de datos, formateada de la misma manera que la pantalla "Pr贸xima ejecuci贸n".

### Mejoras en registro de auditor铆a {#audit-logging-enhancements}

- **Entradas de auditor铆a de notificaci贸n individual**: Cada notificaci贸n y correo electr贸nico enviado ahora genera una entrada de registro de auditor铆a separada con detalles sobre el canal, configuraci贸n y resultado (茅xito o fallo). Esto incluye notificaciones de prueba, proporcionando mejor trazabilidad para la entrega de notificaciones.
- **Registro de fallos robusto**: Todas las operaciones de registro de auditor铆a para fallos de notificaci贸n ahora est谩n envueltas en bloques try-catch para evitar que los errores de registro de auditor铆a rompan los flujos de notificaci贸n. El sistema intenta recuperar la configuraci贸n SMTP si no est谩 disponible inmediatamente al registrar fallos de correo electr贸nico.
- **Registro de auditor铆a mejorado para actualizaciones de configuraci贸n**: Las entradas de registro de auditor铆a `email_config_updated` y `ntfy_config_updated` ahora solo se registran cuando hay cambios reales en la configuraci贸n. Cuando se detectan cambios, el registro de auditor铆a incluye valores antiguos y nuevos para cada campo modificado, facilitando el seguimiento de lo que cambi贸 espec铆ficamente.

### Mejoras en documentaci贸n {#documentation-improvements}

- El estilo de documentaci贸n se ha actualizado para alinearse con la apariencia de la aplicaci贸n. La barra lateral tambi茅n ha sido revisada para mejorar la visibilidad y facilitar la navegaci贸n.

---

##  Correcciones de errores {#bug-fixes}

- **Marcas de tiempo de registro de auditor铆a corregidas**: Las marcas de tiempo en el visor de registro de auditor铆a ahora se muestran correctamente en la zona horaria del navegador del usuario en lugar de GMT. Las marcas de tiempo de SQLite (almacenadas en UTC) ahora se analizan correctamente como UTC y se convierten a la zona horaria local del navegador para su visualizaci贸n.
- **C谩lculo de "Pr贸xima ejecuci贸n" corregido y detecci贸n de retrasado**: La columna "Pr贸xima ejecuci贸n" en la configuraci贸n de monitoreo de backups retrasados ahora calcula y muestra con precisi贸n la pr贸xima fecha de backup esperada, teniendo en cuenta tanto la programaci贸n de backup como la marca de tiempo del 煤ltimo backup. Esto se aplica tanto a trabajos de backup programados como ejecutados manualmente, lo que resulta en una detecci贸n de retrasado m谩s confiable.

---

##  Notas de migraci贸n {#migration-notes}

### Desde versi贸n 1.1.x {#from-version-11x}

Al actualizar a la versi贸n 1.2.1:

1. **Plantillas de notificaci贸n**: El sistema actualizar谩 autom谩ticamente las plantillas de notificaci贸n predeterminadas para incluir la nueva variable `{log_text}` la primera vez que se acceda despu茅s de actualizar. Las plantillas personalizadas permanecer谩n sin cambios. Si desea utilizar la nueva variable `{log_text}` en sus propias plantillas, deber谩 actualizarlas o restaurar las plantillas predeterminadas manualmente.

2. **Cambios de clave maestra**: Si restaura desde un backup o migra a un nuevo sistema con un archivo `.duplistatus.key` diferente, el sistema detectar谩 autom谩ticamente esto y le pedir谩 que reconfigure las contrase帽as cifradas (contrase帽as SMTP y contrase帽as del servidor Duplicati).

3. **Backup/Restauraci贸n de base de datos**: La nueva funcionalidad de backup y restauraci贸n de base de datos est谩 disponible en la p谩gina de configuraci贸n de mantenimiento de base de datos. Se recomienda crear un backup antes de actualizar, aunque no se requieren cambios de esquema de base de datos para esta versi贸n.

4. **Sin migraci贸n de base de datos requerida**: Esta versi贸n no requiere cambios de esquema de base de datos.

---

## Puntos finales de API {#api-endpoints}

Los siguientes puntos finales de API se han introducido en esta versi贸n.

### Puntos finales de autenticaci贸n y seguridad {#authentication-security-endpoints}

- `GET /api/auth/admin-must-change-password` - Verificar si el usuario administrador debe cambiar la contrase帽a

### Puntos finales de gesti贸n de base de datos {#database-management-endpoints}

- `GET /api/database/backup` - Crear backup de base de datos (formato binario o SQL)
- `POST /api/database/restore` - Restaurar base de datos desde archivo de backup

### Puntos finales de gesti贸n de backup {#backup-management-endpoints}

- `GET /api/backups/last-timestamps` - Obtener marcas de tiempo del 煤ltimo backup para todas las combinaciones de servidor-backup

---

## Soporte {#support}

### Obtener ayuda {#getting-help}

- **Documentaci贸n**: [Gu铆a del usuario](../user-guide/overview.md)
- **Configuraci贸n de correo electr贸nico**: [Gu铆a de configuraci贸n de correo electr贸nico](../user-guide/settings/email-settings.md)
- **Referencia de API**: [Documentaci贸n de API](../api-reference/overview.md)
- **Gu铆a de migraci贸n**: [Migraci贸n de actualizaci贸n de versi贸n](../migration/version_upgrade.md)
- **Comunidad**: [Discusiones de GitHub](https://github.com/wsj-br/duplistatus/discussions)
- **Problemas**: [Problemas de GitHub](https://github.com/wsj-br/duplistatus/issues)

### Reportar errores {#reporting-bugs}

Al reportar errores, incluya:

- Versi贸n: 1.2.1
- Sistema operativo y versi贸n
- Versi贸n de Docker/podman
- Tipo de contenedor (Docker o podman/Pod)
- Mensajes de error y logs
- Pasos para reproducir

---

## Registro de cambios {#changelog}

### Cambios de versi贸n 1.2.1 {#version-121-changes}

- **A帽adido**: Sistema de valores predeterminados a nivel de servidor e herencia para notificaciones de backup
- **A帽adido**: Funcionalidad de prueba de correo electr贸nico y prueba de notificaci贸n en la configuraci贸n de notificaciones de backup
- **A帽adido**: Bot贸n de c贸digo QR para temas NTFY
- **A帽adido**: Columna "Marca de tiempo del 煤ltimo backup (BD)" para exportaci贸n CSV de monitoreo de backups retrasados
- **A帽adido**: Informaci贸n sobre herramientas para el texto "Pr贸xima ejecuci贸n" en la configuraci贸n de monitoreo de backups retrasados
- **A帽adido**: Entradas de registro de auditor铆a individual para cada notificaci贸n y correo electr贸nico enviado
- **A帽adido**: Robustez mejorada de registro de auditor铆a para fallos de notificaci贸n
- **A帽adido**: Variable `{log_text}` para plantillas de notificaci贸n con migraci贸n autom谩tica de plantillas
- **A帽adido**: Detecci贸n autom谩tica de cambios de archivo de clave maestra
- **A帽adido**: Funcionalidad de backup de base de datos (formatos binario y SQL)
- **A帽adido**: Funcionalidad de restauraci贸n de base de datos con backups de seguridad y validaci贸n de integridad
- **A帽adido**: Punto final de API `GET /api/auth/admin-must-change-password` para verificar el requisito de cambio de contrase帽a de administrador
- **A帽adido**: Punto final de API `GET /api/database/backup` para crear backups de base de datos
- **A帽adido**: Punto final de API `POST /api/database/restore` para restaurar base de datos desde backup
- **A帽adido**: Punto final de API `GET /api/backups/last-timestamps` para recuperar marcas de tiempo del 煤ltimo backup
- **Modificado**: Registro de auditor铆a mejorado para actualizaciones de configuraci贸n de correo electr贸nico y NTFY (solo registra cambios reales)
- **Modificado**: Los formularios de cambio de contrase帽a ya no requieren confirmaci贸n al mostrar contrase帽as sin enmascarar.
- **Modificado**: Las contrase帽as se limpian de forma segura de la memoria cuando se cierran los formularios de cambio de contrase帽a.
- **Modificado**: Se incluy贸 un bot贸n de alternancia de vista de contrase帽a en el formulario de recopilaci贸n de backups.
- **Modificado**: La variable `{server_alias}` ahora muestra el nombre del servidor entre corchetes
- **Modificado**: Documentaci贸n actualizada, estilo alineado con la aplicaci贸n y barra lateral refactorizada.
- **Corregido**: Marcas de tiempo de registro de auditor铆a mostr谩ndose en GMT en lugar de zona horaria del navegador
- **Corregido**: Registro de auditor铆a de fallos de correo electr贸nico y NTFY
- **Corregido**: Pantalla "Pr贸xima ejecuci贸n" en la configuraci贸n de monitoreo de backups retrasados mostrando fechas incorrectas

---

## Licencia {#license}

Este proyecto est谩 licenciado bajo la [Licencia Apache 2.0](https://github.com/wsj-br/duplistatus/blob/main/LICENSE).

**Derechos de autor 漏 2025 Waldemar Scudeller Jr.**
