# Versi√≥n 0.9.x {#version-09x}

## resumen {#overview}

Versi√≥n 0.9.x es una versi√≥n importante que introduce un **Sistema integral de Control de Acceso de Usuarios y Seguridad**. Esta versi√≥n transforma **duplistatus** de una aplicaci√≥n de acceso abierto a un sistema seguro y multiusuario con control de acceso basado en roles, registro de auditor√≠a integral y caracter√≠sticas de Seguridad de nivel empresarial. Toda la funcionalidad existente ahora est√° protegida detr√°s de autenticaci√≥n, asegurando que solo los Usuarios autorizados puedan acceder y gestionar el monitoreo de backup.

## Cambios importantes {#breaking-changes}

### Autenticaci√≥n requerida {#authentication-required}

- **Todas las P√°ginas ahora requieren autenticaci√≥n** - Los Usuarios deben Iniciar sesi√≥n para acceder a la aplicaci√≥n
- **Cuenta de admin Por defecto** se crea autom√°ticamente:
  - Nombre de usuario: `admin`
  - Contrase√±a: `Duplistatus09` (debe cambiarse en el primer Iniciar sesi√≥n)
- **Las sesiones existentes se invalidan** - Todos los Usuarios deben Iniciar sesi√≥n despu√©s de la actualizaci√≥n
- **Los puntos finales de API Ahora requieren autenticaci√≥n** - Las Integraciones externas deben incluir cookies de sesi√≥n o usar solicitudes autenticadas

:::warning
**Todos los Usuarios deben Iniciar sesi√≥n despu√©s de actualizar a la versi√≥n 0.9.x.** Las credenciales de admin Por defecto son admin/Duplistatus09. Cambie la Contrase√±a inmediatamente despu√©s del primer Iniciar sesi√≥n.
:::

### Migraci√≥n de esquema de base de datos {#database-schema-migration}

- **Migraci√≥n autom√°tica de v3.1 a v4.0** para instalaciones existentes
- **Nuevas tablas a√±adidas**: `users`, `sessions`, `audit_log`
- **Backup de base de datos creado autom√°ticamente** antes de la migraci√≥n
- **Nuevas instalaciones** comienzan directamente con esquema v4.0 (no se necesita migraci√≥n)

## Nuevas caracter√≠sticas {#new-features}

### Sistema de Control de Acceso de Usuarios y Seguridad {#user-access-control-security-system}

#### Sistema de autenticaci√≥n {#authentication-system}

- **Funcionalidad de Iniciar sesi√≥n/Cerrar sesi√≥n de Usuario** con gesti√≥n segura de sesiones
- **Autenticaci√≥n basada en Contrase√±a** con hash bcrypt (factor de costo 12)
- **Mecanismo de bloqueo de cuenta** (5 intentos fallidos, bloqueo de 15 minutos)
- **Cambio de Contrase√±a forzado** en el primer Iniciar sesi√≥n
- **Aplicaci√≥n de pol√≠tica de Contrase√±a**:
  - M√≠nimo 8 caracteres
  - Al menos una letra may√∫scula
  - Al menos una letra min√∫scula
  - Al menos un n√∫mero
  - Caracteres especiales opcionales
- **Funcionalidad "Recordarme"** con persistencia de Nombre de usuario en localStorage
- **Autenticaci√≥n basada en sesiones** con sesiones respaldadas por base de datos (reemplaza en memoria)
- **Protecci√≥n CSRF** integrada con autenticaci√≥n
- **Cookies solo HTTP** para Seguridad de sesi√≥n
- **Seguimiento de Direcci√≥n IP y Agente de usuario** para monitoreo de Seguridad

#### Gesti√≥n de usuarios (solo Admin) {#user-management-admin-only}

- **Creaci√≥n de Usuario** con generaci√≥n autom√°tica de Contrase√±a temporal
- **Lista de Usuario** con b√∫squeda, paginaci√≥n y filtrado
- **Edici√≥n de Usuario** (Nombre de usuario, estado de admin, requisito de cambio de Contrase√±a)
- **Funcionalidad de Restablecimiento de Contrase√±a** con visualizaci√≥n de Contrase√±a temporal
- **Eliminaci√≥n de Usuario** con salvaguardas (evita la eliminaci√≥n del √∫ltimo Admin)
- **Control de acceso basado en Rol** (Roles Admin/Usuario)
- **Indicadores de Estado** (Activo, Bloqueado, Debe cambiar la Contrase√±a)
- **Seguimiento de √öltimo inicio de sesi√≥n** y visualizaci√≥n

#### Sistema de Log de Auditor√≠a {#audit-logging-system}

- **Registro de auditor√≠a integral** para Todos los cambios del Sistema y Acciones de Usuario
- **Visor de log de auditor√≠a** con filtrado avanzado:
  - Filtrado por rango de Fecha
  - Filtrado de Usuario
  - Filtrado de Acci√≥n
  - Filtrado de Categor√≠a
  - Filtrado de Estado
- **Funcionalidad de Exportar** (formatos CSV y JSON)
- **Estad√≠sticas y an√°lisis de Log de Auditor√≠a**
- **Per√≠odo de retenci√≥n configurable** (30-365 d√≠as, Por defecto: 90 d√≠as)
- **Trabajo cron de limpieza autom√°tica** (se ejecuta diariamente a las 2 AM UTC)
- **API de limpieza manual** con soporte de ejecuci√≥n en seco
- **Registro de auditor√≠a para**:
  - Eventos de autenticaci√≥n (Iniciar sesi√≥n, Cerrar sesi√≥n, cambios de Contrase√±a, bloqueos de cuenta)
  - Operaciones de Gesti√≥n de usuarios (crear, actualizar, Eliminar, Restablecimiento de Contrase√±a)
  - Cambios de configuraci√≥n (Correo electr√≥nico, NTFY, Plantillas, tolerancia retrasada, configuraci√≥n de backup)
  - Operaciones de backup (recopilaci√≥n, eliminaci√≥n, limpieza)
  - Gesti√≥n de servidores (A√±adir, actualizar, Eliminar)
  - Operaciones del Sistema (migraciones, limpieza, Notificaciones)

### Redise√±o de p√°gina de Configuraci√≥n {#settings-page-redesign}

- **Navegaci√≥n moderna de barra lateral** con barra lateral plegable
- **Persistencia de estado de barra lateral espec√≠fica del Usuario** (preferencia contra√≠da/expandida Guardada por Usuario)
- **Secciones de Configuraci√≥n agrupadas**:
  - **Notificaciones**: Notificaciones de backup, Monitoreo de backups retrasados, Plantillas
  - **Integraciones**: NTFY, Correo electr√≥nico
  - **Sistema**: Servidores, Usuarios (solo Admin), Log de Auditor√≠a
- **Barra lateral fija** que permanece visible mientras se desplaza
- **Dise√±o receptivo** con espaciado optimizado
- **Icono de Configuraci√≥n y t√≠tulo "Configuraci√≥n del Sistema"** en el encabezado de la barra lateral
- **Bot√≥n Atr√°s** integrado en el encabezado de la aplicaci√≥n

### Mejoras de interfaz de usuario {#user-interface-enhancements}

- **P√°gina de Iniciar sesi√≥n independiente** con dise√±o moderno
- **Casilla de verificaci√≥n "Recordarme"** en el formulario de Iniciar sesi√≥n para persistencia de Nombre de usuario
- **Botones Mostrar/Ocultar Contrase√±a** en formularios de Iniciar sesi√≥n y cambio de Contrase√±a
- **Modal de Cambiar Contrase√±a** con lista de verificaci√≥n de validaci√≥n en tiempo real
- **Indicador de Usuario y bot√≥n Cerrar sesi√≥n** en el encabezado de la aplicaci√≥n
- **Visibilidad de interfaz de usuario basada en Rol** (caracter√≠sticas solo para admin Ocultas de Usuarios normales)
- **Insignias e indicadores de Estado** en toda la interfaz de usuario
- **Preferencias espec√≠ficas del Usuario** almacenadas en localStorage (por ejemplo, estado de barra lateral contra√≠da)

### Caracter√≠sticas de Seguridad {#security-features}

- **Hash de Contrase√±a** con bcrypt (est√°ndar de la industria)
- **Desinfecci√≥n de datos sensibles** en Logs de Auditor√≠a (Contrase√±as, tokens, secretos nunca registrados)
- **Limitaci√≥n de velocidad** para intentos de Iniciar sesi√≥n
- **Expiraci√≥n de sesi√≥n** (24 horas)
- **Validaci√≥n de token CSRF** para Todas las operaciones que cambian de Estado
- **Herramienta CLI de recuperaci√≥n de Admin** para Restablecimiento de Contrase√±a si est√° Bloqueado

### Herramientas para desarrolladores {#developer-tools}

- **Script CLI de recuperaci√≥n de admin** (`admin-recovery`) para f√°cil ejecuci√≥n en contenedores Docker
- **Funciona tanto localmente como en Docker** con detecci√≥n autom√°tica de ruta
- **Interfaces TypeScript integral** (sin tipos `any`)
- **Middleware de autenticaci√≥n** para protecci√≥n de rutas
- **Clase de utilidad de registrador de auditor√≠a** con m√©todos de conveniencia

---

## üöÄ Notas de migraci√≥n {#migration-notes}

### Desde la Versi√≥n 0.8.x {#from-version-08x}

Esta versi√≥n introduce autenticaci√≥n y requiere que Todos los Usuarios Inicien sesi√≥n. Al actualizar desde la Versi√≥n 0.8.x:

1. **Migraci√≥n autom√°tica de base de datos**: La aplicaci√≥n migrar√° autom√°ticamente su esquema de base de datos de v3.1 a v4.0
2. **Backup de base de datos**: Se crea un backup autom√°tico antes de la migraci√≥n
3. **Cuenta de Admin Por defecto**: Se crea una cuenta de admin Por defecto:
   - Nombre de usuario: `admin`
   - Contrase√±a: `Duplistatus09`
   - **Debe cambiar esta Contrase√±a en el primer Iniciar sesi√≥n**
4. **Invalidaci√≥n de sesi√≥n**: Todas las sesiones existentes se invalidan
5. **Inicio de sesi√≥n de Usuario requerido**: Todos los Usuarios deben Iniciar sesi√≥n despu√©s de la actualizaci√≥n
6. **Autenticaci√≥n de API**: Las Integraciones externas deben actualizarse para incluir autenticaci√≥n

### Consideraciones de Seguridad {#security-considerations}

- **Cambiar Contrase√±a Por defecto**: Cambie la Contrase√±a de admin Por defecto inmediatamente despu√©s del primer Iniciar sesi√≥n
- **Crear cuentas de Usuario**: Cree cuentas de Usuario individuales para cada persona que necesite acceso
- **Revisar Logs de Auditor√≠a**: Verifique los Logs de Auditor√≠a regularmente para monitoreo de Seguridad
- **Configurar retenci√≥n**: Establezca un per√≠odo de retenci√≥n de Log de Auditor√≠a apropiado seg√∫n sus requisitos de cumplimiento
- **Backup de clave maestra**: Si actualiza desde 0.8.x, aseg√∫rese de que el archivo `.duplistatus.key` est√© respaldado

### Pasos del primer Iniciar sesi√≥n {#first-login-steps}

1. **Iniciar sesi√≥n** con credenciales Por defecto (`admin` / `Duplistatus09`)
2. **Cambiar Contrase√±a** cuando se le solicite (forzado en el primer Iniciar sesi√≥n)
3. **Crear cuentas de Usuario** para otros Usuarios (Configuraci√≥n ‚Üí Usuarios)
4. **Configurar retenci√≥n de Log de Auditor√≠a** si es necesario (Configuraci√≥n ‚Üí Log de Auditor√≠a)
5. **Revisar Logs de Auditor√≠a** para verificar que el Sistema funciona correctamente

---

## üêõ Correcciones de errores {#bug-fixes}

- Se corrigieron problemas de persistencia de sesi√≥n en reinicios de Servidores
- Manejo de errores mejorado para fallos de autenticaci√≥n
- Retroalimentaci√≥n mejorada de validaci√≥n de Contrase√±a
- Se corrigieron inconsistencias de interfaz de usuario en la p√°gina de Configuraci√≥n
- Rendimiento mejorado del filtrado de Log de Auditor√≠a

---

## Puntos finales de API {#api-endpoints}

### Puntos finales de autenticaci√≥n {#authentication-endpoints}

- `POST /api/auth/login` - Autenticaci√≥n de Usuario
- `POST /api/auth/logout` - Terminaci√≥n de sesi√≥n
- `GET /api/auth/me` - Informaci√≥n del Usuario Actual
- `POST /api/auth/change-password` - Cambio de Contrase√±a

### Puntos finales de Gesti√≥n de usuarios (solo Admin) {#user-management-endpoints-admin-only}

- `GET /api/users` - Listar Usuarios
- `POST /api/users` - Crear Usuario
- `PATCH /api/users/{id}` - Actualizar Usuario
- `DELETE /api/users/{id}` - Eliminar Usuario

### Puntos finales de Log de Auditor√≠a {#audit-log-endpoints}

- `GET /api/audit-log` - Consultar Logs de Auditor√≠a
- `GET /api/audit-log/download` - Exportar Logs de Auditor√≠a
- `GET /api/audit-log/stats` - Estad√≠sticas de auditor√≠a
- `POST /api/audit-log/cleanup` - Limpieza manual (solo admin)
- `GET /api/audit-log/retention` - Obtener configuraci√≥n de retenci√≥n
- `PATCH /api/audit-log/retention` - Actualizar retenci√≥n (solo admin)

:::note
Todos los puntos finales de API Ahora requieren autenticaci√≥n. Consulte la [Referencia de API](../api-reference/authentication-security.md) para Detalles sobre autenticaci√≥n.
:::

---

## Apoyo {#support}

### Obtener Ayuda {#getting-help}

- **Documentaci√≥n**: [Gu√≠a del Usuario](../user-guide/overview.md)
- **Referencia de API**: [Documentaci√≥n de API](../api-reference/authentication-security.md)
- **Gu√≠a de migraci√≥n**: [Migraci√≥n de actualizaci√≥n de Versi√≥n](../migration/version_upgrade.md)
- **Recuperaci√≥n de Admin**: [Recuperaci√≥n de cuenta de Admin](../user-guide/admin-recovery.md)
- **Comunidad**: [Discusiones de GitHub](https://github.com/wsj-br/duplistatus/discussions)
- **Problemas**: [Problemas de GitHub](https://github.com/wsj-br/duplistatus/issues)

### Reportar errores {#reporting-bugs}

Cu√°ndo reporte errores, incluya:

- Versi√≥n: 0.9.x
- Sistema operativo y Versi√≥n
- Versi√≥n de Docker
- Mensajes de Error y Logs
- Pasos para reproducir
- Rol de Usuario (admin/Usuario) si es relevante

---

## Registro de cambios {#changelog}

### Cambios detallados {#detailed-changes}

- **A√±adido**: Sistema completo de autenticaci√≥n y autorizaci√≥n
- **A√±adido**: Gesti√≥n de usuarios con control de acceso basado en Rol
- **A√±adido**: Sistema integral de registro de auditor√≠a
- **A√±adido**: Redise√±o de p√°gina de Configuraci√≥n con barra lateral plegable
- **A√±adido**: Herramienta CLI de recuperaci√≥n de admin
- **A√±adido**: Aplicaci√≥n de pol√≠tica de Contrase√±a
- **A√±adido**: Mecanismo de bloqueo de cuenta
- **A√±adido**: Gesti√≥n de sesiones con persistencia de base de datos
- **Cambiado**: Todas las P√°ginas Ahora requieren autenticaci√≥n
- **Cambiado**: Esquema de base de datos de v3.1 a v4.0
- **Cambiado**: Almacenamiento de sesiones de en memoria a respaldado por base de datos
- **Cambiado**: Dise√±o y navegaci√≥n de la p√°gina de Configuraci√≥n
- **Corregido**: Persistencia de sesi√≥n en reinicios de Servidores
- **Corregido**: Varias inconsistencias de interfaz de usuario
- **Mejorado**: Postura de Seguridad con registro de auditor√≠a integral
- **Mejorado**: Experiencia del Usuario con p√°ginas modernas de Iniciar sesi√≥n y Configuraci√≥n
- **Mejorado**: Calidad del c√≥digo con interfaces TypeScript y principios DRY

---

## Licencia {#license}

Este proyecto est√° licenciado bajo la [Licencia Apache 2.0](https://github.com/wsj-br/duplistatus/blob/main/LICENSE).

**Copyright ¬© 2025 Waldemar Scudeller Jr.**

