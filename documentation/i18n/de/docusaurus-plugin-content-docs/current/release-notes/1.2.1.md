# Version 1.2.1

## √úbersicht

Version 1.2.1 ist ein Minor-Release, das erhebliche Verbesserungen der Verwaltung von Backup-Benachrichtigungen einf√ºhrt, die Audit-Log-Funktionen verbessert, die Erkennung von n√§chstem Lauf/√ºberf√§llig bei Grenzf√§llen behebt und Datenbanksicherung und Wiederherstellungsfunktionalit√§t hinzuf√ºgt. Dieses Release konzentriert sich auf die Verbesserung der Benutzererfahrung mit Benachrichtigungseinstellungen.

## Neue Funktionen

### Verbesserte Verwaltung von Backup-Benachrichtigungen

- **Server-Standardwerte und Vererbungssystem**: Konfigurieren Sie Standard-Zusatzziele (Benachrichtigungsereignisse, E-Mails und NTFY-Themen) auf Serverebene, die alle Sicherungen automatisch erben. Sicherungen k√∂nnen diese Standards bei Bedarf √ºberschreiben, mit klaren visuellen Indikatoren, die den Vererbungsstatus anzeigen.
- **Verbesserte visuelle Hierarchie**: Sicherungen sind nun nach Server mit unterschiedlichen Server-Header-Zeilen gruppiert. Geerbte Werte sind deutlich mit Link-Symbolen gekennzeichnet, und √ºberschriebene Werte k√∂nnen leicht auf Vererbung zur√ºckgesetzt werden.
- **Massenoperationen**: Die Schaltfl√§che "Sync to All" l√∂scht alle Backup-√úberschreibungen, damit alle Sicherungen von Server-Standards erben. Die Schaltfl√§che "Clear All" l√∂scht alle Zusatzziele, w√§hrend die Vererbungsstruktur beibehalten wird.
- **Test-Funktionalit√§t**: Test-E-Mail- und Test-Benachrichtigungsschaltfl√§chen wurden direkt auf der Seite "Backup-Benachrichtigungen" hinzugef√ºgt. Test-Schaltfl√§chen sind sowohl f√ºr einzelne Backup-Einstellungen als auch f√ºr Massenbearbeitungsvorg√§nge verf√ºgbar, sodass Sie die Benachrichtigungszustellung vor dem Anwenden von √Ñnderungen √ºberpr√ºfen k√∂nnen.
- **QR-Code-Unterst√ºtzung**: QR-Code-Schaltfl√§che f√ºr NTFY-Themen hinzugef√ºgt, um Benachrichtigungsthemen einfach mit mobilen Ger√§ten zu teilen.

### Verbesserungen der Benachrichtigungsvorlagen

- **Neue `{log_text}`-Variable**: Die Variable `{log_text}` wurde zu Benachrichtigungsvorlagen hinzugef√ºgt und bietet Zugriff auf Log-Textnachrichten zur Verwendung in Benachrichtigungsmeldungen. Die Variable enth√§lt den vollst√§ndigen Text von Warnungen und Fehlern kombiniert, formatiert als Klartext mit einem Element pro Zeile.
- **Automatische Template-Migration**: Das System enth√§lt einen Lazy-Upgrade-Mechanismus, der alte Standard-Vorlagen automatisch erkennt und aktualisiert, wenn sie nach einem Upgrade zum ersten Mal gelesen werden. Benutzerdefinierte Vorlagen bleiben unver√§ndert.

### Datenbankverwaltung

- **Datenbanksicherungsfunktionalit√§t**: Administratoren k√∂nnen nun Sicherungen der gesamten Datenbank auf der Seite "Datenbankwartung" erstellen. Unterst√ºtzt sowohl bin√§re (.db) als auch SQL-Text-(.sql)-Formate f√ºr Flexibilit√§t.
- **Datenbankwiederherstellungsfunktionalit√§t**: Stellen Sie die Datenbank aus zuvor erstellten Sicherungsdateien mit automatischer Sicherungserstellung, Integrit√§tspr√ºfung und Rollback bei Fehler wieder her. Alle Sitzungen werden nach der Wiederherstellung aus Sicherheitsgr√ºnden gel√∂scht.

### Master-Schl√ºssel-Erkennung

- **Automatische Erkennung von Master-Schl√ºssel-√Ñnderungen**: Nach der Anmeldung pr√ºft das System automatisch, ob die Datei `.duplistatus.key` ge√§ndert wurde. Falls erkannt, werden alle verschl√ºsselten Passw√∂rter gel√∂scht und ein Modal-Popup informiert Benutzer, dass Passw√∂rter neu konfiguriert werden m√ºssen. Dies verhindert Fehler beim Wiederherstellen aus Sicherungen oder beim Migrieren zu einem neuen System.

### Verbesserungen der √úberwachung √ºberf√§lliger Sicherungen

- **Verbesserter CSV-Export**: Die Spalte "Last Backup Timestamp (DB)" wurde der CSV-Datei hinzugef√ºgt, die durch die Schaltfl√§che "CSV herunterladen" in den Einstellungen zur √úberwachung √ºberf√§lliger Sicherungen generiert wird. Dies erm√∂glicht Benutzern, den tats√§chlichen letzten Sicherungs-Zeitstempel aus der Datenbank mit dem konfigurierten "Letzte Sicherung"-Zeitstempel zu vergleichen.
- **Tooltip f√ºr N√§chster Lauf**: Wenn Sie den Mauszeiger √ºber den Wert "N√§chster Lauf" in jeder Zeile bewegen, wird ein Tooltip angezeigt, das den letzten Sicherungs-Zeitstempel aus der Datenbank zeigt, formatiert auf die gleiche Weise wie die Anzeige "N√§chster Lauf".

### Verbesserungen der Audit-Log-Protokollierung

- **Einzelne Audit-Log-Eintr√§ge f√ºr Benachrichtigungen**: Jede gesendete Benachrichtigung und E-Mail generiert nun einen separaten Audit-Log-Eintrag mit Details zum Kanal, zur Konfiguration und zum Ergebnis (Erfolg oder Fehler). Dies umfasst Test-Benachrichtigungen und bietet bessere Nachverfolgbarkeit f√ºr die Benachrichtigungszustellung.
- **Robuste Fehlerprotokollierung**: Alle Audit-Logging-Vorg√§nge f√ºr Benachrichtigungsfehler sind nun in Try-Catch-Bl√∂cken eingebunden, um zu verhindern, dass Audit-Logging-Fehler Benachrichtigungsabl√§ufe unterbrechen. Das System versucht, die SMTP-Konfiguration abzurufen, wenn sie beim Protokollieren von E-Mail-Fehlern nicht sofort verf√ºgbar ist.
- **Verbesserte Audit-Protokollierung f√ºr Konfigurationsaktualisierungen**: Sowohl `email_config_updated` als auch `ntfy_config_updated` Audit-Log-Eintr√§ge werden nun nur aufgezeichnet, wenn tats√§chliche √Ñnderungen an der Konfiguration vorgenommen werden. Wenn √Ñnderungen erkannt werden, enth√§lt das Audit-Log alte und neue Werte f√ºr jedes ge√§nderte Feld, was es einfacher macht zu verfolgen, was sich genau ge√§ndert hat.

### Verbesserungen der Dokumentation

- Der Dokumentationsstil wurde aktualisiert, um mit dem Erscheinungsbild der Anwendung √ºbereinzustimmen. Die Seitenleiste wurde ebenfalls √ºberarbeitet, um die Sichtbarkeit zu verbessern und die Navigation zu erleichtern.

---

## üêõ Fehlerbehebungen

- **Behobene Audit-Log-Zeitstempel**: Zeitstempel im Audit-Log-Viewer werden nun korrekt in der Zeitzone des Browsers des Benutzers anstelle von GMT angezeigt. SQLite-Zeitstempel (in UTC gespeichert) werden nun ordnungsgem√§√ü als UTC analysiert und zur Anzeige in die lokale Zeitzone des Browsers konvertiert.
- **Korrigierte Berechnung von "N√§chster Lauf" und Erkennung √ºberf√§lliger Sicherungen**: Die Spalte "N√§chster Lauf" in den Einstellungen zur √úberwachung √ºberf√§lliger Sicherungen berechnet und zeigt nun genau das n√§chste erwartete Sicherungsdatum an, wobei sowohl der Sicherungs-Zeitplan als auch der letzte Sicherungs-Zeitstempel ber√ºcksichtigt werden. Dies gilt f√ºr sowohl geplante als auch manuell ausgef√ºhrte Sicherungsauftr√§ge, was zu zuverl√§ssigerer Erkennung √ºberf√§lliger Sicherungen f√ºhrt.

---

## üöÄ Migrationsnoten

### Von Version 1.1.x

Beim Upgrade auf Version 1.2.1:

1. **Benachrichtigungsvorlagen**: Das System aktualisiert automatisch die Standard-Benachrichtigungsvorlagen, um die neue `{log_text}`-Variable beim ersten Zugriff nach dem Upgrade einzuschlie√üen. Benutzerdefinierte Vorlagen bleiben unver√§ndert. Wenn Sie die neue `{log_text}`-Variable in Ihren eigenen Vorlagen verwenden m√∂chten, m√ºssen Sie diese aktualisieren oder die Standard-Vorlagen manuell wiederherstellen.

2. **Master-Schl√ºssel-√Ñnderungen**: Wenn Sie aus einer Sicherung wiederherstellen oder zu einem neuen System mit einer anderen `.duplistatus.key`-Datei migrieren, erkennt das System dies automatisch und fordert Sie auf, verschl√ºsselte Passw√∂rter (SMTP-Passw√∂rter und Duplicati-Server-Passw√∂rter) neu zu konfigurieren.

3. **Datenbanksicherung/Wiederherstellung**: Neue Datenbanksicherungs- und Wiederherstellungsfunktionalit√§t ist auf der Seite "Datenbankwartung" verf√ºgbar. Es wird empfohlen, vor dem Upgrade eine Sicherung zu erstellen, obwohl f√ºr dieses Release keine Datenbankschema-√Ñnderungen erforderlich sind.

4. **Keine Datenbankmigration erforderlich**: Dieses Release erfordert keine Datenbankschema-√Ñnderungen.

---

## API-Endpunkte

Die folgenden API-Endpunkte wurden in dieser Version eingef√ºhrt.

### Authentifizierungs- und Sicherheitsendpunkte

- `GET /api/auth/admin-must-change-password` - Pr√ºfen Sie, ob der Admin-Benutzer das Passwort √§ndern muss

### Datenbankverwaltungsendpunkte

- `GET /api/database/backup` - Datenbanksicherung erstellen (bin√§res oder SQL-Format)
- `POST /api/database/restore` - Datenbank aus Sicherungsdatei wiederherstellen

### Sicherungsverwaltungsendpunkte

- `GET /api/backups/last-timestamps` - Letzte Sicherungs-Zeitstempel f√ºr alle Server-Sicherungs-Kombinationen abrufen

---

## Unterst√ºtzung

### Hilfe erhalten

- **Dokumentation**: [Benutzerhandbuch](../user-guide/overview.md)
- **E-Mail-Einstellungen**: [E-Mail-Konfigurationsleitfaden](../user-guide/settings/email-settings.md)
- **API-Referenz**: [API-Dokumentation](../api-reference/overview.md)
- **Migrationsleitfaden**: [Versions-Upgrade-Migration](../migration/version_upgrade.md)
- **Community**: [GitHub Discussions](https://github.com/wsj-br/duplistatus/discussions)
- **Probleme**: [GitHub Issues](https://github.com/wsj-br/duplistatus/issues)

### Fehler melden

Bitte geben Sie beim Melden von Fehlern Folgendes an:

- Version: 1.2.1
- Betriebssystem und Version
- Docker/podman-Version
- Container-Typ (Docker oder podman/Pod)
- Fehlermeldungen und Protokolle
- Schritte zum Reproduzieren

---

## √Ñnderungsprotokoll

### Version 1.2.1 √Ñnderungen

- **Hinzugef√ºgt**: Server-Standardwerte und Vererbungssystem f√ºr Backup-Benachrichtigungen
- **Hinzugef√ºgt**: Test-E-Mail- und Test-Benachrichtigungsfunktionalit√§t in Backup-Benachrichtigungseinstellungen
- **Hinzugef√ºgt**: QR-Code-Schaltfl√§che f√ºr NTFY-Themen
- **Hinzugef√ºgt**: Spalte "Last Backup Timestamp (DB)" zum CSV-Export der √úberwachung √ºberf√§lliger Sicherungen
- **Hinzugef√ºgt**: Tooltip zum Text "N√§chster Lauf" in den Einstellungen zur √úberwachung √ºberf√§lliger Sicherungen
- **Hinzugef√ºgt**: Einzelne Audit-Log-Eintr√§ge f√ºr jede gesendete Benachrichtigung und E-Mail
- **Hinzugef√ºgt**: Verbesserte Robustheit der Audit-Protokollierung f√ºr Benachrichtigungsfehler
- **Hinzugef√ºgt**: `{log_text}`-Variable zu Benachrichtigungsvorlagen mit automatischer Template-Migration
- **Hinzugef√ºgt**: Automatische Erkennung von Master-Schl√ºsseldatei-√Ñnderungen
- **Hinzugef√ºgt**: Datenbanksicherungsfunktionalit√§t (bin√§re und SQL-Formate)
- **Hinzugef√ºgt**: Datenbankwiederherstellungsfunktionalit√§t mit Sicherungssicherungen und Integrit√§tspr√ºfung
- **Hinzugef√ºgt**: API-Endpunkt `GET /api/auth/admin-must-change-password` zur √úberpr√ºfung der Anforderung zur Passwort√§nderung des Administrators
- **Hinzugef√ºgt**: API-Endpunkt `GET /api/database/backup` zum Erstellen von Datenbanksicherungen
- **Hinzugef√ºgt**: API-Endpunkt `POST /api/database/restore` zur Wiederherstellung der Datenbank aus Sicherung
- **Hinzugef√ºgt**: API-Endpunkt `GET /api/backups/last-timestamps` zum Abrufen der letzten Sicherungs-Zeitstempel
- **Ge√§ndert**: Verbesserte Audit-Protokollierung f√ºr E-Mail- und NTFY-Konfigurationsaktualisierungen (nur tats√§chliche √Ñnderungen werden aufgezeichnet)
- **Ge√§ndert**: Passwort√§nderungsformulare erfordern keine Best√§tigung mehr, wenn unmaskierte Passw√∂rter angezeigt werden.
- **Ge√§ndert**: Passw√∂rter werden sicher aus dem Speicher gel√∂scht, wenn Passwort√§nderungsformulare geschlossen werden.
- **Ge√§ndert**: Ein Passwort-Ansicht-Umschalter wurde in das Formular zum Sammeln von Sicherungen aufgenommen.
- **Ge√§ndert**: Die Variable `{server_alias}` zeigt nun den Servernamen in Klammern an
- **Ge√§ndert**: Dokumentation aktualisiert, Stil mit der Anwendung abgestimmt und Seitenleiste √ºberarbeitet.
- **Behoben**: Audit-Log-Zeitstempel werden in GMT anstelle der Browser-Zeitzone angezeigt
- **Behoben**: E-Mail- und NTFY-Fehler-Audit-Protokollierung
- **Behoben**: "N√§chster Lauf"-Anzeige in den Einstellungen zur √úberwachung √ºberf√§lliger Sicherungen zeigt falsche Daten an

---

## Lizenz

Dieses Projekt ist unter der [Apache License 2.0](https://github.com/wsj-br/duplistatus/blob/main/LICENSE) lizenziert.

**Copyright ¬© 2025 Waldemar Scudeller Jr.**
