# Version 0.9.x

## √úbersicht

Version 0.9.x ist eine Hauptversion, die ein umfassendes **Benutzerzugriffskontroll- und Sicherheitssystem** einf√ºhrt. Diese Version transformiert **duplistatus** von einer offenen Anwendung in ein sicheres Multi-Benutzer-System mit rollenbasierter Zugriffskontrolle, umfassender Audit-Log und Enterprise-Sicherheitsfunktionen. Alle vorhandenen Funktionen sind jetzt durch Authentifizierung gesch√ºtzt, um sicherzustellen, dass nur autorisierte Benutzer auf die Sicherungs√ºberwachung zugreifen und diese verwalten k√∂nnen.

## Breaking Changes

### Authentifizierung erforderlich

- **Alle Seiten erfordern jetzt Authentifizierung** - Benutzer m√ºssen sich anmelden, um auf die Anwendung zuzugreifen
- **Standard-Admin-Konto** wird automatisch erstellt:
  - Benutzername: `admin`
  - Passwort: `Duplistatus09` (muss bei der ersten Anmeldung ge√§ndert werden)
- **Vorhandene Sitzungen werden ung√ºltig** - Alle Benutzer m√ºssen sich nach dem Upgrade anmelden
- **API-Endpunkte erfordern jetzt Authentifizierung** - Externe Integrationen m√ºssen Sitzungs-Cookies einschlie√üen oder authentifizierte Anfragen verwenden

:::warning
**Alle Benutzer m√ºssen sich nach dem Upgrade auf Version 0.9.x anmelden.** Die Standard-Admin-Anmeldedaten sind admin/Duplistatus09. √Ñndern Sie das Passwort sofort nach der ersten Anmeldung.
:::

### Datenbankschemamigration

- **Automatische Migration von v3.1 zu v4.0** f√ºr vorhandene Installationen
- **Neue Tabellen hinzugef√ºgt**: `users`, `sessions`, `audit_log`
- **Datenbanksicherung erstellt automatisch** vor der Migration
- **Neue Installationen** starten direkt mit Schema v4.0 (keine Migration erforderlich)

## Neue Funktionen

### Benutzerzugriffskontroll- und Sicherheitssystem

#### Authentifizierungssystem

- **Benutzer-Login/Logout-Funktionalit√§t** mit sicherer Sitzungsverwaltung
- **Passwortbasierte Authentifizierung** mit bcrypt-Hashing (Kostenfaktor 12)
- **Kontosperrungsmechanismus** (5 fehlgeschlagene Versuche, 15-Minuten-Sperrung)
- **Erzwungener Passwortwechsel** bei der ersten Anmeldung
- **Passwortrichtliniendurchsetzung**:
  - Mindestens 8 Zeichen
  - Mindestens ein Gro√übuchstabe
  - Mindestens ein Kleinbuchstabe
  - Mindestens eine Zahl
  - Sonderzeichen optional
- **"Angemeldet bleiben"-Funktionalit√§t** mit Benutzernamen-Persistierung in localStorage
- **Sitzungsbasierte Authentifizierung** mit datenbankgest√ºtzten Sitzungen (ersetzt In-Memory)
- **CSRF-Schutz** in die Authentifizierung integriert
- **HTTP-Only-Cookies** f√ºr Sitzungssicherheit
- **IP-Adresse und User-Agent-Verfolgung** f√ºr Sicherheits√ºberwachung

#### Benutzerverwaltung (nur Admin)

- **Benutzererstellung** mit automatischer Generierung tempor√§rer Passw√∂rter
- **Benutzerliste** mit Suche, Paginierung und Filterung
- **Benutzerbearbeitung** (Benutzername, Admin-Status, Passwort√§nderungsanforderung)
- **Passwort-Zur√ºcksetzen-Funktionalit√§t** mit Anzeige tempor√§rer Passw√∂rter
- **Benutzerl√∂schung** mit Schutzma√ünahmen (verhindert L√∂schung des letzten Admin)
- **Rollenbasierte Zugriffskontrolle** (Admin/Benutzer-Rollen)
- **Statusanzeigen** (Aktiv, Gesperrt, Passwort muss ge√§ndert werden)
- **Verfolgung und Anzeige der letzten Anmeldung**

#### Audit-Log-System

- **Umfassende Audit-Spur** f√ºr alle System√§nderungen und Benutzeraktionen
- **Audit-Log-Viewer** mit erweiterter Filterung:
  - Datumbereichsfilterung
  - Benutzerfilterung
  - Aktionsfilterung
  - Kategoriefilterung
  - Statusfilterung
- **Exportfunktionalit√§t** (CSV- und JSON-Formate)
- **Audit-Log-Statistiken** und Analysen
- **Konfigurierbare Aufbewahrungsdauer** (30-365 Tage, Standard: 90 Tage)
- **Automatischer Cleanup-Cron-Job** (l√§uft t√§glich um 2 Uhr UTC)
- **Manuelles Cleanup-API** mit Dry-Run-Unterst√ºtzung
- **Audit-Logging f√ºr**:
  - Authentifizierungsereignisse (Anmeldung, Abmeldung, Passwort√§nderungen, Kontosperrungen)
  - Benutzerverwaltungsvorg√§nge (erstellen, aktualisieren, l√∂schen, Passwort-Zur√ºcksetzen)
  - Konfigurations√§nderungen (E-Mail, NTFY, Vorlagen, √úberf√§lligkeitstoleranz, Sicherungseinstellungen)
  - Sicherungsvorg√§nge (Erfassung, L√∂schung, Bereinigung)
  - Serververwaltung (Hinzuf√ºgen, Aktualisieren, L√∂schen)
  - Systemvorg√§nge (Migrationen, Bereinigung, Benachrichtigungen)

### Einstellungsseite Neugestaltung

- **Moderne Seitenleisten-Navigation** mit ausklappbarer Seitenleiste
- **Benutzerspezifische Seitenleisten-Zustandspersistierung** (eingeklappte/erweiterte Einstellung pro Benutzer gespeichert)
- **Gruppierte Einstellungsabschnitte**:
  - **Benachrichtigungen**: Backup-Benachrichtigungen, √úberwachung √ºberf√§lliger Sicherungen, Vorlagen
  - **Integrationen**: NTFY, E-Mail
  - **System**: Server, Benutzer (nur Admin), Audit-Log
- **Klebrige Seitenleiste**, die beim Scrollen sichtbar bleibt
- **Responsives Design** mit optimiertem Abstand
- **Einstellungssymbol und "Systemeinstellungen"-Titel** in der Seitenleisten-Kopfzeile
- **Zur√ºck-Schaltfl√§che** in die App-Kopfzeile integriert

### Benutzeroberfl√§chen-Verbesserungen

- **Eigenst√§ndige Anmeldeseite** mit modernem Design
- **"Angemeldet bleiben"-Kontrollk√§stchen** auf dem Anmeldeformular f√ºr Benutzernamen-Persistierung
- **Passwort anzeigen/ausblenden-Schaltfl√§chen** auf Anmelde- und Passwort√§nderungsformularen
- **Passwort√§nderungs-Modal** mit Echtzeit-Validierungs-Checkliste
- **Benutzerindikator und Abmelden-Schaltfl√§che** in der App-Kopfzeile
- **Rollenbasierte UI-Sichtbarkeit** (Admin-only-Funktionen sind f√ºr normale Benutzer ausgeblendet)
- **Statusabzeichen und Indikatoren** in der gesamten Benutzeroberfl√§che
- **Benutzerspezifische Einstellungen** in localStorage gespeichert (z. B. eingeklappter Seitenleisten-Status)

### Sicherheitsfunktionen

- **Passwort-Hashing** mit bcrypt (Industriestandard)
- **Sanitierung sensibler Daten** in Audit-Logs (Passw√∂rter, Token, Geheimnisse werden nie protokolliert)
- **Ratenbegrenzung** f√ºr Anmeldeversuche
- **Sitzungsablauf** (24 Stunden)
- **CSRF-Token-Validierung** f√ºr alle zustands√§ndernden Vorg√§nge
- **Admin-Wiederherstellungs-CLI-Tool** zum Zur√ºcksetzen des Passworts bei Sperrung

### Entwickler-Tools

- **Admin-Wiederherstellungs-CLI-Skript** (`admin-recovery`) f√ºr einfache Ausf√ºhrung in Docker-Containern
- **Funktioniert sowohl lokal als auch in Docker** mit automatischer Pfaderkennung
- **Umfassende TypeScript-Schnittstellen** (keine `any`-Typen)
- **Authentifizierungs-Middleware** f√ºr Routenschutz
- **Audit-Logger-Utility-Klasse** mit Komfortmethoden

---

## üöÄ Migrationsnoten

### Aus Version 0.8.x

Diese Version f√ºhrt Authentifizierung ein und erfordert, dass sich alle Benutzer anmelden. Beim Upgrade von Version 0.8.x:

1. **Automatische Datenbankmigration**: Die Anwendung migriert Ihr Datenbankschema automatisch von v3.1 zu v4.0
2. **Datenbanksicherung**: Eine automatische Sicherung wird vor der Migration erstellt
3. **Standard-Admin-Konto**: Ein Standard-Admin-Konto wird erstellt:
   - Benutzername: `admin`
   - Passwort: `Duplistatus09`
   - **Sie m√ºssen dieses Passwort bei der ersten Anmeldung √§ndern**
4. **Sitzungsung√ºltigmachung**: Alle vorhandenen Sitzungen werden ung√ºltig gemacht
5. **Benutzer-Anmeldung erforderlich**: Alle Benutzer m√ºssen sich nach dem Upgrade anmelden
6. **API-Authentifizierung**: Externe Integrationen m√ºssen aktualisiert werden, um Authentifizierung einzuschlie√üen

### Sicherheits√ºberlegungen

- **Standardpasswort √§ndern**: √Ñndern Sie das Standard-Admin-Passwort sofort nach der ersten Anmeldung
- **Benutzerkonten erstellen**: Erstellen Sie einzelne Benutzerkonten f√ºr jede Person, die Zugriff ben√∂tigt
- **Audit-Logs √ºberpr√ºfen**: √úberpr√ºfen Sie Audit-Logs regelm√§√üig zur Sicherheits√ºberwachung
- **Aufbewahrung konfigurieren**: Legen Sie eine angemessene Audit-Log-Aufbewahrungsdauer basierend auf Ihren Compliance-Anforderungen fest
- **Master-Schl√ºssel sichern**: Wenn Sie von 0.8.x aktualisieren, stellen Sie sicher, dass die `.duplistatus.key`-Datei gesichert wird

### Erste Anmeldeschritte

1. **Melden Sie sich an** mit Standard-Anmeldedaten (`admin` / `Duplistatus09`)
2. **Passwort √§ndern**, wenn Sie dazu aufgefordert werden (erzwungen bei der ersten Anmeldung)
3. **Benutzerkonten erstellen** f√ºr andere Benutzer (Einstellungen ‚Üí Benutzer)
4. **Audit-Log-Aufbewahrung konfigurieren**, falls erforderlich (Einstellungen ‚Üí Audit-Log)
5. **Audit-Logs √ºberpr√ºfen**, um zu √ºberpr√ºfen, ob das System ordnungsgem√§√ü funktioniert

---

## üêõ Fehlerbehebungen

- Sitzungspersistenzprobleme √ºber Serverneustarts hinweg behoben
- Verbesserte Fehlerbehandlung f√ºr Authentifizierungsfehler
- Verbesserte Passwortvalidierungs-R√ºckmeldung
- UI-Inkonsistenzen auf der Einstellungsseite behoben
- Verbesserte Audit-Log-Filterleistung

---

## API-Endpunkte

### Authentifizierungs-Endpunkte

- `POST /api/auth/login` - Benutzerauthentifizierung
- `POST /api/auth/logout` - Sitzungsbeendigung
- `GET /api/auth/me` - Aktuelle Benutzerinformationen
- `POST /api/auth/change-password` - Passwort√§nderung

### Benutzerverwaltungs-Endpunkte (nur Admin)

- `GET /api/users` - Benutzer auflisten
- `POST /api/users` - Benutzer erstellen
- `PATCH /api/users/{id}` - Benutzer aktualisieren
- `DELETE /api/users/{id}` - Benutzer l√∂schen

### Audit-Log-Endpunkte

- `GET /api/audit-log` - Audit-Logs abfragen
- `GET /api/audit-log/download` - Audit-Logs exportieren
- `GET /api/audit-log/stats` - Audit-Statistiken
- `POST /api/audit-log/cleanup` - Manuelle Bereinigung (nur Admin)
- `GET /api/audit-log/retention` - Aufbewahrungseinstellung abrufen
- `PATCH /api/audit-log/retention` - Aufbewahrung aktualisieren (nur Admin)

:::note
Alle API-Endpunkte erfordern jetzt Authentifizierung. Weitere Informationen finden Sie in der [API-Referenz](../api-reference/authentication-security.md).
:::

---

## Unterst√ºtzung

### Hilfe erhalten

- **Dokumentation**: [Benutzerhandbuch](../user-guide/overview.md)
- **API-Referenz**: [API-Dokumentation](../api-reference/authentication-security.md)
- **Migrationsleitfaden**: [Versions-Upgrade-Migration](../migration/version_upgrade.md)
- **Admin-Wiederherstellung**: [Admin-Kontowiederherstellung](../user-guide/admin-recovery.md)
- **Gemeinschaft**: [GitHub Discussions](https://github.com/wsj-br/duplistatus/discussions)
- **Probleme**: [GitHub Issues](https://github.com/wsj-br/duplistatus/issues)

### Fehler melden

Bitte geben Sie beim Melden von Fehlern Folgendes an:

- Version: 0.9.x
- Betriebssystem und Version
- Docker-Version
- Fehlermeldungen und Protokolle
- Schritte zum Reproduzieren
- Benutzerrolle (Admin/Benutzer), falls relevant

---

## √Ñnderungsprotokoll

### Detaillierte √Ñnderungen

- **Hinzugef√ºgt**: Vollst√§ndiges Authentifizierungs- und Autorisierungssystem
- **Hinzugef√ºgt**: Benutzerverwaltung mit rollenbasierter Zugriffskontrolle
- **Hinzugef√ºgt**: Umfassendes Audit-Logging-System
- **Hinzugef√ºgt**: Neugestaltung der Einstellungsseite mit ausklappbarer Seitenleiste
- **Hinzugef√ºgt**: Admin-Wiederherstellungs-CLI-Tool
- **Hinzugef√ºgt**: Passwortrichtliniendurchsetzung
- **Hinzugef√ºgt**: Kontosperrungsmechanismus
- **Hinzugef√ºgt**: Sitzungsverwaltung mit Datenbankpersistierung
- **Ge√§ndert**: Alle Seiten erfordern jetzt Authentifizierung
- **Ge√§ndert**: Datenbankschema von v3.1 zu v4.0
- **Ge√§ndert**: Sitzungsspeicher von In-Memory zu datenbankgest√ºtzt
- **Ge√§ndert**: Einstellungsseiten-Layout und Navigation
- **Behoben**: Sitzungspersistenz √ºber Serverneustarts hinweg
- **Behoben**: Verschiedene UI-Inkonsistenzen
- **Verbessert**: Sicherheitslage mit umfassendem Audit-Logging
- **Verbessert**: Benutzererlebnis mit modernen Anmelde- und Einstellungsseiten
- **Verbessert**: Codequalit√§t mit TypeScript-Schnittstellen und DRY-Prinzipien

---

## Lizenz

Dieses Projekt ist unter der [Apache License 2.0](https://github.com/wsj-br/duplistatus/blob/main/LICENSE) lizenziert.

**Copyright ¬© 2025 Waldemar Scudeller Jr.**

