# Version 0.9.x

## Vue d'ensemble

Version 0.9.x est une version majeure qui introduit un **Syst√®me complet de contr√¥le d'acc√®s utilisateur et de s√©curit√©**. Cette version transforme **duplistatus** d'une application en acc√®s libre en un syst√®me s√©curis√© multi-utilisateurs avec contr√¥le d'acc√®s bas√© sur les r√¥les, journalisation d'audit compl√®te et fonctionnalit√©s de s√©curit√© de niveau entreprise. Toutes les fonctionnalit√©s existantes sont maintenant prot√©g√©es par l'authentification, garantissant que seuls les Utilisateurs autoris√©s peuvent acc√©der et g√©rer la surveillance des sauvegardes.

## Modifications incompatibles

### Authentification requise

- **Toutes les pages n√©cessitent maintenant une authentification** - Les Utilisateurs doivent se connecter pour acc√©der √† l'application
- **Compte administrateur par d√©faut** cr√©√© automatiquement :
  - Nom d'utilisateur : `admin`
  - Mot de passe : `Duplistatus09` (doit √™tre modifi√© √† la premi√®re Connexion)
- **Les sessions existantes sont invalid√©es** - Tous les Utilisateurs doivent se connecter apr√®s la mise √† jour
- **Les points de terminaison API n√©cessitent maintenant une authentification** - Les Int√©grations externes doivent inclure les cookies de session ou utiliser des demandes authentifi√©es

:::warning
**Tous les Utilisateurs doivent se connecter apr√®s la mise √† niveau vers la version 0.9.x.** Les identifiants d'administrateur par d√©faut sont admin/Duplistatus09. Modifiez le Mot de passe imm√©diatement apr√®s la premi√®re Connexion.
:::

### Migration du sch√©ma de base de donn√©es

- **Migration automatique de v3.1 √† v4.0** pour les installations existantes
- **Nouvelles tables ajout√©es** : `users`, `sessions`, `audit_log`
- **Sauvegarde de la base de donn√©es cr√©√©e automatiquement** avant la migration
- **Les nouvelles installations** commencent directement avec le sch√©ma v4.0 (aucune migration n√©cessaire)

## Nouvelles fonctionnalit√©s

### Syst√®me de contr√¥le d'acc√®s utilisateur et de s√©curit√©

#### Syst√®me d'authentification

- **Fonctionnalit√© de connexion/d√©connexion utilisateur** avec gestion s√©curis√©e des sessions
- **Authentification bas√©e sur mot de passe** avec hachage bcrypt (facteur de co√ªt 12)
- **M√©canisme de verrouillage de compte** (5 tentatives √©chou√©es, verrouillage de 15 minutes)
- **Changement de mot de passe forc√©** √† la premi√®re Connexion
- **Application de la politique de mot de passe** :
  - Minimum 8 caract√®res
  - Au moins une lettre majuscule
  - Au moins une lettre minuscule
  - Au moins un chiffre
  - Caract√®res sp√©ciaux optionnels
- **Fonctionnalit√© "Se souvenir de moi"** avec persistance du Nom d'utilisateur dans localStorage
- **Authentification bas√©e sur session** avec sessions sauvegard√©es en base de donn√©es (remplace la m√©moire)
- **Protection CSRF** int√©gr√©e √† l'authentification
- **Cookies HTTP uniquement** pour la s√©curit√© des sessions
- **Suivi de l'Adresse IP et de l'Agent utilisateur** pour la surveillance de la S√©curit√©

#### Gestion des utilisateurs (Admin uniquement)

- **Cr√©ation d'Utilisateur** avec g√©n√©ration automatique de mot de passe temporaire
- **Liste d'Utilisateur** avec Rechercher, pagination et Filtrer
- **√âdition d'Utilisateur** (Nom d'utilisateur, statut Admin, exigence de changement de mot de passe)
- **Fonctionnalit√© de R√©initialisation du mot de passe** avec affichage du mot de passe temporaire
- **Suppression d'Utilisateur** avec protections (emp√™che la suppression du dernier Admin)
- **Contr√¥le d'acc√®s bas√© sur les r√¥les** (r√¥les Admin/Utilisateur)
- **Indicateurs de statut** (Actif, Verrouill√©, Doit changer le mot de passe)
- **Suivi de la Derni√®re connexion** et affichage

#### Syst√®me de journalisation d'audit

- **Piste d'audit compl√®te** pour tous les changements syst√®me et Actions des Utilisateurs
- **Visualiseur de journal d'audit** avec filtrage avanc√© :
  - Filtrage par plage de Date
  - Filtrage par Utilisateur
  - Filtrage par Action
  - Filtrage par Cat√©gorie
  - Filtrage par Statut
- **Fonctionnalit√© d'Exporter** (formats CSV et JSON)
- **Statistiques et analytique du Journal d'Audit**
- **P√©riode de r√©tention configurable** (30-365 jours, par d√©faut : 90 jours)
- **T√¢che cron de nettoyage automatique** (s'ex√©cute quotidiennement √† 2 h UTC)
- **API de nettoyage manuel** avec support de simulation
- **Journalisation d'audit pour** :
  - √âv√©nements d'authentification (Connexion, D√©connexion, changements de Mot de passe, verrouillages de compte)
  - Op√©rations de Gestion des utilisateurs (cr√©er, mettre √† jour, Supprimer, R√©initialisations de mot de passe)
  - Changements de configuration (E-mail, NTFY, Mod√®les, tol√©rance en retard, Param√®tres de sauvegarde)
  - Op√©rations de sauvegarde (collection, suppression, nettoyage)
  - Gestion des serveurs (Ajouter, mettre √† jour, Supprimer)
  - Op√©rations syst√®me (migrations, nettoyage, Notifications)

### Refonte de la page Param√®tres

- **Navigation moderne de la barre lat√©rale** avec barre lat√©rale r√©ductible
- **Persistance de l'√©tat de la barre lat√©rale sp√©cifique √† l'Utilisateur** (pr√©f√©rence r√©duite/d√©velopp√©e Enregistr√©e par Utilisateur)
- **Sections de Param√®tres group√©es** :
  - **Notifications** : Notifications de sauvegarde, Surveillance des sauvegardes en retard, Mod√®les
  - **Int√©grations** : NTFY, E-mail
  - **Syst√®me** : Serveurs, Utilisateurs (Admin uniquement), Journal d'Audit
- **Barre lat√©rale collante** qui reste visible lors du d√©filement
- **Conception r√©active** avec espacement optimis√©
- **Ic√¥ne Param√®tres et titre "Param√®tres syst√®me"** dans l'en-t√™te de la barre lat√©rale
- **Bouton Retour** int√©gr√© dans l'en-t√™te de l'application

### Am√©liorations de l'interface utilisateur

- **Page de Connexion autonome** avec conception moderne
- **Case √† cocher "Se souvenir de moi"** sur le formulaire de Connexion pour la persistance du Nom d'utilisateur
- **Boutons Afficher/Masquer le mot de passe** sur les formulaires de Connexion et de changement de Mot de passe
- **Modal de changement de Mot de passe** avec liste de contr√¥le de validation en temps r√©el
- **Indicateur d'Utilisateur et bouton D√©connexion** dans l'en-t√™te de l'application
- **Visibilit√© de l'interface utilisateur bas√©e sur les r√¥les** (fonctionnalit√©s r√©serv√©es aux administrateurs Masqu√©es des Utilisateurs ordinaires)
- **Badges de Statut et indicateurs** dans toute l'interface utilisateur
- **Pr√©f√©rences sp√©cifiques √† l'Utilisateur** stock√©es dans localStorage (par exemple, √©tat de la barre lat√©rale r√©duite)

### Fonctionnalit√©s de s√©curit√©

- **Hachage du Mot de passe** avec bcrypt (norme industrielle)
- **Assainissement des donn√©es sensibles** dans les Journaux d'audit (les Mots de passe, jetons, secrets ne sont Jamais enregistr√©s)
- **Limitation de d√©bit** pour les tentatives de Connexion
- **Expiration de session** (24 heures)
- **Validation du jeton CSRF** pour toutes les op√©rations de modification d'√©tat
- **Outil CLI de r√©cup√©ration Admin** pour R√©initialisation du mot de passe en cas de verrouillage

### Outils de d√©veloppement

- **Script CLI de r√©cup√©ration Admin** (`admin-recovery`) pour une ex√©cution facile dans les conteneurs Docker
- **Fonctionne √† la fois localement et dans Docker** avec d√©tection automatique du chemin
- **Interfaces TypeScript compl√®tes** (pas de types `any`)
- **Middleware d'authentification** pour la protection des routes
- **Classe utilitaire de journalisation d'audit** avec m√©thodes pratiques

---

## üöÄ Notes de migration

### √Ä partir de la version 0.8.x

Cette version introduit l'authentification et exige que Tous les Utilisateurs se connectent. Lors de la mise √† niveau √† partir de la version 0.8.x :

1. **Migration automatique de la base de donn√©es** : L'application migrera automatiquement votre sch√©ma de base de donn√©es de v3.1 √† v4.0
2. **Sauvegarde de la base de donn√©es** : Une Sauvegarde de la base de donn√©es automatique est cr√©√©e avant la migration
3. **Compte administrateur par d√©faut** : Un compte administrateur par d√©faut est cr√©√© :
   - Nom d'utilisateur : `admin`
   - Mot de passe : `Duplistatus09`
   - **Vous devez modifier ce Mot de passe √† la premi√®re Connexion**
4. **Invalidation de session** : Toutes les sessions existantes sont invalid√©es
5. **Connexion utilisateur requise** : Tous les Utilisateurs doivent se connecter apr√®s la mise √† niveau
6. **Authentification API** : Les Int√©grations externes doivent √™tre mises √† jour pour inclure l'authentification

### Consid√©rations de s√©curit√©

- **Modifier le Mot de passe par d√©faut** : Modifiez le Mot de passe administrateur par d√©faut imm√©diatement apr√®s la premi√®re Connexion
- **Cr√©er l'utilisateur Comptes** : Cr√©ez des comptes Utilisateur individuels pour chaque personne qui a besoin d'acc√®s
- **V√©rifier les Journaux d'audit** : V√©rifiez r√©guli√®rement les Journaux d'audit pour la surveillance de la S√©curit√©
- **Configurer la r√©tention** : D√©finissez une p√©riode de r√©tention appropri√©e du Journal d'audit en fonction de vos exigences de conformit√©
- **Sauvegarde de la cl√© ma√Ætre** : Si vous effectuez une mise √† niveau √† partir de 0.8.x, assurez-vous que le Fichier `.duplistatus.key` est sauvegard√©

### √âtapes de premi√®re Connexion

1. **Se connecter** avec les identifiants par d√©faut (`admin` / `Duplistatus09`)
2. **Changer le mot de passe** lorsque vous y √™tes invit√© (forc√© √† la premi√®re Connexion)
3. **Cr√©er l'utilisateur comptes** pour les autres Utilisateurs (Param√®tres ‚Üí Utilisateurs)
4. **Configurer la r√©tention du Journal d'audit** si n√©cessaire (Param√®tres ‚Üí Journal d'Audit)
5. **V√©rifier les Journaux d'audit** pour v√©rifier que le Syst√®me fonctionne correctement

---

## üêõ Corrections de bogues

- Correction des probl√®mes de persistance de session lors des red√©marrages de Serveurs
- Am√©lioration de la gestion des Erreurs pour les √©checs d'authentification
- Am√©lioration des commentaires de validation du Mot de passe
- Correction des incoh√©rences de l'interface utilisateur dans la Page Param√®tres
- Am√©lioration des performances de filtrage du Journal d'Audit

---

## Points de terminaison API

### Points de terminaison d'authentification

- `POST /api/auth/login` - Authentification des Utilisateurs
- `POST /api/auth/logout` - R√©siliation de session
- `GET /api/auth/me` - Informations sur l'Utilisateur actuel
- `POST /api/auth/change-password` - Changement de Mot de passe

### Points de terminaison de Gestion des utilisateurs (Admin uniquement)

- `GET /api/users` - Lister les Utilisateurs
- `POST /api/users` - Cr√©er l'utilisateur
- `PATCH /api/users/{id}` - Mettre √† jour l'Utilisateur
- `DELETE /api/users/{id}` - Supprimer l'utilisateur

### Points de terminaison du Journal d'Audit

- `GET /api/audit-log` - Interroger les Journaux d'audit
- `GET /api/audit-log/download` - Exporter les Journaux d'audit
- `GET /api/audit-log/stats` - Statistiques d'audit
- `POST /api/audit-log/cleanup` - Nettoyage manuel (Admin uniquement)
- `GET /api/audit-log/retention` - Obtenir le Param√®tre de r√©tention
- `PATCH /api/audit-log/retention` - Mettre √† jour la r√©tention (Admin uniquement)

:::note
Tous les points de terminaison API n√©cessitent maintenant une authentification. Consultez la [R√©f√©rence API](../api-reference/authentication-security.md) pour plus de D√©tails sur l'authentification.
:::

---

## Support

### Obtenir de l'Aide

- **Documentation** : [Guide de l'utilisateur](../user-guide/overview.md)
- **R√©f√©rence API** : [Documentation API](../api-reference/authentication-security.md)
- **Guide de migration** : [Migration de mise √† niveau de version](../migration/version_upgrade.md)
- **R√©cup√©ration Admin** : [R√©cup√©ration du compte administrateur](../user-guide/admin-recovery.md)
- **Communaut√©** : [Discussions GitHub](https://github.com/wsj-br/duplistatus/discussions)
- **Probl√®mes** : [Probl√®mes GitHub](https://github.com/wsj-br/duplistatus/issues)

### Signaler des bogues

Lors de la signalisation de bogues, veuillez inclure :

- Version : 0.9.x
- Syst√®me d'exploitation et version
- Version de Docker
- Messages d'Erreur et Journaux
- √âtapes pour reproduire
- R√¥le d'Utilisateur (Admin/Utilisateur) le cas √©ch√©ant

---

## Journal des modifications

### Modifications d√©taill√©es

- **Ajout√©** : Syst√®me complet d'authentification et d'autorisation
- **Ajout√©** : Gestion des Utilisateurs avec contr√¥le d'acc√®s bas√© sur les r√¥les
- **Ajout√©** : Syst√®me complet de journalisation d'audit
- **Ajout√©** : Refonte de la Page Param√®tres avec barre lat√©rale r√©ductible
- **Ajout√©** : Outil CLI de r√©cup√©ration Admin
- **Ajout√©** : Application de la politique de Mot de passe
- **Ajout√©** : M√©canisme de verrouillage de compte
- **Ajout√©** : Gestion des sessions avec persistance en base de donn√©es
- **Modifi√©** : Toutes les Pages n√©cessitent maintenant une authentification
- **Modifi√©** : Sch√©ma de base de donn√©es de v3.1 √† v4.0
- **Modifi√©** : Stockage de session de la m√©moire √† la base de donn√©es
- **Modifi√©** : Mise en page et navigation de la Page Param√®tres
- **Corrig√©** : Persistance de session lors des red√©marrages de Serveurs
- **Corrig√©** : Diverses incoh√©rences de l'interface utilisateur
- **Am√©lior√©** : Posture de S√©curit√© avec journalisation d'audit compl√®te
- **Am√©lior√©** : Exp√©rience Utilisateur avec Pages de Connexion et Param√®tres modernes
- **Am√©lior√©** : Qualit√© du code avec interfaces TypeScript et principes DRY

---

## Licence

Ce projet est sous licence [Apache License 2.0](https://github.com/wsj-br/duplistatus/blob/main/LICENSE).

**Droits d'auteur ¬© 2025 Waldemar Scudeller Jr.**

