# Version 1.2.1

## vue d'ensemble

La Version 1.2.1 est une version mineure qui introduit des am√©liorations significatives √† la gestion des Notifications de sauvegarde, am√©liore les capacit√©s du Journal d'Audit, corrige la d√©tection de Prochaine ex√©cution/en retard sur les cas limites et ajoute la fonctionnalit√© de Sauvegarde de la base de donn√©es et de restauration. Cette version se concentre sur l'am√©lioration de l'exp√©rience utilisateur avec les Param√®tres de notification.

## Nouvelles fonctionnalit√©s

### Gestion am√©lior√©e des Notifications de sauvegarde

- **Valeurs par d√©faut au niveau du serveur et syst√®me d'h√©ritage** : Configurez les destinations suppl√©mentaires par d√©faut (√âv√©nements de notification, E-mails et Sujets NTFY) au niveau du serveur que Toutes les sauvegardes h√©ritent automatiquement. Les Sauvegardes peuvent remplacer ces valeurs Par d√©faut si n√©cessaire, avec des indicateurs visuels clairs montrant le statut d'h√©ritage.
- **Hi√©rarchie visuelle am√©lior√©e** : Les Sauvegardes sont maintenant group√©es par Serveurs avec des lignes d'en-t√™te de serveur distinctes. Les valeurs h√©rit√©es sont clairement marqu√©es avec des ic√¥nes de lien, et les valeurs remplac√©es peuvent √™tre facilement r√©tablies √† l'h√©ritage.
- **Op√©rations en masse** : Le bouton "Synchroniser avec Tous" efface Toutes les remplacements de sauvegarde pour que Toutes les sauvegardes h√©ritent des valeurs Par d√©faut du serveur. Le bouton "Effacer Tous" efface Toutes les destinations suppl√©mentaires tout en maintenant la structure d'h√©ritage.
- **Fonctionnalit√© de test** : Des boutons Tester l'E-mail et Tester la notification ont √©t√© ajout√©s directement dans la Page des Param√®tres de Notifications de sauvegarde. Les boutons de test sont disponibles pour les Param√®tres de sauvegarde individuels et les op√©rations de Modification en masse, ce qui vous permet de V√©rifier la livraison des Notifications avant d'appliquer les modifications.
- **Support du code QR** : Un bouton de code QR a √©t√© ajout√© pour les Sujets NTFY pour partager facilement les Sujets NTFY avec les appareils mobiles.

### Am√©liorations des mod√®les de notification

- **Nouvelle variable `{log_text}`** : La variable `{log_text}` a √©t√© ajout√©e aux Mod√®les de notification, fournissant l'acc√®s aux Messages de texte de journal pour une utilisation dans les Messages de Notifications. La variable contient le texte complet des Avertissements et des Erreurs combin√©s, format√©s en texte brut avec un √©l√©ment par ligne.
- **Migration automatique des mod√®les** : Le Syst√®me inclut un m√©canisme de mise √† niveau paresseux qui d√©tecte et met √† jour automatiquement les anciens Mod√®les Par d√©faut Quand ils sont d'abord lus apr√®s une mise √† niveau. Les Mod√®les Personnalis√©s sont conserv√©s inchang√©s.

### Gestion de la base de donn√©es

- **Fonctionnalit√© de Sauvegarde de la base de donn√©es** : Les administrateurs peuvent maintenant cr√©er des Sauvegardes de l'ensemble de la base de donn√©es √† partir de la Page des Param√®tres de Maintenance de la base de donn√©es. Prend en charge les formats binaires (.db) et texte SQL (.sql) pour la flexibilit√©.
- **Fonctionnalit√© de Restauration de la base de donn√©es** : Restaurez la base de donn√©es √† partir de fichiers de Sauvegarde pr√©c√©demment cr√©√©s avec cr√©ation automatique de Sauvegarde de s√©curit√©, validation d'int√©grit√© et restauration en cas d'√âchec. Toutes les sessions sont Effac√©es apr√®s la restauration pour la S√©curit√©.

### D√©tection de la cl√© principale

- **D√©tection automatique du changement de cl√© principale** : Apr√®s la Connexion, le Syst√®me v√©rifie automatiquement si le Fichier `.duplistatus.key` a chang√©. Si d√©tect√©, Tous les Mots de passe chiffr√©s sont Effac√©s et une fen√™tre contextuelle modale informe les Utilisateurs que les Mots de passe doivent √™tre reconfigur√©s. Cela emp√™che les Erreurs lors de la restauration √† partir de Sauvegardes ou de la migration vers un nouveau Syst√®me.

### Am√©liorations de la surveillance des sauvegardes en retard

- **Export CSV am√©lior√©** : La colonne "Horodatage de la derni√®re sauvegarde (DB)" a √©t√© ajout√©e au Fichier CSV g√©n√©r√© par le bouton "T√©l√©charger CSV" dans les Param√®tres de surveillance des sauvegardes en retard. Cela permet aux Utilisateurs de comparer l'Horodatage r√©el de la derni√®re sauvegarde de la base de donn√©es avec l'Horodatage de la Derni√®re sauvegarde configur√©.
- **Infobulle Prochaine ex√©cution** : Le survol de la valeur "Prochaine ex√©cution" dans chaque ligne affiche maintenant une infobulle montrant l'Horodatage de la derni√®re sauvegarde de la base de donn√©es, format√© de la m√™me mani√®re que l'affichage de la Prochaine ex√©cution.

### Am√©liorations de la journalisation d'audit

- **Entr√©es d'audit de notification individuelles** : Chaque Notification et E-mail envoy√© g√©n√®re maintenant une entr√©e de Journal d'Audit s√©par√©e avec des D√©tails √Ä propos du canal, de la configuration et du r√©sultat (Succ√®s ou √âchec). Cela inclut les Notifications de test, fournissant une meilleure tra√ßabilit√© pour la livraison des Notifications.
- **Journalisation robuste des √âchecs** : Toutes les op√©rations de Journal d'Audit pour les √âchecs de Notifications sont maintenant envelopp√©es dans des blocs try-catch pour emp√™cher les Erreurs de Journal d'Audit de casser les flux de Notifications. Le Syst√®me tente de r√©cup√©rer la configuration SMTP si elle n'est pas imm√©diatement disponible Quand l'enregistrement des √âchecs d'E-mail.
- **Journalisation d'audit am√©lior√©e pour les mises √† jour de configuration** : Les entr√©es de Journal d'Audit `email_config_updated` et `ntfy_config_updated` n'enregistrent maintenant que Quand il y a des modifications r√©elles √† la configuration. Quand des modifications sont d√©tect√©es, le Journal d'Audit inclut les anciennes et nouvelles valeurs pour chaque champ modifi√©, ce qui facilite le suivi de ce qui a sp√©cifiquement chang√©.

### Am√©liorations de la documentation

- Le style de la documentation a √©t√© mis √† jour pour s'aligner avec l'apparence et la convivialit√© de l'application. La barre lat√©rale a √©galement √©t√© r√©vis√©e pour am√©liorer la visibilit√© et faciliter la navigation.

---

## üêõ Corrections de bogues

- **Horodatages du Journal d'Audit corrig√©s** : Les Horodatages dans le Visualiseur de journal d'audit s'affichent maintenant correctement dans le Fuseau horaire du navigateur de l'Utilisateur au lieu de GMT. Les Horodatages SQLite (stock√©s en UTC) sont maintenant correctement analys√©s en UTC et convertis au Fuseau horaire local du navigateur pour l'affichage.
- **Calcul de "Prochaine ex√©cution" corrig√© et d√©tection en retard** : La colonne "Prochaine ex√©cution" dans les Param√®tres de surveillance des sauvegardes en retard calcule maintenant avec pr√©cision et affiche la Date de sauvegarde attendue suivante, en tenant compte √† la fois de la Planification de sauvegarde et de l'Horodatage de la derni√®re sauvegarde. Cela s'applique √† la fois aux travaux de sauvegarde planifi√©s et ex√©cut√©s manuellement, ce qui entra√Æne une d√©tection en retard plus fiable.

---

## üöÄ Notes de migration

### √Ä partir de la Version 1.1.x

Quand vous mettez √† niveau vers la Version 1.2.1 :

1. **Mod√®les de notification** : Le Syst√®me mettra automatiquement √† jour les Mod√®les de notification Par d√©faut pour inclure la nouvelle variable `{log_text}` la premi√®re fois qu'ils sont accessibles apr√®s la mise √† niveau. Les Mod√®les Personnalis√©s resteront inchang√©s. Si vous souhaitez utiliser la nouvelle variable `{log_text}` dans vos propres Mod√®les, vous devrez les mettre √† jour ou restaurer les Mod√®les Par d√©faut manuellement.

2. **Modifications de la cl√© principale** : Si vous restaurez √† partir d'une Sauvegarde ou migrez vers un nouveau Syst√®me avec un Fichier `.duplistatus.key` diff√©rent, le Syst√®me d√©tectera automatiquement cela et vous invitera √† reconfigurer les Mots de passe chiffr√©s (Mots de passe SMTP et Mots de passe du Serveur Duplicati).

3. **Sauvegarde/Restauration de la base de donn√©es** : La nouvelle fonctionnalit√© de Sauvegarde de la base de donn√©es et de restauration est disponible dans la Page des Param√®tres de Maintenance de la base de donn√©es. Il est recommand√© de cr√©er une Sauvegarde avant la mise √† niveau, bien qu'aucune modification de sch√©ma de base de donn√©es ne soit requise pour cette version.

4. **Aucune migration de base de donn√©es requise** : Cette version ne n√©cessite aucune modification de sch√©ma de base de donn√©es.

---

## Points de terminaison API

Les points de terminaison API suivants ont √©t√© introduits dans cette Version.

### Points de terminaison d'authentification et de s√©curit√©

- `GET /api/auth/admin-must-change-password` - V√©rifier si l'Utilisateur administrateur doit changer le Mot de passe

### Points de terminaison de gestion de la base de donn√©es

- `GET /api/database/backup` - Cr√©er une Sauvegarde de la base de donn√©es (format binaire ou SQL)
- `POST /api/database/restore` - Restaurer la base de donn√©es √† partir du Fichier de Sauvegarde

### Points de terminaison de gestion des sauvegardes

- `GET /api/backups/last-timestamps` - Obtenir les Horodatages de la derni√®re sauvegarde pour Toutes les combinaisons serveur-sauvegarde

---

## Assistance

### Obtenir de l'aide

- **Documentation** : [Guide de l'Utilisateur](../user-guide/overview.md)
- **Param√®tres E-mail** : [Guide de configuration e-mail](../user-guide/settings/email-settings.md)
- **R√©f√©rence API** : [Documentation API](../api-reference/overview.md)
- **Guide de migration** : [Migration de mise √† niveau de Version](../migration/version_upgrade.md)
- **Communaut√©** : [Discussions GitHub](https://github.com/wsj-br/duplistatus/discussions)
- **Probl√®mes** : [Probl√®mes GitHub](https://github.com/wsj-br/duplistatus/issues)

### Signaler des bogues

Quand vous signalez des bogues, veuillez inclure :

- Version : 1.2.1
- Syst√®me d'exploitation et Version
- Version Docker/podman
- Type de conteneur (Docker ou podman/Pod)
- Messages d'Erreur et Journaux
- √âtapes pour reproduire

---

## Journal des modifications

### Modifications de la Version 1.2.1

- **Ajout√©** : Syst√®me de valeurs Par d√©faut au niveau du serveur et d'h√©ritage pour les Notifications de sauvegarde
- **Ajout√©** : Fonctionnalit√© Tester l'E-mail et Tester la notification dans les Param√®tres de Notifications de sauvegarde
- **Ajout√©** : Bouton de code QR pour les Sujets NTFY
- **Ajout√©** : Colonne "Horodatage de la derni√®re sauvegarde (DB)" √† l'export CSV de surveillance des sauvegardes en retard
- **Ajout√©** : Infobulle au texte "Prochaine ex√©cution" dans les Param√®tres de surveillance des sauvegardes en retard
- **Ajout√©** : Entr√©es de Journal d'Audit individuelles pour chaque Notification et E-mail envoy√©
- **Ajout√©** : Robustesse am√©lior√©e de la journalisation d'audit pour les √âchecs de Notifications
- **Ajout√©** : Variable `{log_text}` aux Mod√®les de notification avec migration automatique des mod√®les
- **Ajout√©** : D√©tection automatique des modifications du Fichier de cl√© principale
- **Ajout√©** : Fonctionnalit√© de Sauvegarde de la base de donn√©es (formats binaire et SQL)
- **Ajout√©** : Fonctionnalit√© de Restauration de la base de donn√©es avec Sauvegardes de s√©curit√© et validation d'int√©grit√©
- **Ajout√©** : Point de terminaison API `GET /api/auth/admin-must-change-password` pour V√©rifier l'exigence de modification du Mot de passe administrateur
- **Ajout√©** : Point de terminaison API `GET /api/database/backup` pour cr√©er des Sauvegardes de la base de donn√©es
- **Ajout√©** : Point de terminaison API `POST /api/database/restore` pour restaurer la base de donn√©es √† partir de la Sauvegarde
- **Ajout√©** : Point de terminaison API `GET /api/backups/last-timestamps` pour r√©cup√©rer les Horodatages de la derni√®re sauvegarde
- **Modifi√©** : Journalisation d'audit am√©lior√©e pour les mises √† jour de configuration E-mail et NTFY (enregistre uniquement les modifications r√©elles)
- **Modifi√©** : Les formulaires de modification de Mot de passe ne n√©cessitent plus de confirmation Quand les Mots de passe non masqu√©s sont affich√©s.
- **Modifi√©** : Les Mots de passe sont s√©curis√©s Effac√©s de la m√©moire Quand les formulaires de modification de Mot de passe sont Ferm√©s.
- **Modifi√©** : Inclusion d'un bouton d'affichage du Mot de passe dans le formulaire de Collecter les sauvegardes.
- **Modifi√©** : La variable `{server_alias}` affiche maintenant le Nom du serveur entre crochets
- **Modifi√©** : Documentation mise √† jour, style align√© avec l'application et barre lat√©rale refactoris√©e.
- **Corrig√©** : Horodatages du Journal d'Audit affich√©s en GMT au lieu du Fuseau horaire du navigateur
- **Corrig√©** : Journalisation d'audit des √âchecs d'E-mail et NTFY
- **Corrig√©** : Affichage de "Prochaine ex√©cution" dans les Param√®tres de surveillance des sauvegardes en retard affichant des dates incorrectes

---

## Licence

Ce projet est sous licence [Apache License 2.0](https://github.com/wsj-br/duplistatus/blob/main/LICENSE).

**Droits d'auteur ¬© 2025 Waldemar Scudeller Jr.**
