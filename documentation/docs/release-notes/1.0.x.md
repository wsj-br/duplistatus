
# Version 1.0.x

## Overview

Version 1.0.x is a feature release that introduces significant enhancements to email configuration, server management capabilities, and database maintenance tools. This release focuses on improving email notification reliability, expanding SMTP connection options, and providing better tools for managing servers and database integrity.

Version 1.0.4 is an intermediate version that includes critical fixes for overdue backup detection, Node.js 25.x compatibility improvements, and important changes to documentation hosting and container architecture. **Note**: Version 1.0.4 requires special configuration to work inside a Pod (podman) and is designed to work inside a standard podman container.

## New Features

### Server Management Enhancements

- **Server password change functionality** - Users can now change server passwords directly from the server detail page by clicking on the key icon
- **Duplicate server detection and merging** - New function in the Database maintenance form to detect duplicate servers and merge them into a single server entry

### Audit Logging Enhancements

- **Backup upload audit logging** - All backup log uploads via the `/api/upload` endpoint are now automatically logged in the audit log. Each entry includes comprehensive backup details (server ID, server name, backup name, status, date, duration, file counts, sizes, warnings, and errors) along with client IP address and user agent information for tracking and security purposes

### Email Configuration Enhancements

- **Configuration incomplete notice** - Visual alert displayed when email settings are not properly configured
- **Service status indicators** - "(disabled)" labels shown on notification checkboxes when email services are not configured
- **Customizable sender information**:
  - `Sender Name` field for customizing the display name shown as the sender in email notifications
  - `From Address` field for specifying the email address shown as the sender
  - Note: Some email providers will override the `From Address` with the `SMTP Server Username`
- **SMTP authentication toggle** - Option to enable or disable SMTP authentication, supporting servers that don't require authentication
- **Email format validation** - Validation for recipient and from address fields to ensure proper email address format
- **Enhanced test email** - Test email now displays comprehensive connection details including SMTP server hostname, port, connection type, authentication status, username (if applicable), recipient email, from address, sender name, and test timestamp

### SMTP Connection Type Support

- **Multiple connection types** - Support for three connection types:
  - `Plain SMTP` (no encryption) on port 25
  - `STARTTLS` (upgrade to TLS) on port 587
  - `Direct SSL/TLS` (encrypted from start) on port 465
- **Default connection type** - Changed to `Direct SSL/TLS` for new configurations
- **Connection-specific requirements** - `From Address` field is required for `Plain SMTP` connections to ensure proper email sender identification and RFC 5322 compliance

### Documentation Enhancements

- **Screenshot automation** - Completed the take screenshots script to capture all screenshots for the documentation automatically

### Version 1.0.4 Enhancements

- **Right-click context menu on auto-refresh button** - Right-clicking on the auto-refresh button in the application toolbar now opens the Display Settings page for quick access to display preferences
- **Documentation hosting migration** - Documentation has been moved from the Docker container image to GitHub Pages at https://wsj-br.github.io/duplistatus/user-guide/overview for improved accessibility and easier updates
- **Container architecture improvements** - Docker/runtime now runs Next.js standalone (`server.js`) and bundles the cron service into a single JS file to reduce container size and improve efficiency
- **Podman container support** - Version 1.0.4 is designed to work inside a standard podman container and requires special configuration when running inside a Pod (podman)

---

## üêõ Bug Fixes

### Email System Fixes

- **Fixed missing `From` header** - Resolved RFC 5322 compliance errors by ensuring all email messages include proper `From` headers
- **Fixed email encryption for STARTTLS** - Corrected encryption handling for `STARTTLS` connections (port 587)
- **Fixed Plain SMTP connections** - Resolved TLS negotiation errors that were causing `Plain SMTP` connections to fail
- **Fixed unsaved configuration loss** - Prevented unsaved email configuration from being cleared when changing password
- **Fixed stale SMTP configuration** - Resolved issue where test email endpoint was using outdated SMTP configuration

### User Interface Fixes

- **Fixed password visibility toggle** - Corrected behavior of the view password feature in the password change form; clicking the eye icon now shows the password for both password fields simultaneously

### System Fixes

- **Fixed Docker entrypoint logging** - Resolved issue where Docker entrypoint script was dropping log messages
- **Fixed Next Run date calculation** - Added automatic recalculation of the `Next Run` date after collecting backup logs, ensuring the date is updated correctly after log collection

### Version 1.0.4 Fixes

- **Critical: Fixed overdue backup detection** - Completely reimplemented overdue backup detection system with a new algorithm that properly implements the `time` field as a moving target:
  - Added `lastBackupDate` field to `BackupNotificationConfig` to track actual backup receipts
  - The `time` field now represents the next expected backup date, calculated as a moving target that preserves the original schedule time-of-day
  - **Key improvement**: Algorithm ensures manual backups don't change scheduled backup times (e.g., manual backup at 10pm won't change a 2pm schedule)
  - The algorithm uses: `while (time <= lastBackupDate) { time = time + interval }` to advance the expected time
  - `time` is automatically updated whenever a new backup arrives via `getConfigBackupSettings()`
  - Overdue detection is now simple: `currentTime > time + tolerance` (no complex recalculation needed)
  - Fixed "Next Run" column in overdue monitoring settings showing incorrect dates
  - Both `/api/upload` and `/api/backups/collect` endpoints now immediately update backup settings after receiving backups
  - Works correctly with direct database writes (e.g., generate-test-data script)
  - For new servers without Duplicati sync, uses the first backup's time-of-day as the schedule reference
- **Fixed ES module compatibility with Node.js 25.x** - Replaced all `require()` statements with proper ES6 `import` statements across the codebase:
  - Updated `db.ts`, `next.config.ts`, `tailwind.config.ts`, and Docusaurus components
  - Ensures full compatibility with Node.js 25.x strict ES module requirements
- **Fixed missing file extensions in imports** - Added `.ts` file extensions to dynamic imports to comply with strict ES module resolution in `db.ts` and `scripts/take-screenshots.ts`
- **Fixed React linter errors and warnings**:
  - Fixed unescaped apostrophe in database maintenance form
  - Added proper eslint-disable comment for legitimate set-state-in-effect pattern
  - Removed 13 unused eslint-disable directives
  - Fixed missing dependencies in useEffect hooks
- **Fixed Next.js proxy and build issues**:
  - Updated proxy to provide `x-pathname` / `x-search-params` headers for server components
  - Removed custom Node server in favor of Next.js standalone output + proxy
  - Fixed `pnpm start-local` to properly serve static files in standalone mode
  - Fixed `pnpm build-local` to build and copy Docusaurus documentation before Next.js build
- **Reduced console logging** - AuditLogger now only logs failed login attempts to console; all other audit entries are written to database only

---

## üöÄ Migration Notes

### From Version 0.9.x

This release includes enhancements to email configuration and server management. When upgrading from version 0.9.x:

1. **No Database Migration Required** - This release does not require any database schema changes
2. **Email Configuration Updates** - Existing email configurations will continue to work, but you may want to review and update your settings to take advantage of new features:
   - Consider setting a custom `Sender Name` for better email identification
   - Verify your `From Address` is set correctly, especially if using `Plain SMTP` connections
   - Test your email configuration using the enhanced test email feature
3. **Connection Type Default** - New email configurations will default to `Direct SSL/TLS` connection type
4. **Server Password Management** - You can now change server passwords directly from the server detail page without needing to re-collect backups

### Email Configuration Recommendations

- **For production use**: Use `STARTTLS` or `Direct SSL/TLS` connections for secure email delivery
- **For local testing**: `Plain SMTP` connections are available for trusted local networks
- **From Address requirement**: When using `Plain SMTP` or when authentication is disabled, ensure the `From Address` field is properly configured
- **Test your configuration**: Always use the "Send Test Email" button to verify your email setup works correctly

### From Version 1.0.3 to 1.0.4

> **Note**: Version 1.0.4 is an intermediate version that includes critical bug fixes and compatibility improvements. It is recommended for users experiencing issues with overdue backup detection or running on Node.js 25.x.

When upgrading to version 1.0.4:

1. **Documentation Location Change** - Documentation is now hosted on GitHub Pages instead of being included in the Docker container. The User Guide link in the app header now points to the external documentation site
2. **Podman Container Configuration** - Version 1.0.4 requires special configuration to work inside a Pod (podman). Ensure your podman container is configured according to the standard podman container requirements
3. **Container Architecture** - The container now uses Next.js standalone mode and bundles the cron service into a single file, which may affect resource usage and startup behavior
4. **Overdue Backup Detection** - The overdue backup detection system has been completely reimplemented with a new algorithm that preserves schedule time-of-day. Existing overdue monitoring configurations will continue to work, but the underlying calculation method has been improved for accuracy. You may notice more accurate "Next Run" dates in the overdue monitoring settings. The new algorithm ensures that manual backups don't shift scheduled backup times
5. **Node.js Compatibility** - This version is fully compatible with Node.js 25.x. If you're upgrading from an older Node.js version, ensure you're running Node.js >=24.12.0
6. **No Database Migration Required** - This release does not require any database schema changes

---

## API Endpoints

### Email Configuration Endpoints

- `GET /api/email/config` - Get email configuration
- `POST /api/email/config` - Update email configuration
- `POST /api/email/test` - Send test email
- `DELETE /api/email/config` - Delete email configuration

### Server Management Endpoints

- `PATCH /api/servers/{id}/password` - Update server password
- `POST /api/database/maintenance/merge-duplicate-servers` - Merge duplicate servers

> [!NOTE]
> All API endpoints require authentication. See the [API Reference](../api-reference/authentication-security.md) for details.

---

## Support

### Getting Help

- **Documentation**: [User Guide](../user-guide/overview.md)
- **Email Settings**: [Email Configuration Guide](../user-guide/settings/email-settings.md)
- **API Reference**: [API Documentation](../api-reference/overview.md)
- **Migration Guide**: [Version Upgrade Migration](../migration/version_upgrade.md)
- **Community**: [GitHub Discussions](https://github.com/wsj-br/duplistatus/discussions)
- **Issues**: [GitHub Issues](https://github.com/wsj-br/duplistatus/issues)

### Reporting Bugs

When reporting bugs, please include:
- Version: 1.0.x (specify exact version, e.g., 1.0.4)
- Operating system and version
- Docker/podman version
- Container type (Docker or podman/Pod)
- Error messages and logs
- Steps to reproduce
- Email configuration details (if email-related)
- Podman configuration details (if running in podman/Pod)

---

## Changelog

### Detailed Changes

- **Added**: Server password change functionality from server detail page
- **Added**: Duplicate server detection and merging in database maintenance
- **Added**: `Sender Name` and `From Address` fields to email configuration
- **Added**: Support for `Plain SMTP` connections (port 25)
- **Added**: Connection type selection (`Plain SMTP`, `STARTTLS`, `Direct SSL/TLS`)
- **Added**: SMTP authentication requirement toggle
- **Added**: Email format validation for recipient and from address fields
- **Added**: Enhanced test email with comprehensive connection details
- **Added**: Configuration incomplete notice for email settings
- **Added**: "(disabled)" labels on notification checkboxes when services are not configured
- **Added**: Audit log entries for backup log uploads via `/api/upload` endpoint
- **Changed**: Default connection type to `Direct SSL/TLS` for new configurations
- **Changed**: `From Address` field is now required for `Plain SMTP` connections
- **Fixed**: Missing `From` header in email messages (RFC 5322 compliance)
- **Fixed**: Email encryption for `STARTTLS` connections
- **Fixed**: `Plain SMTP` connections failing with TLS negotiation errors
- **Fixed**: Unsaved email configuration being cleared when changing password
- **Fixed**: Stale SMTP configuration in test email endpoint
- **Fixed**: Password visibility toggle in password change form
- **Fixed**: Docker entrypoint script dropping log messages
- **Fixed**: `Next Run` date not being recalculated after collecting backup logs
- **Improved**: Email configuration user experience with better validation and feedback
- **Improved**: Documentation with automated screenshot capture

### Version 1.0.4 Changes

- **Added**: Right-click context menu on auto-refresh button to open Display Settings
- **Added**: `lastBackupDate` field to `BackupNotificationConfig` for tracking backup receipts
- **Added**: `expectedBackupDate` and `lastBackupDate` fields to `ServerWithBackup` interface
- **Changed**: Removed documentation from Docker container image (now hosted on GitHub Pages)
- **Changed**: Updated app header User Guide link to point to GitHub Pages documentation
- **Changed**: Simplified proxy.ts by removing Docusaurus URL rewriting logic
- **Changed**: Reduced console logging from AuditLogger (only failed login attempts logged to console)
- **Changed**: Docker/runtime now runs Next.js standalone and bundles cron service into single JS file
- **Changed**: Updated `generate-test-data.ts` to pre-configure notification settings and improve overdue backup generation
- **Fixed**: Critical overdue backup detection by properly implementing `time` field as moving target (see [Overdue Detection Algorithm](https://github.com/wsj-br/duplistatus/blob/main/dev/OVERDUE_DETECTION_ALGORITHM.md) for details)
- **Fixed**: ES module compatibility issues with Node.js 25.x (replaced `require()` with ES6 `import`)
- **Fixed**: Missing `.ts` file extensions in import statements for strict ES module resolution
- **Fixed**: React linter errors and warnings (unescaped apostrophes, missing dependencies, unused directives)
- **Fixed**: Next.js proxy file to provide proper headers for server components
- **Fixed**: Removed custom Node server in favor of Next.js standalone output + proxy
- **Fixed**: `pnpm start-local` script to properly serve static files in standalone mode
- **Fixed**: `pnpm build-local` to build Docusaurus documentation before Next.js build
- **Fixed**: "Next Run" column in overdue monitoring settings showing incorrect dates

---

## License

This project is licensed under the [Apache License 2.0](https://github.com/wsj-br/duplistatus/blob/main/LICENSE).

**Copyright ¬© 2025 Waldemar Scudeller Jr.**
