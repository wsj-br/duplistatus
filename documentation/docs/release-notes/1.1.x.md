# Version 1.1.x

## Overview

Version 1.1.x is a minor release that addresses critical issues with overdue backup detection, improves Node.js 25.x compatibility, and introduces significant container architecture improvements. This release focuses on architectural changes to the HTTP server implementation (migration to Next.js standalone mode) and container optimizations.

**Note**: Version 1.1.0 requires special configuration to work inside a Pod (podman) and is designed to work inside a standard podman container.

## New Features

### User Interface Enhancements

- **Right-click context menu on auto-refresh button** - Right-clicking on the auto-refresh button in the application toolbar now opens the Display Settings page for quick access to display preferences

### Documentation Improvements

- **Documentation hosting migration** - Documentation has been moved from the Docker container image to GitHub Pages at https://wsj-br.github.io/duplistatus/user-guide/overview for improved accessibility and easier updates
- The User Guide link in the app header now points to the external documentation site

### Container Architecture Improvements

- **Next.js standalone mode** - Docker/runtime now runs Next.js standalone (`server.js`) and bundles the cron service into a single JS file to reduce container size and improve efficiency
- **Podman container support** - Version 1.1.0 is designed to work inside a standard podman container and requires special configuration when running inside a Pod (podman)

---

## üêõ Bug Fixes

### Critical: Overdue Backup Detection - Complete Reimplementation

- **Fixed overdue backup detection** - Completely reimplemented overdue backup detection system with a new algorithm that properly implements the `time` field as a moving target:
  - Added `lastBackupDate` field to `BackupNotificationConfig` to track actual backup receipts
  - The `time` field now represents the next expected backup date, calculated as a moving target that preserves the original schedule time-of-day
  - **Key improvement**: Algorithm ensures manual backups don't change scheduled backup times (e.g., manual backup at 10pm won't change a 2pm schedule)
  - The algorithm uses: `while (time <= lastBackupDate) { time = time + interval }` to advance the expected time
  - `time` is automatically updated whenever a new backup arrives via `getConfigBackupSettings()`
  - Overdue detection is now simple: `currentTime > time + tolerance` (no complex recalculation needed)
  - Fixed "Next Run" column in overdue monitoring settings showing incorrect dates
  - Both `/api/upload` and `/api/backups/collect` endpoints now immediately update backup settings after receiving backups
  - Works correctly with direct database writes (e.g., generate-test-data script)
  - For new servers without Duplicati sync, uses the first backup's time-of-day as the schedule reference
  - For more details, see the [Overdue Detection Algorithm](https://github.com/wsj-br/duplistatus/blob/main/dev/OVERDUE_DETECTION_ALGORITHM.md) documentation

### Node.js 25.x Compatibility

- **Fixed ES module compatibility** - Replaced all `require()` statements with proper ES6 `import` statements across the codebase:
  - Updated `db.ts`, `next.config.ts`, `tailwind.config.ts`, and Docusaurus components
  - Ensures full compatibility with Node.js 25.x strict ES module requirements

- **Fixed missing file extensions in imports** - Added `.ts` file extensions to dynamic imports to comply with strict ES module resolution in `db.ts` and `scripts/take-screenshots.ts`

### Code Quality

- **Fixed React linter errors and warnings**:
  - Fixed unescaped apostrophe in database maintenance form
  - Added proper eslint-disable comment for legitimate set-state-in-effect pattern
  - Removed 13 unused eslint-disable directives
  - Fixed missing dependencies in useEffect hooks

### Build and Development

- **Fixed Next.js proxy and build issues**:
  - Updated proxy to provide `x-pathname` / `x-search-params` headers for server components
  - Removed custom Node server in favor of Next.js standalone output + proxy
  - Fixed `pnpm start-local` to properly serve static files in standalone mode
  - Fixed `pnpm build-local` to build and copy Docusaurus documentation before Next.js build

### System Improvements

- **Reduced console logging** - AuditLogger now only logs failed login attempts to console; all other audit entries are written to database only
- **Simplified proxy.ts** - Removed Docusaurus URL rewriting logic (no longer needed)

### Test Data Generation

- **Improved test data generation** - Updated `generate-test-data.ts` to:
  - Pre-configure notification settings (disabling `ntfy`) for newly generated test servers, preventing notification spam during testing
  - Properly create overdue backups with correct date calculations

---

## üöÄ Migration Notes

### From Version 1.0.x

When upgrading to version 1.1.0:

1. **Documentation Location Change** - Documentation is now hosted on GitHub Pages instead of being included in the Docker container. The User Guide link in the app header now points to the external documentation site

2. **Podman Container Configuration** - Version 1.1.0 requires special configuration to work inside a Pod (podman). Ensure your podman container is configured according to the standard podman container requirements

3. **Container Architecture** - The container now uses Next.js standalone mode and bundles the cron service into a single file, which may affect resource usage and startup behavior. This is a significant architectural change that improves container efficiency

4. **Overdue Backup Detection** - The overdue backup detection system has been completely reimplemented with a new algorithm that preserves schedule time-of-day. Existing overdue monitoring configurations will continue to work, but the underlying calculation method has been improved for accuracy. You may notice more accurate "Next Run" dates in the overdue monitoring settings. The new algorithm ensures that manual backups don't shift scheduled backup times

5. **Node.js Compatibility** - This version is fully compatible with Node.js 25.x. If you're upgrading from an older Node.js version, ensure you're running Node.js >=24.12.0

6. **No Database Migration Required** - This release does not require any database schema changes

---

## API Endpoints

No new API endpoints were added in this release. All existing endpoints remain unchanged.

> [!NOTE]
> All API endpoints require authentication. See the [API Reference](../api-reference/authentication-security.md) for details.

---

## Support

### Getting Help

- **Documentation**: [User Guide](../user-guide/overview.md)
- **Email Settings**: [Email Configuration Guide](../user-guide/settings/email-settings.md)
- **API Reference**: [API Documentation](../api-reference/overview.md)
- **Migration Guide**: [Version Upgrade Migration](../migration/version_upgrade.md)
- **Community**: [GitHub Discussions](https://github.com/wsj-br/duplistatus/discussions)
- **Issues**: [GitHub Issues](https://github.com/wsj-br/duplistatus/issues)

### Reporting Bugs

When reporting bugs, please include:
- Version: 1.1.x (specify exact version, e.g., 1.1.0)
- Operating system and version
- Docker/podman version
- Container type (Docker or podman/Pod)
- Error messages and logs
- Steps to reproduce
- Podman configuration details (if running in podman/Pod)

---

## Changelog

### Version 1.1.0 Changes

- **Added**: Right-click context menu on auto-refresh button to open Display Settings
- **Added**: `lastBackupDate` field to `BackupNotificationConfig` for tracking backup receipts
- **Added**: `expectedBackupDate` and `lastBackupDate` fields to `ServerWithBackup` interface
- **Changed**: Removed documentation from Docker container image (now hosted on GitHub Pages)
- **Changed**: Updated app header User Guide link to point to GitHub Pages documentation
- **Changed**: Simplified proxy.ts by removing Docusaurus URL rewriting logic
- **Changed**: Reduced console logging from AuditLogger (only failed login attempts logged to console)
- **Changed**: Docker/runtime now runs Next.js standalone and bundles cron service into single JS file
- **Changed**: Updated `generate-test-data.ts` to pre-configure notification settings and improve overdue backup generation
- **Fixed**: Critical overdue backup detection by properly implementing `time` field as moving target (see [Overdue Detection Algorithm](https://github.com/wsj-br/duplistatus/blob/main/dev/OVERDUE_DETECTION_ALGORITHM.md) for details)
- **Fixed**: ES module compatibility issues with Node.js 25.x (replaced `require()` with ES6 `import`)
- **Fixed**: Missing `.ts` file extensions in import statements for strict ES module resolution
- **Fixed**: React linter errors and warnings (unescaped apostrophes, missing dependencies, unused directives)
- **Fixed**: Next.js proxy file to provide proper headers for server components
- **Fixed**: Removed custom Node server in favor of Next.js standalone output + proxy
- **Fixed**: `pnpm start-local` script to properly serve static files in standalone mode
- **Fixed**: `pnpm build-local` to build Docusaurus documentation before Next.js build
- **Fixed**: "Next Run" column in overdue monitoring settings showing incorrect dates

---

## License

This project is licensed under the [Apache License 2.0](https://github.com/wsj-br/duplistatus/blob/main/LICENSE).

**Copyright ¬© 2025 Waldemar Scudeller Jr.**

