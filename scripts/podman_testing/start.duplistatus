#!/bin/bash

if [ -f ".env" ]; then
    set -a  # automatically export all variables
    source .env
    set +a  # disable automatic export

else
    echo "Error: .env file not found"
    echo "Please create a .env file in the current directory with the following variables:"
    echo ""
    echo "IMAGE=your_image_name"
    echo "REMOTE_USER=your_username"
    echo "REMOTE_HOST=your_hostname"
    echo ""
    echo "Example:"
    echo ""
    echo "IMAGE=wsj-br/duplistatus:devel"
    echo "REMOTE_USER=devel"
    echo "REMOTE_HOST=devel-server"
    exit 1
fi

# create the folder (if not exist)
mkdir -p data

# adjust ownership and permissions of the folder /root/duplistatus_home/data

# stop the container duplistatus
./stop.duplistatus

echo ""
echo "running the container duplistatus"

# Run standalone
podman run -d \
  --userns=keep-id \
  --name duplistatus \
  -p 9666:9666 \
  -v ./data:/app/data \
  $IMAGE


echo ""
echo ""
echo "containers running:"
echo ""
podman ps

echo ""

sleep 5
./logs.duplistatus

echo ""
echo "check the container health with ./check.duplistatus"
echo "check the container logs   with ./logs.duplistatus"
echo "open a shell in the container with ./exec.shell.duplistatus"
echo ""
