"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[7740],{23126(e,s,n){n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>c,default:()=>p,frontMatter:()=>t,metadata:()=>a,toc:()=>o});const a=JSON.parse('{"id":"development/test-scripts","title":"Scripts de Prueba","description":"test-scripts}","source":"@site/i18n/es/docusaurus-plugin-content-docs/current/development/test-scripts.md","sourceDirName":"development","slug":"/development/test-scripts","permalink":"/duplistatus/es/development/test-scripts","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"translation_last_updated":"2026-02-16T02:21:39.147Z","source_file_mtime":"2026-02-16T00:30:39.430Z","source_file_hash":"6f3df4c1ef3576bd","translation_language":"es","source_file_path":"development/test-scripts.md"},"sidebar":"mainSidebar","previous":{"title":"Gesti\xf3n de Versiones","permalink":"/duplistatus/es/development/release-management"},"next":{"title":"Scripts y Comandos de Admin del Workspace","permalink":"/duplistatus/es/development/workspace-admin-scripts-commands"}}');var i=n(36259),r=n(73230);const t={translation_last_updated:"2026-02-16T02:21:39.147Z",source_file_mtime:"2026-02-16T00:30:39.430Z",source_file_hash:"6f3df4c1ef3576bd",translation_language:"es",source_file_path:"development/test-scripts.md"},c="Scripts de Prueba {#test-scripts}",l={},o=[{value:"Generar Datos de Prueba",id:"generate-test-data",level:2},{value:"Mostrar el contenido de las notificaciones retrasadas (para depurar el sistema de notificaciones)",id:"show-the-overdue-notifications-contents-to-debug-notification-system",level:2},{value:"Ejecutar verificaci\xf3n de retrasado en una fecha/hora espec\xedfica (para depurar el sistema de notificaciones)",id:"run-overdue-check-at-a-specific-datetime-to-debug-notification-system",level:2},{value:"Probar la conectividad del puerto del servicio cron",id:"test-cron-service-port-connectivity",level:2},{value:"Probar detecci\xf3n de retrasado",id:"test-overdue-detection",level:2},{value:"Validar exportaci\xf3n CSV",id:"validate-csv-export",level:2},{value:"Bloquear temporalmente el servidor NTFY (para pruebas)",id:"temporarily-block-ntfy-server-for-testing",level:2},{value:"Pruebas de Migraci\xf3n de Base de Datos",id:"database-migration-testing",level:2},{value:"Generar Datos de Prueba de Migraci\xf3n",id:"generate-migration-test-data",level:3},{value:"Migraciones de Base de Datos de Prueba",id:"test-database-migrations",level:3},{value:"Configurar Prueba de Configuraci\xf3n SMTP",id:"set-smtp-test-configuration",level:2},{value:"Probar Tipo de conexi\xf3n SMTP Compatibilidad cruzada",id:"test-smtp-connection-type-cross-compatibility",level:2},{value:"Probar Script de Punto de Entrada de Docker",id:"test-docker-entrypoint-script",level:2}];function d(e){const s={code:"code",div:"div",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"test-scripts",children:"Scripts de Prueba"})}),"\n",(0,i.jsx)(s.p,{children:"El proyecto incluye varios scripts de prueba para ayudar con el desarrollo y las pruebas:"}),"\n",(0,i.jsx)(s.h2,{id:"generate-test-data",children:"Generar Datos de Prueba"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"pnpm generate-test-data --servers=N\n"})}),"\n",(0,i.jsx)(s.p,{children:"Este script genera datos de backup de prueba para m\xfaltiples servidores y backups."}),"\n",(0,i.jsxs)(s.p,{children:["El par\xe1metro ",(0,i.jsx)(s.code,{children:"--servers=N"})," es ",(0,i.jsx)(s.strong,{children:"obligatorio"})," y especifica la cantidad de servidores a generar (1-30)."]}),"\n",(0,i.jsxs)(s.p,{children:["Utilice la opci\xf3n ",(0,i.jsx)(s.code,{children:"--upload"})," para enviar los datos generados a ",(0,i.jsx)(s.code,{children:"/api/upload"})]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"pnpm generate-test-data --servers=N --upload\n"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Ejemplos:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Generate data for 5 servers\npnpm generate-test-data --servers=5\n\n# Generate data for 1 server with upload mode\npnpm generate-test-data --upload --servers=1\n\n# Generate data for all 30 servers\npnpm generate-test-data --servers=30\n"})}),"\n",(0,i.jsxs)(s.div,{className:"markdown-alert markdown-alert-caution",children:["\n",(0,i.jsxs)(s.p,{className:"markdown-alert-title",children:[(0,i.jsx)(s.span,{className:"octicon octicon-caution",style:{"--oct-icon":"url(\"data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' class='octicon octicon-stop mr-2' viewBox='0 0 16 16' version='1.1' width='16' height='16' aria-hidden='true'%3E%3Cpath d='M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z'%3E%3C/path%3E%3C/svg%3E\")"}}),"Caution"]}),"\n",(0,i.jsx)(s.p,{children:"Este script elimina todos los datos anteriores en la base de datos y los reemplaza con datos de prueba.\nRealice una copia de seguridad de su base de datos antes de ejecutar este script."}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"show-the-overdue-notifications-contents-to-debug-notification-system",children:"Mostrar el contenido de las notificaciones retrasadas (para depurar el sistema de notificaciones)"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"pnpm show-overdue-notifications\n"})}),"\n",(0,i.jsx)(s.h2,{id:"run-overdue-check-at-a-specific-datetime-to-debug-notification-system",children:"Ejecutar verificaci\xf3n de retrasado en una fecha/hora espec\xedfica (para depurar el sistema de notificaciones)"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'pnpm run-overdue-check "YYYY-MM-DD HH:MM:SS"\n'})}),"\n",(0,i.jsx)(s.h2,{id:"test-cron-service-port-connectivity",children:"Probar la conectividad del puerto del servicio cron"}),"\n",(0,i.jsx)(s.p,{children:"Para probar la conectividad del servicio cron, puede:"}),"\n",(0,i.jsx)(s.p,{children:"Verificar si el servicio cron se est\xe1 ejecutando:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"curl http://localhost:8667/health\n"})}),"\n",(0,i.jsxs)(s.ol,{start:"2",children:["\n",(0,i.jsx)(s.li,{children:"O utilice los puntos finales de la API del servicio cron directamente a trav\xe9s de la aplicaci\xf3n principal:"}),"\n"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"curl http://localhost:8666/api/cron/health\n"})}),"\n",(0,i.jsxs)(s.ol,{start:"3",children:["\n",(0,i.jsx)(s.li,{children:"Utilice el script de prueba para verificar la conectividad del puerto:"}),"\n"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"pnpm test-cron-port\n"})}),"\n",(0,i.jsx)(s.p,{children:"Este script prueba la conectividad al puerto del servicio cron y proporciona informaci\xf3n detallada sobre el estado de la conexi\xf3n."}),"\n",(0,i.jsx)(s.h2,{id:"test-overdue-detection",children:"Probar detecci\xf3n de retrasado"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"pnpm test-overdue-detection\n"})}),"\n",(0,i.jsx)(s.p,{children:"Este script prueba la l\xf3gica de detecci\xf3n de backup retrasado. Verifica:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Identificaci\xf3n de backup retrasado"}),"\n",(0,i.jsx)(s.li,{children:"Activaci\xf3n de notificaciones"}),"\n",(0,i.jsx)(s.li,{children:"C\xe1lculos de fecha/hora para estado retrasado"}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"\xdatil para depurar sistemas de detecci\xf3n y notificaci\xf3n de backups retrasados."}),"\n",(0,i.jsx)(s.h2,{id:"validate-csv-export",children:"Validar exportaci\xf3n CSV"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"pnpm validate-csv-export\n"})}),"\n",(0,i.jsx)(s.p,{children:"Este script valida la funcionalidad de exportaci\xf3n CSV. Realiza lo siguiente:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Prueba la generaci\xf3n de exportaci\xf3n CSV"}),"\n",(0,i.jsx)(s.li,{children:"Verifica el formato y la estructura de los datos"}),"\n",(0,i.jsx)(s.li,{children:"Comprueba la integridad de los datos en los archivos exportados"}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"\xdatil para garantizar que las exportaciones de CSV funcionen correctamente antes de los lanzamientos."}),"\n",(0,i.jsx)(s.h2,{id:"temporarily-block-ntfy-server-for-testing",children:"Bloquear temporalmente el servidor NTFY (para pruebas)"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"sudo ./scripts/temporary_ntfy.sh_block.sh\n"})}),"\n",(0,i.jsxs)(s.p,{children:["Este script bloquea temporalmente el acceso de red saliente al servidor NTFY (",(0,i.jsx)(s.code,{children:"ntfy.sh"}),") para probar el mecanismo de reintentos de notificaciones. Realiza lo siguiente:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Resuelve la direcci\xf3n IP del servidor NTFY"}),"\n",(0,i.jsx)(s.li,{children:"A\xf1ade una regla de iptables para bloquear el tr\xe1fico saliente"}),"\n",(0,i.jsx)(s.li,{children:"Bloquea durante 10 segundos (configurable)"}),"\n",(0,i.jsx)(s.li,{children:"Elimina autom\xe1ticamente la regla de bloqueo al salir"}),"\n",(0,i.jsx)(s.li,{children:"Requiere privilegios de root (sudo)"}),"\n"]}),"\n",(0,i.jsxs)(s.div,{className:"markdown-alert markdown-alert-caution",children:["\n",(0,i.jsxs)(s.p,{className:"markdown-alert-title",children:[(0,i.jsx)(s.span,{className:"octicon octicon-caution",style:{"--oct-icon":"url(\"data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' class='octicon octicon-stop mr-2' viewBox='0 0 16 16' version='1.1' width='16' height='16' aria-hidden='true'%3E%3Cpath d='M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z'%3E%3C/path%3E%3C/svg%3E\")"}}),"Caution"]}),"\n",(0,i.jsx)(s.p,{children:"Este script modifica las reglas de iptables y requiere privilegios de root. \xdaselo solo para probar mecanismos de reintento de notificaciones."}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"database-migration-testing",children:"Pruebas de Migraci\xf3n de Base de Datos"}),"\n",(0,i.jsx)(s.p,{children:"El proyecto incluye scripts para probar migraciones de base de datos desde versiones anteriores a la versi\xf3n actual. Estos scripts garantizan que las migraciones de base de datos funcionen correctamente y preserven la integridad de los datos."}),"\n",(0,i.jsx)(s.h3,{id:"generate-migration-test-data",children:"Generar Datos de Prueba de Migraci\xf3n"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"./scripts/generate-migration-test-data.sh\n"})}),"\n",(0,i.jsx)(s.p,{children:"Este script genera bases de datos de prueba para m\xfaltiples versiones hist\xf3ricas de la aplicaci\xf3n. Lo siguiente:"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Detiene y elimina"})," cualquier contenedor Docker existente"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Para cada versi\xf3n"})," (v0.4.0, v0.5.0, v0.6.1, 0.7.27, 0.8.21):","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Elimina archivos de base de datos existentes"}),"\n",(0,i.jsx)(s.li,{children:"Crea un archivo de etiqueta de versi\xf3n"}),"\n",(0,i.jsx)(s.li,{children:"Inicia un contenedor Docker con la versi\xf3n espec\xedfica"}),"\n",(0,i.jsx)(s.li,{children:"Espera a que el contenedor est\xe9 listo"}),"\n",(0,i.jsxs)(s.li,{children:["Genera datos de prueba usando ",(0,i.jsx)(s.code,{children:"pnpm generate-test-data"})]}),"\n",(0,i.jsx)(s.li,{children:"Toma una captura de pantalla de la interfaz de usuario con datos de prueba"}),"\n",(0,i.jsx)(s.li,{children:"Detiene y elimina el contenedor"}),"\n",(0,i.jsx)(s.li,{children:"Vac\xeda archivos WAL y guarda el esquema de la base de datos"}),"\n",(0,i.jsxs)(s.li,{children:["Copia el archivo de base de datos a ",(0,i.jsx)(s.code,{children:"scripts/migration_test_data/"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Requisitos:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Docker debe estar instalado y configurado"}),"\n",(0,i.jsx)(s.li,{children:"Google Chrome (a trav\xe9s de Puppeteer) debe estar instalado"}),"\n",(0,i.jsx)(s.li,{children:"Acceso root/sudo para operaciones de Docker"}),"\n",(0,i.jsxs)(s.li,{children:["El volumen de Docker ",(0,i.jsx)(s.code,{children:"duplistatus_data"})," debe existir"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Salida:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Archivos de base de datos: ",(0,i.jsx)(s.code,{children:"scripts/migration_test_data/backups_<VERSION>.db"})]}),"\n",(0,i.jsxs)(s.li,{children:["Archivos de esquema: ",(0,i.jsx)(s.code,{children:"scripts/migration_test_data/backups_<VERSION>.schema"})]}),"\n",(0,i.jsxs)(s.li,{children:["Capturas de pantalla: ",(0,i.jsx)(s.code,{children:"scripts/migration_test_data/duplistatus_test_data_<VERSION>.png"})]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Configuraci\xf3n:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["N\xfamero de servidores: Se establece mediante la variable ",(0,i.jsx)(s.code,{children:"SERVERS"})," (por defecto: 3)"]}),"\n",(0,i.jsxs)(s.li,{children:["Directorio de datos: ",(0,i.jsx)(s.code,{children:"/var/lib/docker/volumes/duplistatus_data/_data"})]}),"\n",(0,i.jsx)(s.li,{children:"Puerto: 9666 (puerto del contenedor Docker)"}),"\n"]}),"\n",(0,i.jsxs)(s.div,{className:"markdown-alert markdown-alert-caution",children:["\n",(0,i.jsxs)(s.p,{className:"markdown-alert-title",children:[(0,i.jsx)(s.span,{className:"octicon octicon-caution",style:{"--oct-icon":"url(\"data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' class='octicon octicon-stop mr-2' viewBox='0 0 16 16' version='1.1' width='16' height='16' aria-hidden='true'%3E%3Cpath d='M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z'%3E%3C/path%3E%3C/svg%3E\")"}}),"Caution"]}),"\n",(0,i.jsxs)(s.p,{children:["Este script requiere Docker y detendr\xe1/eliminar\xe1 contenedores existentes. Tambi\xe9n requiere acceso sudo para operaciones de Docker y acceso al sistema de archivos. Es necesario ejecutar primero el script ",(0,i.jsx)(s.code,{children:"pnpm take-screenshots"})," para instalar Google Chrome si a\xfan no lo ha hecho."]}),"\n"]}),"\n",(0,i.jsxs)(s.div,{className:"markdown-alert markdown-alert-important",children:["\n",(0,i.jsxs)(s.p,{className:"markdown-alert-title",children:[(0,i.jsx)(s.span,{className:"octicon octicon-important",style:{"--oct-icon":"url(\"data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' class='octicon octicon-report mr-2' viewBox='0 0 16 16' version='1.1' width='16' height='16' aria-hidden='true'%3E%3Cpath d='M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z'%3E%3C/path%3E%3C/svg%3E\")"}}),"Important"]}),"\n",(0,i.jsxs)(s.p,{children:["Este script estaba destinado a ejecutarse una sola vez; en nuevas versiones, el desarrollador puede copiar el archivo de base de datos y las capturas de pantalla directamente al directorio ",(0,i.jsx)(s.code,{children:"scripts/migration_test_data/"}),". Durante el desarrollo, simplemente ejecute el script ",(0,i.jsx)(s.code,{children:"./scripts/test-migrations.sh"})," para probar las migraciones."]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"test-database-migrations",children:"Migraciones de Base de Datos de Prueba"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"./scripts/test-migrations.sh\n"})}),"\n",(0,i.jsx)(s.p,{children:"Este script prueba migraciones de base de datos desde versiones antiguas a la versi\xf3n actual (4.0). Lo siguiente:"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Para cada versi\xf3n"})," (v0.4.0, v0.5.0, v0.6.1, 0.7.27, 0.8.21):","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Crea una copia temporal de la base de datos de prueba"}),"\n",(0,i.jsxs)(s.li,{children:["Ejecuta el proceso de migraci\xf3n utilizando ",(0,i.jsx)(s.code,{children:"test-migration.ts"})]}),"\n",(0,i.jsx)(s.li,{children:"Valida la estructura de la base de datos migrada"}),"\n",(0,i.jsx)(s.li,{children:"Verifica las tablas y columnas requeridas"}),"\n",(0,i.jsx)(s.li,{children:"Comprueba que la versi\xf3n de la base de datos sea 4.0"}),"\n",(0,i.jsx)(s.li,{children:"Limpia los archivos temporales"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Requisitos:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Las bases de datos de prueba deben existir en ",(0,i.jsx)(s.code,{children:"scripts/migration_test_data/"})]}),"\n",(0,i.jsxs)(s.li,{children:["Generadas ejecutando primero ",(0,i.jsx)(s.code,{children:"generate-migration-test-data.sh"})]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Salida:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Resultados de pruebas codificados por color (verde para aprobado, rojo para fallido)"}),"\n",(0,i.jsx)(s.li,{children:"Resumen de versiones aprobadas y fallidas"}),"\n",(0,i.jsx)(s.li,{children:"Mensajes de error detallados para migraciones fallidas"}),"\n",(0,i.jsx)(s.li,{children:"C\xf3digo de salida 0 si todas las pruebas se aprueban, 1 si alguna falla"}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Lo que valida:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"La versi\xf3n de la base de datos es 4.0 despu\xe9s de la migraci\xf3n"}),"\n",(0,i.jsxs)(s.li,{children:["Todas las tablas requeridas existen: ",(0,i.jsx)(s.code,{children:"servers"}),", ",(0,i.jsx)(s.code,{children:"backups"}),", ",(0,i.jsx)(s.code,{children:"configurations"}),", ",(0,i.jsx)(s.code,{children:"users"}),", ",(0,i.jsx)(s.code,{children:"sessions"}),", ",(0,i.jsx)(s.code,{children:"audit_log"}),", ",(0,i.jsx)(s.code,{children:"db_version"})]}),"\n",(0,i.jsx)(s.li,{children:"Las columnas requeridas existen en cada tabla"}),"\n",(0,i.jsx)(s.li,{children:"La estructura de la base de datos es correcta"}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Salida de ejemplo:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"==========================================\nDatabase Migration Test Suite\n==========================================\n\nTesting migrations from old versions to version 4.0\nTest data directory: /path/to/migration_test_data\nTemporary directory: /path/to/migration_test_data/.tmp\n\n----------------------------------------\nTesting version: v0.4.0\n----------------------------------------\n  Copying database file to temporary location...\n  Running migration test...\n\u2705 Version v0.4.0: Migration test PASSED\n\n==========================================\nTest Summary\n==========================================\n\n\u2705 Passed versions (5):\n  \u2713 v0.4.0\n  \u2713 v0.5.0\n  \u2713 v0.6.1\n  \u2713 0.7.27\n  \u2713 0.8.21\n\nAll migration tests passed!\n"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Uso:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Run all migration tests\n./scripts/test-migrations.sh\n\n# Check exit code\necho $?  # 0 = all passed, 1 = some failed\n"})}),"\n",(0,i.jsxs)(s.div,{className:"markdown-alert markdown-alert-note",children:["\n",(0,i.jsxs)(s.p,{className:"markdown-alert-title",children:[(0,i.jsx)(s.span,{className:"octicon octicon-note",style:{"--oct-icon":"url(\"data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' class='octicon octicon-info mr-2' viewBox='0 0 16 16' version='1.1' width='16' height='16' aria-hidden='true'%3E%3Cpath d='M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z'%3E%3C/path%3E%3C/svg%3E\")"}}),"Note"]}),"\n",(0,i.jsxs)(s.p,{children:["Este script utiliza internamente el script de prueba de migraci\xf3n de TypeScript (",(0,i.jsx)(s.code,{children:"test-migration.ts"}),"). El script de prueba valida la estructura de la base de datos despu\xe9s de la migraci\xf3n y garantiza la integridad de los datos."]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"set-smtp-test-configuration",children:"Configurar Prueba de Configuraci\xf3n SMTP"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"pnpm set-smtp-test-config <connectionType>\n"})}),"\n",(0,i.jsxs)(s.p,{children:["Este script establece la configuraci\xf3n de prueba SMTP a partir de variables de entorno. Acepta un par\xe1metro ",(0,i.jsx)(s.code,{children:"connectionType"})," (",(0,i.jsx)(s.code,{children:"plain"}),", ",(0,i.jsx)(s.code,{children:"starttls"})," o ",(0,i.jsx)(s.code,{children:"ssl"}),") y lee las variables de entorno correspondientes con prefijos (",(0,i.jsx)(s.code,{children:"PLAIN_"}),", ",(0,i.jsx)(s.code,{children:"STARTTLS_"}),", ",(0,i.jsx)(s.code,{children:"SSL_"}),") para actualizar la configuraci\xf3n SMTP en la base de datos."]}),"\n",(0,i.jsxs)(s.p,{children:["Para conexiones simples, el script lee la variable de entorno ",(0,i.jsx)(s.code,{children:"PLAIN_SMTP_FROM"})," para establecer la Direcci\xf3n de remitente requerida. Esto facilita la prueba de diferentes tipos de conexi\xf3n SMTP sin actualizaciones manuales de la base de datos."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Uso:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Set Plain SMTP configuration\nPLAIN_SMTP_HOST=smtp.example.com \\\nPLAIN_SMTP_PORT=25 \\\nPLAIN_SMTP_FROM=noreply@example.com \\\npnpm set-smtp-test-config plain\n\n# Set STARTTLS configuration\nSTARTTLS_SMTP_HOST=smtp.example.com \\\nSTARTTLS_SMTP_PORT=587 \\\nSTARTTLS_SMTP_USERNAME=user@example.com \\\nSTARTTLS_SMTP_PASSWORD=password \\\npnpm set-smtp-test-config starttls\n\n# Set Direct SSL/TLS configuration\nSSL_SMTP_HOST=smtp.example.com \\\nSSL_SMTP_PORT=465 \\\nSSL_SMTP_USERNAME=user@example.com \\\nSSL_SMTP_PASSWORD=password \\\npnpm set-smtp-test-config ssl\n"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Requisitos:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"La aplicaci\xf3n debe estar en ejecuci\xf3n"}),"\n",(0,i.jsx)(s.li,{children:"Las variables de entorno deben configurarse con el prefijo apropiado para el tipo de conexi\xf3n"}),"\n",(0,i.jsxs)(s.li,{children:["Para conexiones simples, ",(0,i.jsx)(s.code,{children:"PLAIN_SMTP_FROM"})," es requerido"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"test-smtp-connection-type-cross-compatibility",children:"Probar Tipo de conexi\xf3n SMTP Compatibilidad cruzada"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"pnpm test-smtp-connections\n"})}),"\n",(0,i.jsx)(s.p,{children:"Este script realiza una prueba exhaustiva de matriz 3x3 que valida si las configuraciones destinadas a un tipo de conexi\xf3n funcionan correctamente con diferentes tipos de conexi\xf3n. Para cada tipo de configuraci\xf3n base (plain, starttls, ssl), el script:"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["Lee variables de entorno con prefijos correspondientes (",(0,i.jsx)(s.code,{children:"PLAIN_*"}),", ",(0,i.jsx)(s.code,{children:"STARTTLS_*"}),", ",(0,i.jsx)(s.code,{children:"SSL_*"}),")"]}),"\n",(0,i.jsxs)(s.li,{children:["Prueba los tres tipos de conexi\xf3n modificando \xfanicamente el campo ",(0,i.jsx)(s.code,{children:"connectionType"})]}),"\n",(0,i.jsx)(s.li,{children:"Env\xeda correos electr\xf3nicos de prueba a trav\xe9s de la API"}),"\n",(0,i.jsx)(s.li,{children:"Registra los resultados en formato de matriz"}),"\n",(0,i.jsx)(s.li,{children:"Muestra una tabla de resumen"}),"\n",(0,i.jsxs)(s.li,{children:["Guarda los resultados detallados en ",(0,i.jsx)(s.code,{children:"smtp-test-results.json"})]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Uso:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Set environment variables for all three connection types\nPLAIN_SMTP_HOST=smtp.example.com \\\nPLAIN_SMTP_PORT=25 \\\nPLAIN_SMTP_FROM=noreply@example.com \\\nSTARTTLS_SMTP_HOST=smtp.example.com \\\nSTARTTLS_SMTP_PORT=587 \\\nSTARTTLS_SMTP_USERNAME=user@example.com \\\nSTARTTLS_SMTP_PASSWORD=password \\\nSSL_SMTP_HOST=smtp.example.com \\\nSSL_SMTP_PORT=465 \\\nSSL_SMTP_USERNAME=user@example.com \\\nSSL_SMTP_PASSWORD=password \\\npnpm test-smtp-connections\n"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Requisitos:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"La aplicaci\xf3n debe estar en ejecuci\xf3n"}),"\n",(0,i.jsx)(s.li,{children:"Las variables de entorno deben estar configuradas para los tres tipos de conexi\xf3n"}),"\n",(0,i.jsx)(s.li,{children:"El script valida la configuraci\xf3n que se utiliza mediante registro detallado"}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Comportamiento Esperado:"}),"\nLas configuraciones solo deben funcionar con su tipo de conexi\xf3n previsto (por ejemplo, la configuraci\xf3n simple funciona con connectionType simple pero falla con STARTTLS/ssl)."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Salida:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Salida de consola con una tabla de resumen que muestra los resultados de las pruebas"}),"\n",(0,i.jsxs)(s.li,{children:["Archivo ",(0,i.jsx)(s.code,{children:"smtp-test-results.json"})," con resultados detallados de las pruebas para cada combinaci\xf3n de configuraci\xf3n y tipo de conexi\xf3n"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"test-docker-entrypoint-script",children:"Probar Script de Punto de Entrada de Docker"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"pnpm test-entrypoint\n"})}),"\n",(0,i.jsxs)(s.p,{children:["Este script proporciona un contenedor de prueba para ",(0,i.jsx)(s.code,{children:"docker-entrypoint.sh"})," en desarrollo local. Configura el entorno para probar la funcionalidad de registro de logs y garantiza que los logs se escriban en ",(0,i.jsx)(s.code,{children:"data/logs/"})," para que la aplicaci\xf3n pueda acceder a ellos."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Qu\xe9 hace:"})}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Siempre construye una versi\xf3n nueva"}),": Ejecuta autom\xe1ticamente ",(0,i.jsx)(s.code,{children:"pnpm build-local"})," para crear una compilaci\xf3n nueva antes de realizar pruebas (no es necesario compilar manualmente primero)"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Construye el servicio cron"}),": Asegura que el servicio cron est\xe9 compilado (",(0,i.jsx)(s.code,{children:"dist/cron-service.cjs"}),")"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Configura la estructura similar a Docker"}),": Crea los enlaces simb\xf3licos y la estructura de directorios necesarios para imitar el entorno de Docker"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Ejecuta el script de punto de entrada"}),": Ejecuta ",(0,i.jsx)(s.code,{children:"docker-entrypoint.sh"})," con las variables de entorno apropiadas"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Limpia"}),": Elimina autom\xe1ticamente los archivos temporales al salir"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Uso:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Run the test (builds fresh version automatically)\npnpm test-entrypoint\n"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Variables de Entorno:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"PORT=8666"})," - Puerto para el servidor Next.js (coincide con ",(0,i.jsx)(s.code,{children:"start-local"}),")"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"CRON_PORT=8667"})," - Puerto para el servicio cron"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"VERSION"})," - Se establece autom\xe1ticamente en formato ",(0,i.jsx)(s.code,{children:"test-YYYYMMDD-HHMMSS"})]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Salida:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Los logs se escriben en ",(0,i.jsx)(s.code,{children:"data/logs/application.log"})," (accesible por la aplicaci\xf3n)"]}),"\n",(0,i.jsx)(s.li,{children:"La salida de consola muestra la ejecuci\xf3n del script de punto de entrada"}),"\n",(0,i.jsx)(s.li,{children:"Presione Ctrl+C para detener y probar el vaciado de logs"}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Requisitos:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"El script debe ejecutarse desde el directorio ra\xedz del repositorio (pnpm lo maneja autom\xe1ticamente)"}),"\n",(0,i.jsx)(s.li,{children:"El script maneja autom\xe1ticamente todos los requisitos previos (compilaci\xf3n, servicio cron, etc.)"}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Casos de uso:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Probar cambios en el script de punto de entrada localmente antes del despliegue en Docker"}),"\n",(0,i.jsx)(s.li,{children:"Verificar la rotaci\xf3n de registros y la funcionalidad de registro"}),"\n",(0,i.jsx)(s.li,{children:"Probar el apagado elegante y el manejo de se\xf1ales"}),"\n",(0,i.jsx)(s.li,{children:"Depurar el comportamiento del script de punto de entrada en un entorno local"}),"\n"]})]})}function p(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},73230(e,s,n){n.d(s,{R:()=>t,x:()=>c});var a=n(71299);const i={},r=a.createContext(i);function t(e){const s=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),a.createElement(r.Provider,{value:s},e.children)}}}]);