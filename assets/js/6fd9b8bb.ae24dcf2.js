"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[952],{1285:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>t});var i=n(3303);const r={},d=i.createContext(r);function l(e){const s=i.useContext(d);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(d.Provider,{value:s},e.children)}},6357:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"development/database","title":"Database Schema","description":"This document describes the SQLite database schema used by duplistatus to store backup operation data.","source":"@site/docs/development/database.md","sourceDirName":"development","slug":"/development/database","permalink":"/duplistatus/development/database","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"mainSidebar","previous":{"title":"Most used commands","permalink":"/duplistatus/development/devel"},"next":{"title":"Documentation Tools","permalink":"/duplistatus/development/documentation-tools"}}');var r=n(7711),d=n(1285);const l={},t="Database Schema",a={},c=[{value:"Database Location",id:"database-location",level:2},{value:"Database Migration System",id:"database-migration-system",level:2},{value:"Current Migration Versions",id:"current-migration-versions",level:3},{value:"Migration Process",id:"migration-process",level:3},{value:"Tables",id:"tables",level:2},{value:"Servers Table",id:"servers-table",level:3},{value:"Fields",id:"fields",level:4},{value:"Backups Table",id:"backups-table",level:3},{value:"Key Fields",id:"key-fields",level:4},{value:"Message Arrays (JSON Storage)",id:"message-arrays-json-storage",level:4},{value:"File Operation Fields",id:"file-operation-fields",level:4},{value:"Operation Status Fields",id:"operation-status-fields",level:4},{value:"Backend Statistics Fields",id:"backend-statistics-fields",level:4},{value:"Configurations Table",id:"configurations-table",level:3},{value:"Fields",id:"fields-1",level:4},{value:"Common Configuration Keys",id:"common-configuration-keys",level:4},{value:"Database Version Table",id:"database-version-table",level:3},{value:"Fields",id:"fields-2",level:4},{value:"Session Management",id:"session-management",level:2},{value:"In-Memory Session Storage",id:"in-memory-session-storage",level:3},{value:"Session API Endpoints",id:"session-api-endpoints",level:3},{value:"Indexes",id:"indexes",level:2},{value:"Relationships",id:"relationships",level:2},{value:"Data Types",id:"data-types",level:2},{value:"Backup Status Values",id:"backup-status-values",level:2},{value:"Common Queries",id:"common-queries",level:2},{value:"Get Latest Backup for a Server",id:"get-latest-backup-for-a-server",level:3},{value:"Get All Backups for a Server",id:"get-all-backups-for-a-server",level:3},{value:"Get Server Summary",id:"get-server-summary",level:3},{value:"Get Overall Summary",id:"get-overall-summary",level:3},{value:"Database Cleanup",id:"database-cleanup",level:3},{value:"JSON to Database Mapping",id:"json-to-database-mapping",level:2},{value:"API Request Body to Database Columns Mapping",id:"api-request-body-to-database-columns-mapping",level:3},{value:"Maintenance",id:"maintenance",level:2},{value:"Regular Maintenance Tasks",id:"regular-maintenance-tasks",level:3},{value:"Performance Optimisation",id:"performance-optimisation",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Common Issues",id:"common-issues",level:3},{value:"Recovery Procedures",id:"recovery-procedures",level:3},{value:"Security Considerations",id:"security-considerations",level:2},{value:"Monitoring",id:"monitoring",level:2},{value:"Database Metrics",id:"database-metrics",level:3},{value:"Health Checks",id:"health-checks",level:3}];function o(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"database-schema",children:"Database Schema"})}),"\n",(0,r.jsx)(s.p,{children:"This document describes the SQLite database schema used by duplistatus to store backup operation data."}),"\n",(0,r.jsx)(s.h2,{id:"database-location",children:"Database Location"}),"\n",(0,r.jsx)(s.p,{children:"The database is stored in the application data directory:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Default Location"}),": ",(0,r.jsx)(s.code,{children:"/app/data/backups.db"})]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Docker Volume"}),": ",(0,r.jsx)(s.code,{children:"duplistatus_data:/app/data"})]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"File Name"}),": ",(0,r.jsx)(s.code,{children:"backups.db"})]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"database-migration-system",children:"Database Migration System"}),"\n",(0,r.jsx)(s.p,{children:"duplistatus uses an automated migration system to handle database schema changes between versions."}),"\n",(0,r.jsx)(s.h3,{id:"current-migration-versions",children:"Current Migration Versions"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Version 0.7.x"}),": Major schema changes (machines \u2192 servers)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Version 0.8.x"}),": Enhanced features and performance improvements"]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"migration-process",children:"Migration Process"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Automatic Backup"}),": Creates backup before migration"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Schema Update"}),": Updates database structure"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Data Migration"}),": Preserves existing data"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Verification"}),": Confirms successful migration"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"tables",children:"Tables"}),"\n",(0,r.jsx)(s.h3,{id:"servers-table",children:"Servers Table"}),"\n",(0,r.jsx)(s.p,{children:"Stores information about Duplicati servers being monitored."}),"\n",(0,r.jsx)(s.h4,{id:"fields",children:"Fields"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Field"}),(0,r.jsx)(s.th,{children:"Type"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"id"})}),(0,r.jsx)(s.td,{children:"TEXT PRIMARY KEY"}),(0,r.jsx)(s.td,{children:"Unique server identifier"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"name"})}),(0,r.jsx)(s.td,{children:"TEXT NOT NULL"}),(0,r.jsx)(s.td,{children:"Server name from Duplicati"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"alias"})}),(0,r.jsx)(s.td,{children:"TEXT"}),(0,r.jsx)(s.td,{children:"User-defined friendly name"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"notes"})}),(0,r.jsx)(s.td,{children:"TEXT"}),(0,r.jsx)(s.td,{children:"User-defined notes/description"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"created_at"})}),(0,r.jsx)(s.td,{children:"DATETIME"}),(0,r.jsx)(s.td,{children:"Server creation timestamp"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"updated_at"})}),(0,r.jsx)(s.td,{children:"DATETIME"}),(0,r.jsx)(s.td,{children:"Last update timestamp"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"backups-table",children:"Backups Table"}),"\n",(0,r.jsx)(s.p,{children:"Stores backup operation data received from Duplicati servers."}),"\n",(0,r.jsx)(s.h4,{id:"key-fields",children:"Key Fields"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Field"}),(0,r.jsx)(s.th,{children:"Type"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"id"})}),(0,r.jsx)(s.td,{children:"TEXT PRIMARY KEY"}),(0,r.jsx)(s.td,{children:"Unique backup identifier"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"server_id"})}),(0,r.jsx)(s.td,{children:"TEXT NOT NULL"}),(0,r.jsx)(s.td,{children:"Reference to servers table"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"name"})}),(0,r.jsx)(s.td,{children:"TEXT NOT NULL"}),(0,r.jsx)(s.td,{children:"Backup job name"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"date"})}),(0,r.jsx)(s.td,{children:"DATETIME NOT NULL"}),(0,r.jsx)(s.td,{children:"Backup execution time"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"status"})}),(0,r.jsx)(s.td,{children:"TEXT NOT NULL"}),(0,r.jsx)(s.td,{children:"Backup status (Success, Warning, Error, Fatal)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"duration"})}),(0,r.jsx)(s.td,{children:"TEXT"}),(0,r.jsxs)(s.td,{children:["Backup duration (HH:MM",":SS",")"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"duration_seconds"})}),(0,r.jsx)(s.td,{children:"REAL"}),(0,r.jsx)(s.td,{children:"Duration in seconds"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"file_count"})}),(0,r.jsx)(s.td,{children:"INTEGER"}),(0,r.jsx)(s.td,{children:"Number of files processed"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"file_size"})}),(0,r.jsx)(s.td,{children:"INTEGER"}),(0,r.jsx)(s.td,{children:"Size of source files"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"uploaded_size"})}),(0,r.jsx)(s.td,{children:"INTEGER"}),(0,r.jsx)(s.td,{children:"Size of uploaded data"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"storage_size"})}),(0,r.jsx)(s.td,{children:"INTEGER"}),(0,r.jsx)(s.td,{children:"Storage used on destination"})]})]})]}),"\n",(0,r.jsx)(s.h4,{id:"message-arrays-json-storage",children:"Message Arrays (JSON Storage)"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Field"}),(0,r.jsx)(s.th,{children:"Type"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"messages_array"})}),(0,r.jsx)(s.td,{children:"TEXT"}),(0,r.jsx)(s.td,{children:"JSON array of log messages"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"warnings_array"})}),(0,r.jsx)(s.td,{children:"TEXT"}),(0,r.jsx)(s.td,{children:"JSON array of warning messages"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"errors_array"})}),(0,r.jsx)(s.td,{children:"TEXT"}),(0,r.jsx)(s.td,{children:"JSON array of error messages"})]})]})]}),"\n",(0,r.jsx)(s.h4,{id:"file-operation-fields",children:"File Operation Fields"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Field"}),(0,r.jsx)(s.th,{children:"Type"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"examined_files"})}),(0,r.jsx)(s.td,{children:"INTEGER"}),(0,r.jsx)(s.td,{children:"Files examined during backup"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"opened_files"})}),(0,r.jsx)(s.td,{children:"INTEGER"}),(0,r.jsx)(s.td,{children:"Files opened for backup"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"added_files"})}),(0,r.jsx)(s.td,{children:"INTEGER"}),(0,r.jsx)(s.td,{children:"New files added to backup"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"modified_files"})}),(0,r.jsx)(s.td,{children:"INTEGER"}),(0,r.jsx)(s.td,{children:"Files modified in backup"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"deleted_files"})}),(0,r.jsx)(s.td,{children:"INTEGER"}),(0,r.jsx)(s.td,{children:"Files deleted from backup"})]})]})]}),"\n",(0,r.jsx)(s.h4,{id:"operation-status-fields",children:"Operation Status Fields"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Field"}),(0,r.jsx)(s.th,{children:"Type"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"parsed_result"})}),(0,r.jsx)(s.td,{children:"TEXT"}),(0,r.jsx)(s.td,{children:"Parsed operation result"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"main_operation"})}),(0,r.jsx)(s.td,{children:"TEXT"}),(0,r.jsx)(s.td,{children:"Main operation type"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"interrupted"})}),(0,r.jsx)(s.td,{children:"BOOLEAN"}),(0,r.jsx)(s.td,{children:"Whether backup was interrupted"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"partial_backup"})}),(0,r.jsx)(s.td,{children:"BOOLEAN"}),(0,r.jsx)(s.td,{children:"Whether backup was partial"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"dryrun"})}),(0,r.jsx)(s.td,{children:"BOOLEAN"}),(0,r.jsx)(s.td,{children:"Whether backup was a dry run"})]})]})]}),"\n",(0,r.jsx)(s.h4,{id:"backend-statistics-fields",children:"Backend Statistics Fields"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Field"}),(0,r.jsx)(s.th,{children:"Type"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"bytes_uploaded"})}),(0,r.jsx)(s.td,{children:"INTEGER"}),(0,r.jsx)(s.td,{children:"Bytes uploaded to destination"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"bytes_downloaded"})}),(0,r.jsx)(s.td,{children:"INTEGER"}),(0,r.jsx)(s.td,{children:"Bytes downloaded from destination"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"known_file_size"})}),(0,r.jsx)(s.td,{children:"INTEGER"}),(0,r.jsx)(s.td,{children:"Known file size on destination"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"backup_list_count"})}),(0,r.jsx)(s.td,{children:"INTEGER"}),(0,r.jsx)(s.td,{children:"Number of backup versions"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"last_backup_date"})}),(0,r.jsx)(s.td,{children:"DATETIME"}),(0,r.jsx)(s.td,{children:"Last backup date on destination"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"configurations-table",children:"Configurations Table"}),"\n",(0,r.jsx)(s.p,{children:"Stores application configuration settings."}),"\n",(0,r.jsx)(s.h4,{id:"fields-1",children:"Fields"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Field"}),(0,r.jsx)(s.th,{children:"Type"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"key"})}),(0,r.jsx)(s.td,{children:"TEXT PRIMARY KEY"}),(0,r.jsx)(s.td,{children:"Configuration key"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"value"})}),(0,r.jsx)(s.td,{children:"TEXT"}),(0,r.jsx)(s.td,{children:"Configuration value (JSON)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"updated_at"})}),(0,r.jsx)(s.td,{children:"DATETIME"}),(0,r.jsx)(s.td,{children:"Last update timestamp"})]})]})]}),"\n",(0,r.jsx)(s.h4,{id:"common-configuration-keys",children:"Common Configuration Keys"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"email_config"}),": Email notification settings"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"ntfy_config"}),": NTFY notification settings"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"overdue_tolerance"}),": Overdue backup tolerance settings"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"notification_templates"}),": Notification message templates"]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"database-version-table",children:"Database Version Table"}),"\n",(0,r.jsx)(s.p,{children:"Tracks database schema version for migration purposes."}),"\n",(0,r.jsx)(s.h4,{id:"fields-2",children:"Fields"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Field"}),(0,r.jsx)(s.th,{children:"Type"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"version"})}),(0,r.jsx)(s.td,{children:"TEXT PRIMARY KEY"}),(0,r.jsx)(s.td,{children:"Database version"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"applied_at"})}),(0,r.jsx)(s.td,{children:"DATETIME"}),(0,r.jsx)(s.td,{children:"When migration was applied"})]})]})]}),"\n",(0,r.jsx)(s.h2,{id:"session-management",children:"Session Management"}),"\n",(0,r.jsx)(s.h3,{id:"in-memory-session-storage",children:"In-Memory Session Storage"}),"\n",(0,r.jsx)(s.p,{children:"Sessions are stored in memory for security and performance:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Session ID"}),": Cryptographically secure random string"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Expiration"}),": Configurable session timeout"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"CSRF Protection"}),": Cross-site request forgery protection"]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"session-api-endpoints",children:"Session API Endpoints"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"POST /api/session"}),": Create new session"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"GET /api/session"}),": Validate existing session"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"DELETE /api/session"}),": Destroy session"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"GET /api/csrf"}),": Get CSRF token"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"indexes",children:"Indexes"}),"\n",(0,r.jsx)(s.p,{children:"The database includes several indexes for optimal query performance:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Primary Keys"}),": All tables have primary key indexes"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Foreign Keys"}),": Server references in backups table"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Query Optimization"}),": Indexes on frequently queried fields"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Date Indexes"}),": Indexes on date fields for time-based queries"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"relationships",children:"Relationships"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Servers \u2192 Backups"}),": One-to-many relationship"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Backups \u2192 Messages"}),": Embedded JSON arrays"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Configurations"}),": Key-value storage"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"data-types",children:"Data Types"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"TEXT"}),": String data, JSON arrays"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"INTEGER"}),": Numeric data, file counts, sizes"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"REAL"}),": Floating-point numbers, durations"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"DATETIME"}),": Timestamp data"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"BOOLEAN"}),": True/false values"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"backup-status-values",children:"Backup Status Values"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Success"}),": Backup completed successfully"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Warning"}),": Backup completed with warnings"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Error"}),": Backup completed with errors"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Fatal"}),": Backup failed fatally"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"common-queries",children:"Common Queries"}),"\n",(0,r.jsx)(s.h3,{id:"get-latest-backup-for-a-server",children:"Get Latest Backup for a Server"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"SELECT * FROM backups \nWHERE server_id = ? \nORDER BY date DESC \nLIMIT 1;\n"})}),"\n",(0,r.jsx)(s.h3,{id:"get-all-backups-for-a-server",children:"Get All Backups for a Server"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"SELECT * FROM backups \nWHERE server_id = ? \nORDER BY date DESC;\n"})}),"\n",(0,r.jsx)(s.h3,{id:"get-server-summary",children:"Get Server Summary"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"SELECT \n  s.name,\n  s.alias,\n  COUNT(b.id) as backup_count,\n  MAX(b.date) as last_backup,\n  b.status as last_status\nFROM servers s\nLEFT JOIN backups b ON s.id = b.server_id\nGROUP BY s.id;\n"})}),"\n",(0,r.jsx)(s.h3,{id:"get-overall-summary",children:"Get Overall Summary"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"SELECT \n  COUNT(DISTINCT s.id) as total_servers,\n  COUNT(b.id) as total_backups,\n  SUM(b.uploaded_size) as total_uploaded,\n  SUM(b.storage_size) as total_storage\nFROM servers s\nLEFT JOIN backups b ON s.id = b.server_id;\n"})}),"\n",(0,r.jsx)(s.h3,{id:"database-cleanup",children:"Database Cleanup"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"-- Delete old backups (older than 30 days)\nDELETE FROM backups \nWHERE date < datetime('now', '-30 days');\n\n-- Delete servers with no backups\nDELETE FROM servers \nWHERE id NOT IN (SELECT DISTINCT server_id FROM backups);\n"})}),"\n",(0,r.jsx)(s.h2,{id:"json-to-database-mapping",children:"JSON to Database Mapping"}),"\n",(0,r.jsx)(s.h3,{id:"api-request-body-to-database-columns-mapping",children:"API Request Body to Database Columns Mapping"}),"\n",(0,r.jsx)(s.p,{children:"When Duplicati sends backup data via HTTP POST, the JSON structure is mapped to database columns:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:'{\n  "Data": {\n    "ExaminedFiles": 15399,           // \u2192 examined_files\n    "OpenedFiles": 1861,              // \u2192 opened_files\n    "AddedFiles": 1861,               // \u2192 added_files\n    "SizeOfExaminedFiles": 11086692615, // \u2192 file_size\n    "SizeOfAddedFiles": 13450481,     // \u2192 uploaded_size\n    "ParsedResult": "Success",        // \u2192 status\n    "BeginTime": "2025-04-21T23:45:46.9712217Z", // \u2192 date\n    "Duration": "00:00:51.3856057",   // \u2192 duration\n    "WarningsActualLength": 0,        // \u2192 warnings count\n    "ErrorsActualLength": 0           // \u2192 errors count\n  },\n  "Extra": {\n    "machine-id": "66f5ffc7ff474a73a3c9cba4ac7bfb65", // \u2192 server_id\n    "machine-name": "WSJ-SER5",       // \u2192 server name\n    "backup-name": "WSJ-SER5 Local files", // \u2192 backup name\n    "backup-id": "DB-2"               // \u2192 backup id\n  }\n}\n'})}),"\n",(0,r.jsx)(s.h2,{id:"maintenance",children:"Maintenance"}),"\n",(0,r.jsx)(s.h3,{id:"regular-maintenance-tasks",children:"Regular Maintenance Tasks"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Vacuum Database"}),": Reclaim unused space"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Analyse Statistics"}),": Update query optimiser statistics"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Check Integrity"}),": Verify database integrity"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Backup Database"}),": Create regular backups"]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"performance-optimisation",children:"Performance Optimisation"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Index Maintenance"}),": Monitor and optimise indexes"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Query Optimisation"}),": Analyse slow queries"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Data Cleanup"}),": Remove old backup data"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Connection Pooling"}),": Optimise database connections"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(s.h3,{id:"common-issues",children:"Common Issues"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Database Locked"}),": Check for long-running transactions"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Disk Space"}),": Monitor database file size"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Corruption"}),": Use integrity checks"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Performance"}),": Analyse query performance"]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"recovery-procedures",children:"Recovery Procedures"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Backup Restoration"}),": Restore from backup file"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Schema Repair"}),": Recreate corrupted tables"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Data Recovery"}),": Recover from backup logs"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Migration Rollback"}),": Rollback failed migrations"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"File Permissions"}),": Restrict database file access"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Encryption"}),": Consider database encryption for sensitive data"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Backup Security"}),": Secure backup file storage"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Access Control"}),": Implement proper access controls"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"monitoring",children:"Monitoring"}),"\n",(0,r.jsx)(s.h3,{id:"database-metrics",children:"Database Metrics"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"File Size"}),": Monitor database file growth"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Query Performance"}),": Track slow queries"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Connection Count"}),": Monitor active connections"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Lock Contention"}),": Check for database locks"]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"health-checks",children:"Health Checks"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Integrity Checks"}),": Regular database integrity verification"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Performance Monitoring"}),": Query performance analysis"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Error Tracking"}),": Database error monitoring"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Backup Verification"}),": Verify backup file integrity"]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,d.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}}}]);