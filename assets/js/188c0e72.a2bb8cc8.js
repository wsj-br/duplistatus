"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[233],{2456(e,n,s){s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"development/podman-testing","title":"Podman Testing","description":"Copy and execute the scripts located at scripts/podman_testing on the Podman test server.","source":"@site/docs/development/podman-testing.md","sourceDirName":"development","slug":"/development/podman-testing","permalink":"/duplistatus/development/podman-testing","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"mainSidebar","previous":{"title":"Documentation Tools","permalink":"/duplistatus/development/documentation-tools"},"next":{"title":"Release Management","permalink":"/duplistatus/development/release-management"}}');var i=s(7900),o=s(6416);const r={},d="Podman Testing",l={},c=[{value:"Initial Setup and Management",id:"initial-setup-and-management",level:2},{value:"DNS Configuration",id:"dns-configuration",level:2},{value:"Monitoring and Health Checks",id:"monitoring-and-health-checks",level:2},{value:"Debugging Commands",id:"debugging-commands",level:2},{value:"Usage Workflow",id:"usage-workflow",level:2},{value:"Development Server",id:"development-server",level:3},{value:"Podman Server",id:"podman-server",level:3},{value:"Important Notes",id:"important-notes",level:2},{value:"Podman Pod Networking",id:"podman-pod-networking",level:3},{value:"Rootless vs Root Mode",id:"rootless-vs-root-mode",level:3},{value:"Environment Configuration",id:"environment-configuration",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"podman-testing",children:"Podman Testing"})}),"\n",(0,i.jsxs)(n.p,{children:["Copy and execute the scripts located at ",(0,i.jsx)(n.code,{children:"scripts/podman_testing"})," on the Podman test server."]}),"\n",(0,i.jsx)(n.h2,{id:"initial-setup-and-management",children:"Initial Setup and Management"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"copy.docker.duplistatus.local"}),": Copies the Docker image from the local Docker daemon to Podman (for local testing)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"copy.docker.duplistatus.remote"}),": Copies the Docker image from a remote development server to Podman (requires SSH access).","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Create the image on the development server using: ",(0,i.jsx)(n.code,{children:"docker build . -t wsj-br/duplistatus:devel"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"start.duplistatus"}),": Starts the container in rootless mode."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"pod.testing"}),": Tests the container inside a Podman pod (with root privileges)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"stop.duplistatus"}),": Stops the pod and removes the container."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"clean.duplistatus"}),": Stops containers, removes pods, and cleans up old images."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"dns-configuration",children:"DNS Configuration"}),"\n",(0,i.jsx)(n.p,{children:"The scripts automatically detect and configure DNS settings from the host system:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Automatic Detection"}),": Uses ",(0,i.jsx)(n.code,{children:"resolvectl status"})," (systemd-resolved) to extract DNS servers and search domains"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Fallback Support"}),": Falls back to parsing ",(0,i.jsx)(n.code,{children:"/etc/resolv.conf"})," on non-systemd systems"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Smart Filtering"}),": Automatically filters out localhost addresses and IPv6 nameservers"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Works with"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Tailscale MagicDNS (100.100.100.100)"}),"\n",(0,i.jsx)(n.li,{children:"Corporate DNS servers"}),"\n",(0,i.jsx)(n.li,{children:"Standard network configurations"}),"\n",(0,i.jsx)(n.li,{children:"Custom DNS setups"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"No manual DNS configuration is needed - the scripts handle it automatically!"}),"\n",(0,i.jsx)(n.h2,{id:"monitoring-and-health-checks",children:"Monitoring and Health Checks"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"check.duplistatus"}),": Checks the logs, connectivity, and application health."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"debugging-commands",children:"Debugging Commands"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"logs.duplistatus"}),": Shows the logs of the pod."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"exec.shell.duplistatus"}),": Opens a shell in the container."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"restart.duplistatus"}),": Stops the pod, removes the container, copies the image, creates the container, and starts the pod."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"usage-workflow",children:"Usage Workflow"}),"\n",(0,i.jsx)(n.h3,{id:"development-server",children:"Development Server"}),"\n",(0,i.jsx)(n.p,{children:"Create the Docker image on the development server:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker build . -t wsj-br/duplistatus:devel\n"})}),"\n",(0,i.jsx)(n.h3,{id:"podman-server",children:"Podman Server"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Transfer the Docker image:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"./copy.docker.duplistatus.local"})," if Docker and Podman are on the same machine"]}),"\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"./copy.docker.duplistatus.remote"})," if copying from a remote development server (requires ",(0,i.jsx)(n.code,{children:".env"})," file with ",(0,i.jsx)(n.code,{children:"REMOTE_USER"})," and ",(0,i.jsx)(n.code,{children:"REMOTE_HOST"}),")"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Start the container with ",(0,i.jsx)(n.code,{children:"./start.duplistatus"})," (standalone, rootless)","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Or use ",(0,i.jsx)(n.code,{children:"./pod.testing"})," to test in pod mode (with root)"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Monitor with ",(0,i.jsx)(n.code,{children:"./check.duplistatus"})," and ",(0,i.jsx)(n.code,{children:"./logs.duplistatus"})]}),"\n",(0,i.jsxs)(n.li,{children:["Stop with ",(0,i.jsx)(n.code,{children:"./stop.duplistatus"})," when done"]}),"\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"./restart.duplistatus"})," for a complete restart cycle (stop, copy image, start)","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Note"}),": This script currently references ",(0,i.jsx)(n.code,{children:"copy.docker.duplistatus"})," which should be replaced with either ",(0,i.jsx)(n.code,{children:".local"})," or ",(0,i.jsx)(n.code,{children:".remote"})," variant"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"./clean.duplistatus"})," to remove containers, pods, and old images"]}),"\n"]}),"\n",(0,i.jsx)(n.h1,{id:"testing-the-application",children:"Testing the Application"}),"\n",(0,i.jsxs)(n.p,{children:["If you are running the Podman server on the same machine, use ",(0,i.jsx)(n.code,{children:"http://localhost:9666"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"If you are on another server, get the URL with:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"echo \"http://$(hostname -I | awk '{print $1}'):9666\"\n"})}),"\n",(0,i.jsx)(n.h2,{id:"important-notes",children:"Important Notes"}),"\n",(0,i.jsx)(n.h3,{id:"podman-pod-networking",children:"Podman Pod Networking"}),"\n",(0,i.jsx)(n.p,{children:"When running in Podman pods, the application requires:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Explicit DNS configuration (automatically handled by ",(0,i.jsx)(n.code,{children:"pod.testing"})," script)"]}),"\n",(0,i.jsxs)(n.li,{children:["Port binding to all interfaces (",(0,i.jsx)(n.code,{children:"0.0.0.0:9666"}),")"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"The scripts handle these requirements automatically - no manual configuration needed."}),"\n",(0,i.jsx)(n.h3,{id:"rootless-vs-root-mode",children:"Rootless vs Root Mode"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Standalone mode"})," (",(0,i.jsx)(n.code,{children:"start.duplistatus"}),"): Runs rootless with ",(0,i.jsx)(n.code,{children:"--userns=keep-id"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Pod mode"})," (",(0,i.jsx)(n.code,{children:"pod.testing"}),"): Runs as root inside the pod for testing purposes"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Both modes work correctly with the automatic DNS detection."}),"\n",(0,i.jsx)(n.h2,{id:"environment-configuration",children:"Environment Configuration"}),"\n",(0,i.jsxs)(n.p,{children:["Both ",(0,i.jsx)(n.code,{children:"copy.docker.duplistatus.local"})," and ",(0,i.jsx)(n.code,{children:"copy.docker.duplistatus.remote"})," require a ",(0,i.jsx)(n.code,{children:".env"})," file in the ",(0,i.jsx)(n.code,{children:"scripts/podman_testing"})," directory:"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"For local copying"})," (",(0,i.jsx)(n.code,{children:"copy.docker.duplistatus.local"}),"):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"IMAGE=wsj-br/duplistatus:devel\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"For remote copying"})," (",(0,i.jsx)(n.code,{children:"copy.docker.duplistatus.remote"}),"):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"IMAGE=wsj-br/duplistatus:devel\nREMOTE_USER=your_username\nREMOTE_HOST=your_hostname\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"start.duplistatus"})," script requires a ",(0,i.jsx)(n.code,{children:".env"})," file with at least the ",(0,i.jsx)(n.code,{children:"IMAGE"})," variable:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"IMAGE=wsj-br/duplistatus:devel\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note"}),": The script's error message mentions ",(0,i.jsx)(n.code,{children:"REMOTE_USER"})," and ",(0,i.jsx)(n.code,{children:"REMOTE_HOST"}),", but these are not actually used by ",(0,i.jsx)(n.code,{children:"start.duplistatus"}),"\u2014only ",(0,i.jsx)(n.code,{children:"IMAGE"})," is required."]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},6416(e,n,s){s.d(n,{R:()=>r,x:()=>d});var t=s(2128);const i={},o=t.createContext(i);function r(e){const n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);