"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[5782],{2894(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"development/test-scripts","title":"Test Scripts","description":"The project includes several test scripts to help with development and testing:","source":"@site/docs/development/test-scripts.md","sourceDirName":"development","slug":"/development/test-scripts","permalink":"/duplistatus/development/test-scripts","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"mainSidebar","previous":{"title":"Release Management","permalink":"/duplistatus/development/release-management"},"next":{"title":"Workspace Admin Scripts & Commands","permalink":"/duplistatus/development/workspace-admin-scripts-commands"}}');var i=s(7900),r=s(6416);const a={},o="Test Scripts",c={},l=[{value:"Generate Test Data",id:"generate-test-data",level:2},{value:"Show the overdue notifications contents (to debug notification system)",id:"show-the-overdue-notifications-contents-to-debug-notification-system",level:2},{value:"Run overdue-check at a specific date/time (to debug notification system)",id:"run-overdue-check-at-a-specific-datetime-to-debug-notification-system",level:2},{value:"Test cron service port connectivity",id:"test-cron-service-port-connectivity",level:2},{value:"Test overdue detection",id:"test-overdue-detection",level:2},{value:"Validate CSV export",id:"validate-csv-export",level:2},{value:"Temporarily block NTFY server (for testing)",id:"temporarily-block-ntfy-server-for-testing",level:2},{value:"Database Migration Testing",id:"database-migration-testing",level:2},{value:"Generate Migration Test Data",id:"generate-migration-test-data",level:3},{value:"Test Database Migrations",id:"test-database-migrations",level:3},{value:"Set SMTP Test Configuration",id:"set-smtp-test-configuration",level:2},{value:"Test SMTP Connection Type Cross-Compatibility",id:"test-smtp-connection-type-cross-compatibility",level:2},{value:"Test Docker Entrypoint Script",id:"test-docker-entrypoint-script",level:2}];function d(e){const n={code:"code",div:"div",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"test-scripts",children:"Test Scripts"})}),"\n",(0,i.jsx)(n.p,{children:"The project includes several test scripts to help with development and testing:"}),"\n",(0,i.jsx)(n.h2,{id:"generate-test-data",children:"Generate Test Data"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pnpm generate-test-data --servers=N\n"})}),"\n",(0,i.jsx)(n.p,{children:"This script generates test backup data for multiple servers and backups."}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"--servers=N"})," parameter is ",(0,i.jsx)(n.strong,{children:"mandatory"})," and specifies the number of servers to generate (1-30)."]}),"\n",(0,i.jsxs)(n.p,{children:["Use the option ",(0,i.jsx)(n.code,{children:"--upload"})," to send the generated data to the ",(0,i.jsx)(n.code,{children:"/api/upload"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pnpm generate-test-data --servers=N --upload\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Examples:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Generate data for 5 servers\npnpm generate-test-data --servers=5\n\n# Generate data for 1 server with upload mode\npnpm generate-test-data --upload --servers=1\n\n# Generate data for all 30 servers\npnpm generate-test-data --servers=30\n"})}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-caution",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",children:[(0,i.jsx)(n.span,{className:"octicon octicon-caution",style:{"--oct-icon":"url(\"data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' class='octicon octicon-stop mr-2' viewBox='0 0 16 16' version='1.1' width='16' height='16' aria-hidden='true'%3E%3Cpath d='M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z'%3E%3C/path%3E%3C/svg%3E\")"}}),"Caution"]}),"\n",(0,i.jsx)(n.p,{children:"This script deletes all previous data in the database and replaces it with test data.\nBack up your database before running this script."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"show-the-overdue-notifications-contents-to-debug-notification-system",children:"Show the overdue notifications contents (to debug notification system)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pnpm show-overdue-notifications\n"})}),"\n",(0,i.jsx)(n.h2,{id:"run-overdue-check-at-a-specific-datetime-to-debug-notification-system",children:"Run overdue-check at a specific date/time (to debug notification system)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'pnpm run-overdue-check "YYYY-MM-DD HH:MM:SS"\n'})}),"\n",(0,i.jsx)(n.h2,{id:"test-cron-service-port-connectivity",children:"Test cron service port connectivity"}),"\n",(0,i.jsx)(n.p,{children:"To test cron service connectivity, you can:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Check if the cron service is running:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl http://localhost:8667/health\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"Or use the cron service API endpoints directly through the main application:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl http://localhost:8666/api/cron/health\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"Use the test script to verify port connectivity:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pnpm test-cron-port\n"})}),"\n",(0,i.jsx)(n.p,{children:"This script tests the connectivity to the cron service port and provides detailed information about the connection status."}),"\n",(0,i.jsx)(n.h2,{id:"test-overdue-detection",children:"Test overdue detection"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pnpm test-overdue-detection\n"})}),"\n",(0,i.jsx)(n.p,{children:"This script tests the overdue backup detection logic. It verifies:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Overdue backup identification"}),"\n",(0,i.jsx)(n.li,{children:"Notification triggering"}),"\n",(0,i.jsx)(n.li,{children:"Date/time calculations for overdue status"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Useful for debugging overdue backup detection and notification systems."}),"\n",(0,i.jsx)(n.h2,{id:"validate-csv-export",children:"Validate CSV export"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pnpm validate-csv-export\n"})}),"\n",(0,i.jsx)(n.p,{children:"This script validates the CSV export functionality. It:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Tests CSV export generation"}),"\n",(0,i.jsx)(n.li,{children:"Verifies data format and structure"}),"\n",(0,i.jsx)(n.li,{children:"Checks for data integrity in exported files"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Useful for ensuring CSV exports work correctly before releases."}),"\n",(0,i.jsx)(n.h2,{id:"temporarily-block-ntfy-server-for-testing",children:"Temporarily block NTFY server (for testing)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo ./scripts/temporary_ntfy.sh_block.sh\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This script temporarily blocks outgoing network access to the NTFY server (",(0,i.jsx)(n.code,{children:"ntfy.sh"}),") to test the notification retry mechanism. It:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Resolves the IP address of the NTFY server"}),"\n",(0,i.jsx)(n.li,{children:"Adds an iptables rule to block outgoing traffic"}),"\n",(0,i.jsx)(n.li,{children:"Blocks for 10 seconds (configurable)"}),"\n",(0,i.jsx)(n.li,{children:"Automatically removes the block rule on exit"}),"\n",(0,i.jsx)(n.li,{children:"Requires root privileges (sudo)"}),"\n"]}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-caution",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",children:[(0,i.jsx)(n.span,{className:"octicon octicon-caution",style:{"--oct-icon":"url(\"data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' class='octicon octicon-stop mr-2' viewBox='0 0 16 16' version='1.1' width='16' height='16' aria-hidden='true'%3E%3Cpath d='M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z'%3E%3C/path%3E%3C/svg%3E\")"}}),"Caution"]}),"\n",(0,i.jsx)(n.p,{children:"This script modifies iptables rules and requires root privileges. Use only for testing notification retry mechanisms."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"database-migration-testing",children:"Database Migration Testing"}),"\n",(0,i.jsx)(n.p,{children:"The project includes scripts to test database migrations from older versions to the current version. These scripts ensure that database migrations work correctly and preserve data integrity."}),"\n",(0,i.jsx)(n.h3,{id:"generate-migration-test-data",children:"Generate Migration Test Data"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./scripts/generate-migration-test-data.sh\n"})}),"\n",(0,i.jsx)(n.p,{children:"This script generates test databases for multiple historical versions of the application. It:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Stops and removes"})," any existing Docker container"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"For each version"})," (v0.4.0, v0.5.0, v0.6.1, 0.7.27, 0.8.21):","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Removes existing database files"}),"\n",(0,i.jsx)(n.li,{children:"Creates a version tag file"}),"\n",(0,i.jsx)(n.li,{children:"Starts a Docker container with the specific version"}),"\n",(0,i.jsx)(n.li,{children:"Waits for the container to be ready"}),"\n",(0,i.jsxs)(n.li,{children:["Generates test data using ",(0,i.jsx)(n.code,{children:"pnpm generate-test-data"})]}),"\n",(0,i.jsx)(n.li,{children:"Takes a screenshot of the UI with test data"}),"\n",(0,i.jsx)(n.li,{children:"Stops and removes the container"}),"\n",(0,i.jsx)(n.li,{children:"Flushes WAL files and saves the database schema"}),"\n",(0,i.jsxs)(n.li,{children:["Copies the database file to ",(0,i.jsx)(n.code,{children:"scripts/migration_test_data/"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Requirements:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Docker must be installed and configured"}),"\n",(0,i.jsx)(n.li,{children:"Google Chrome (via Puppeteer) must be installed"}),"\n",(0,i.jsx)(n.li,{children:"Root/sudo access for Docker operations"}),"\n",(0,i.jsxs)(n.li,{children:["The Docker volume ",(0,i.jsx)(n.code,{children:"duplistatus_data"})," must exist"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Output:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Database files: ",(0,i.jsx)(n.code,{children:"scripts/migration_test_data/backups_<VERSION>.db"})]}),"\n",(0,i.jsxs)(n.li,{children:["Schema files: ",(0,i.jsx)(n.code,{children:"scripts/migration_test_data/backups_<VERSION>.schema"})]}),"\n",(0,i.jsxs)(n.li,{children:["Screenshots: ",(0,i.jsx)(n.code,{children:"scripts/migration_test_data/duplistatus_test_data_<VERSION>.png"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Configuration:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Number of servers: Set via ",(0,i.jsx)(n.code,{children:"SERVERS"})," variable (default: 3)"]}),"\n",(0,i.jsxs)(n.li,{children:["Data directory: ",(0,i.jsx)(n.code,{children:"/var/lib/docker/volumes/duplistatus_data/_data"})]}),"\n",(0,i.jsx)(n.li,{children:"Port: 9666 (Docker container port)"}),"\n"]}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-caution",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",children:[(0,i.jsx)(n.span,{className:"octicon octicon-caution",style:{"--oct-icon":"url(\"data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' class='octicon octicon-stop mr-2' viewBox='0 0 16 16' version='1.1' width='16' height='16' aria-hidden='true'%3E%3Cpath d='M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z'%3E%3C/path%3E%3C/svg%3E\")"}}),"Caution"]}),"\n",(0,i.jsxs)(n.p,{children:["This script requires Docker and will stop/remove existing containers. It also requires sudo access for Docker operations and file system access. Need to run the ",(0,i.jsx)(n.code,{children:"pnpm take-screenshots"})," script first to install Google Chrome if you haven't already."]}),"\n"]}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-important",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",children:[(0,i.jsx)(n.span,{className:"octicon octicon-important",style:{"--oct-icon":"url(\"data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' class='octicon octicon-report mr-2' viewBox='0 0 16 16' version='1.1' width='16' height='16' aria-hidden='true'%3E%3Cpath d='M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z'%3E%3C/path%3E%3C/svg%3E\")"}}),"Important"]}),"\n",(0,i.jsxs)(n.p,{children:["This script was supposed to run only once, as new versions the developer can copy the database file and screenshots directly to the ",(0,i.jsx)(n.code,{children:"scripts/migration_test_data/"})," directory. During development, just run the ",(0,i.jsx)(n.code,{children:"./scripts/test-migrations.sh"})," script to test the migrations."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"test-database-migrations",children:"Test Database Migrations"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./scripts/test-migrations.sh\n"})}),"\n",(0,i.jsx)(n.p,{children:"This script tests database migrations from old versions to the current version (4.0). It:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"For each version"})," (v0.4.0, v0.5.0, v0.6.1, 0.7.27, 0.8.21):","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Creates a temporary copy of the test database"}),"\n",(0,i.jsxs)(n.li,{children:["Runs the migration process using ",(0,i.jsx)(n.code,{children:"test-migration.ts"})]}),"\n",(0,i.jsx)(n.li,{children:"Validates the migrated database structure"}),"\n",(0,i.jsx)(n.li,{children:"Checks for required tables and columns"}),"\n",(0,i.jsx)(n.li,{children:"Verifies the database version is 4.0"}),"\n",(0,i.jsx)(n.li,{children:"Cleans up temporary files"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Requirements:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Test databases must exist in ",(0,i.jsx)(n.code,{children:"scripts/migration_test_data/"})]}),"\n",(0,i.jsxs)(n.li,{children:["Generated by running ",(0,i.jsx)(n.code,{children:"generate-migration-test-data.sh"})," first"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Output:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Color-coded test results (green for pass, red for fail)"}),"\n",(0,i.jsx)(n.li,{children:"Summary of passed and failed versions"}),"\n",(0,i.jsx)(n.li,{children:"Detailed error messages for failed migrations"}),"\n",(0,i.jsx)(n.li,{children:"Exit code 0 if all tests pass, 1 if any fail"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"What it validates:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Database version is 4.0 after migration"}),"\n",(0,i.jsxs)(n.li,{children:["All required tables exist: ",(0,i.jsx)(n.code,{children:"servers"}),", ",(0,i.jsx)(n.code,{children:"backups"}),", ",(0,i.jsx)(n.code,{children:"configurations"}),", ",(0,i.jsx)(n.code,{children:"users"}),", ",(0,i.jsx)(n.code,{children:"sessions"}),", ",(0,i.jsx)(n.code,{children:"audit_log"}),", ",(0,i.jsx)(n.code,{children:"db_version"})]}),"\n",(0,i.jsx)(n.li,{children:"Required columns exist in each table"}),"\n",(0,i.jsx)(n.li,{children:"Database structure is correct"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example output:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"==========================================\nDatabase Migration Test Suite\n==========================================\n\nTesting migrations from old versions to version 4.0\nTest data directory: /path/to/migration_test_data\nTemporary directory: /path/to/migration_test_data/.tmp\n\n----------------------------------------\nTesting version: v0.4.0\n----------------------------------------\n  Copying database file to temporary location...\n  Running migration test...\n\u2705 Version v0.4.0: Migration test PASSED\n\n==========================================\nTest Summary\n==========================================\n\n\u2705 Passed versions (5):\n  \u2713 v0.4.0\n  \u2713 v0.5.0\n  \u2713 v0.6.1\n  \u2713 0.7.27\n  \u2713 0.8.21\n\nAll migration tests passed!\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Usage:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Run all migration tests\n./scripts/test-migrations.sh\n\n# Check exit code\necho $?  # 0 = all passed, 1 = some failed\n"})}),"\n",(0,i.jsxs)(n.div,{className:"markdown-alert markdown-alert-note",children:["\n",(0,i.jsxs)(n.p,{className:"markdown-alert-title",children:[(0,i.jsx)(n.span,{className:"octicon octicon-note",style:{"--oct-icon":"url(\"data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' class='octicon octicon-info mr-2' viewBox='0 0 16 16' version='1.1' width='16' height='16' aria-hidden='true'%3E%3Cpath d='M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z'%3E%3C/path%3E%3C/svg%3E\")"}}),"Note"]}),"\n",(0,i.jsxs)(n.p,{children:["This script uses the TypeScript migration test script (",(0,i.jsx)(n.code,{children:"test-migration.ts"}),") internally. The test script validates the database structure after migration and ensures data integrity."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"set-smtp-test-configuration",children:"Set SMTP Test Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pnpm set-smtp-test-config <connectionType>\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This script sets SMTP test configuration from environment variables. It accepts a ",(0,i.jsx)(n.code,{children:"connectionType"})," parameter (",(0,i.jsx)(n.code,{children:"plain"}),", ",(0,i.jsx)(n.code,{children:"starttls"}),", or ",(0,i.jsx)(n.code,{children:"ssl"}),") and reads corresponding environment variables with prefixes (",(0,i.jsx)(n.code,{children:"PLAIN_"}),", ",(0,i.jsx)(n.code,{children:"STARTTLS_"}),", ",(0,i.jsx)(n.code,{children:"SSL_"}),") to update the SMTP configuration in the database."]}),"\n",(0,i.jsxs)(n.p,{children:["For plain connections, the script reads ",(0,i.jsx)(n.code,{children:"PLAIN_SMTP_FROM"})," environment variable to set the required From Address. This facilitates testing different SMTP connection types without manual database updates."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Usage:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Set Plain SMTP configuration\nPLAIN_SMTP_HOST=smtp.example.com \\\nPLAIN_SMTP_PORT=25 \\\nPLAIN_SMTP_FROM=noreply@example.com \\\npnpm set-smtp-test-config plain\n\n# Set STARTTLS configuration\nSTARTTLS_SMTP_HOST=smtp.example.com \\\nSTARTTLS_SMTP_PORT=587 \\\nSTARTTLS_SMTP_USERNAME=user@example.com \\\nSTARTTLS_SMTP_PASSWORD=password \\\npnpm set-smtp-test-config starttls\n\n# Set Direct SSL/TLS configuration\nSSL_SMTP_HOST=smtp.example.com \\\nSSL_SMTP_PORT=465 \\\nSSL_SMTP_USERNAME=user@example.com \\\nSSL_SMTP_PASSWORD=password \\\npnpm set-smtp-test-config ssl\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Requirements:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The application must be running"}),"\n",(0,i.jsx)(n.li,{children:"Environment variables must be set with the appropriate prefix for the connection type"}),"\n",(0,i.jsxs)(n.li,{children:["For plain connections, ",(0,i.jsx)(n.code,{children:"PLAIN_SMTP_FROM"})," is required"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"test-smtp-connection-type-cross-compatibility",children:"Test SMTP Connection Type Cross-Compatibility"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pnpm test-smtp-connections\n"})}),"\n",(0,i.jsx)(n.p,{children:"This script performs a comprehensive 3x3 matrix test that validates whether configurations meant for one connection type work correctly with different connection types. For each base configuration type (plain, starttls, ssl), the script:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Reads environment variables with corresponding prefixes (",(0,i.jsx)(n.code,{children:"PLAIN_*"}),", ",(0,i.jsx)(n.code,{children:"STARTTLS_*"}),", ",(0,i.jsx)(n.code,{children:"SSL_*"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["Tests all three connection types by modifying only the ",(0,i.jsx)(n.code,{children:"connectionType"})," field"]}),"\n",(0,i.jsx)(n.li,{children:"Sends test emails via the API"}),"\n",(0,i.jsx)(n.li,{children:"Records results in a matrix format"}),"\n",(0,i.jsx)(n.li,{children:"Displays a summary table"}),"\n",(0,i.jsxs)(n.li,{children:["Saves detailed results to ",(0,i.jsx)(n.code,{children:"smtp-test-results.json"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Usage:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Set environment variables for all three connection types\nPLAIN_SMTP_HOST=smtp.example.com \\\nPLAIN_SMTP_PORT=25 \\\nPLAIN_SMTP_FROM=noreply@example.com \\\nSTARTTLS_SMTP_HOST=smtp.example.com \\\nSTARTTLS_SMTP_PORT=587 \\\nSTARTTLS_SMTP_USERNAME=user@example.com \\\nSTARTTLS_SMTP_PASSWORD=password \\\nSSL_SMTP_HOST=smtp.example.com \\\nSSL_SMTP_PORT=465 \\\nSSL_SMTP_USERNAME=user@example.com \\\nSSL_SMTP_PASSWORD=password \\\npnpm test-smtp-connections\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Requirements:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The application must be running"}),"\n",(0,i.jsx)(n.li,{children:"Environment variables must be set for all three connection types"}),"\n",(0,i.jsx)(n.li,{children:"The script validates the configuration being used through detailed logging"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Expected Behavior:"}),"\nConfigurations should only work with their intended connection type (e.g., plain config works with plain connectionType but fails with starttls/ssl)."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Output:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Console output with a summary table showing test results"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"smtp-test-results.json"})," file with detailed test results for each configuration and connection type combination"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"test-docker-entrypoint-script",children:"Test Docker Entrypoint Script"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pnpm test-entrypoint\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This script provides a test wrapper for ",(0,i.jsx)(n.code,{children:"docker-entrypoint.sh"})," in local development. It sets up the environment to test the entrypoint logging functionality and ensures logs are written to ",(0,i.jsx)(n.code,{children:"data/logs/"})," so the application can access them."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"What it does:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Always builds a fresh version"}),": Automatically runs ",(0,i.jsx)(n.code,{children:"pnpm build-local"})," to create a fresh build before testing (no need to manually build first)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Builds cron service"}),": Ensures the cron service is built (",(0,i.jsx)(n.code,{children:"dist/cron-service.cjs"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Sets up Docker-like structure"}),": Creates necessary symlinks and directory structure to mimic the Docker environment"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Runs entrypoint script"}),": Executes ",(0,i.jsx)(n.code,{children:"docker-entrypoint.sh"})," with proper environment variables"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cleans up"}),": Automatically removes temporary files on exit"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Usage:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Run the test (builds fresh version automatically)\npnpm test-entrypoint\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Environment Variables:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"PORT=8666"})," - Port for the Next.js server (matches ",(0,i.jsx)(n.code,{children:"start-local"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"CRON_PORT=8667"})," - Port for the cron service"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"VERSION"})," - Automatically set to ",(0,i.jsx)(n.code,{children:"test-YYYYMMDD-HHMMSS"})," format"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Output:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Logs are written to ",(0,i.jsx)(n.code,{children:"data/logs/application.log"})," (accessible by the application)"]}),"\n",(0,i.jsx)(n.li,{children:"Console output shows the entrypoint script execution"}),"\n",(0,i.jsx)(n.li,{children:"Press Ctrl+C to stop and test log flushing"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Requirements:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Script must be run from the repository root directory (pnpm handles this automatically)"}),"\n",(0,i.jsx)(n.li,{children:"The script automatically handles all prerequisites (build, cron service, etc.)"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Testing entrypoint script changes locally before Docker deployment"}),"\n",(0,i.jsx)(n.li,{children:"Verifying log rotation and logging functionality"}),"\n",(0,i.jsx)(n.li,{children:"Testing graceful shutdown and signal handling"}),"\n",(0,i.jsx)(n.li,{children:"Debugging entrypoint script behavior in a local environment"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},6416(e,n,s){s.d(n,{R:()=>a,x:()=>o});var t=s(2128);const i={},r=t.createContext(i);function a(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);