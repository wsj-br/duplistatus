"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[952],{159(e,s,d){d.r(s),d.d(s,{assets:()=>c,contentTitle:()=>t,default:()=>x,frontMatter:()=>l,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"development/database","title":"Database Schema","description":"This document describes the SQLite database schema used by duplistatus to store backup operation data.","source":"@site/docs/development/database.md","sourceDirName":"development","slug":"/development/database","permalink":"/duplistatus/development/database","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"mainSidebar","previous":{"title":"Most used commands","permalink":"/duplistatus/development/devel"},"next":{"title":"Documentation Tools","permalink":"/duplistatus/development/documentation-tools"}}');var n=d(7900),r=d(6493);const l={},t="Database Schema",c={},a=[{value:"Database Location",id:"database-location",level:2},{value:"Database Migration System",id:"database-migration-system",level:2},{value:"Migration Version History",id:"migration-version-history",level:3},{value:"Migration Process",id:"migration-process",level:3},{value:"Tables",id:"tables",level:2},{value:"Servers Table",id:"servers-table",level:3},{value:"Fields",id:"fields",level:4},{value:"Backups Table",id:"backups-table",level:3},{value:"Key Fields",id:"key-fields",level:4},{value:"Message Arrays (JSON Storage)",id:"message-arrays-json-storage",level:4},{value:"File Operation Fields",id:"file-operation-fields",level:4},{value:"File Size Fields",id:"file-size-fields",level:4},{value:"Operation Status Fields",id:"operation-status-fields",level:4},{value:"Backend Statistics Fields",id:"backend-statistics-fields",level:4},{value:"Configurations Table",id:"configurations-table",level:3},{value:"Fields",id:"fields-1",level:4},{value:"Common Configuration Keys",id:"common-configuration-keys",level:4},{value:"Database Version Table",id:"database-version-table",level:3},{value:"Fields",id:"fields-2",level:4},{value:"Users Table",id:"users-table",level:3},{value:"Fields",id:"fields-3",level:4},{value:"Sessions Table",id:"sessions-table",level:3},{value:"Fields",id:"fields-4",level:4},{value:"Audit Log Table",id:"audit-log-table",level:3},{value:"Fields",id:"fields-5",level:4},{value:"Session Management",id:"session-management",level:2},{value:"Database-Backed Session Storage",id:"database-backed-session-storage",level:3},{value:"Session API Endpoints",id:"session-api-endpoints",level:3},{value:"Indexes",id:"indexes",level:2},{value:"Relationships",id:"relationships",level:2},{value:"Data Types",id:"data-types",level:2},{value:"Backup Status Values",id:"backup-status-values",level:2},{value:"Common Queries",id:"common-queries",level:2},{value:"Get Latest Backup for a Server",id:"get-latest-backup-for-a-server",level:3},{value:"Get All Backups for a Server",id:"get-all-backups-for-a-server",level:3},{value:"Get Server Summary",id:"get-server-summary",level:3},{value:"Get Overall Summary",id:"get-overall-summary",level:3},{value:"Database Cleanup",id:"database-cleanup",level:3},{value:"JSON to Database Mapping",id:"json-to-database-mapping",level:2},{value:"API Request Body to Database Columns Mapping",id:"api-request-body-to-database-columns-mapping",level:3}];function h(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.header,{children:(0,n.jsx)(s.h1,{id:"database-schema",children:"Database Schema"})}),"\n",(0,n.jsx)(s.p,{children:"This document describes the SQLite database schema used by duplistatus to store backup operation data."}),"\n",(0,n.jsx)(s.h2,{id:"database-location",children:"Database Location"}),"\n",(0,n.jsx)(s.p,{children:"The database is stored in the application data directory:"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Default Location"}),": ",(0,n.jsx)(s.code,{children:"/app/data/backups.db"})]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Docker Volume"}),": ",(0,n.jsx)(s.code,{children:"duplistatus_data:/app/data"})]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"File Name"}),": ",(0,n.jsx)(s.code,{children:"backups.db"})]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"database-migration-system",children:"Database Migration System"}),"\n",(0,n.jsx)(s.p,{children:"duplistatus uses an automated migration system to handle database schema changes between versions."}),"\n",(0,n.jsx)(s.h3,{id:"migration-version-history",children:"Migration Version History"}),"\n",(0,n.jsx)(s.p,{children:"The following are historical migration versions that brought the database to its current state:"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Schema v1.0"})," (Application v0.6.x and earlier): Initial database schema with machines and backups tables"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Schema v2.0"})," (Application v0.7.x): Added missing columns and configurations table"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Schema v3.0"})," (Application v0.7.x): Renamed machines table to servers, added server_url column"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Schema v3.1"})," (Application v0.8.x): Enhanced backup data fields, added server_password column"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Schema v4.0"})," (Application v0.9.x / v1.0.x): Added User Access Control (users, sessions, audit_log tables)"]}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:["Current application version (v1.1.0) uses ",(0,n.jsx)(s.strong,{children:"Schema v4.0"})," as the latest database schema version."]}),"\n",(0,n.jsx)(s.h3,{id:"migration-process",children:"Migration Process"}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Automatic Backup"}),": Creates backup before migration"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Schema Update"}),": Updates database structure"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Data Migration"}),": Preserves existing data"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Verification"}),": Confirms successful migration"]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"tables",children:"Tables"}),"\n",(0,n.jsx)(s.h3,{id:"servers-table",children:"Servers Table"}),"\n",(0,n.jsx)(s.p,{children:"Stores information about Duplicati servers being monitored."}),"\n",(0,n.jsx)(s.h4,{id:"fields",children:"Fields"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Field"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"id"})}),(0,n.jsx)(s.td,{children:"TEXT PRIMARY KEY"}),(0,n.jsx)(s.td,{children:"Unique server identifier"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"name"})}),(0,n.jsx)(s.td,{children:"TEXT NOT NULL"}),(0,n.jsx)(s.td,{children:"Server name from Duplicati"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"server_url"})}),(0,n.jsx)(s.td,{children:"TEXT"}),(0,n.jsx)(s.td,{children:"Duplicati server URL"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"alias"})}),(0,n.jsx)(s.td,{children:"TEXT"}),(0,n.jsx)(s.td,{children:"User-defined friendly name"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"note"})}),(0,n.jsx)(s.td,{children:"TEXT"}),(0,n.jsx)(s.td,{children:"User-defined notes/description"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"server_password"})}),(0,n.jsx)(s.td,{children:"TEXT"}),(0,n.jsx)(s.td,{children:"Server password for authentication"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"created_at"})}),(0,n.jsx)(s.td,{children:"DATETIME"}),(0,n.jsx)(s.td,{children:"Server creation timestamp"})]})]})]}),"\n",(0,n.jsx)(s.h3,{id:"backups-table",children:"Backups Table"}),"\n",(0,n.jsx)(s.p,{children:"Stores backup operation data received from Duplicati servers."}),"\n",(0,n.jsx)(s.h4,{id:"key-fields",children:"Key Fields"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Field"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"id"})}),(0,n.jsx)(s.td,{children:"TEXT PRIMARY KEY"}),(0,n.jsx)(s.td,{children:"Unique backup identifier"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"server_id"})}),(0,n.jsx)(s.td,{children:"TEXT NOT NULL"}),(0,n.jsx)(s.td,{children:"Reference to servers table"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"backup_name"})}),(0,n.jsx)(s.td,{children:"TEXT NOT NULL"}),(0,n.jsx)(s.td,{children:"Backup job name"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"backup_id"})}),(0,n.jsx)(s.td,{children:"TEXT NOT NULL"}),(0,n.jsx)(s.td,{children:"Backup ID from Duplicati"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"date"})}),(0,n.jsx)(s.td,{children:"DATETIME NOT NULL"}),(0,n.jsx)(s.td,{children:"Backup execution time"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"status"})}),(0,n.jsx)(s.td,{children:"TEXT NOT NULL"}),(0,n.jsx)(s.td,{children:"Backup status (Success, Warning, Error, Fatal)"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"duration_seconds"})}),(0,n.jsx)(s.td,{children:"INTEGER NOT NULL"}),(0,n.jsx)(s.td,{children:"Duration in seconds"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"size"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Size of source files"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"uploaded_size"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Size of uploaded data"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"examined_files"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Number of files examined"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"warnings"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Number of warnings"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"errors"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Number of errors"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"created_at"})}),(0,n.jsx)(s.td,{children:"DATETIME"}),(0,n.jsx)(s.td,{children:"Record creation timestamp"})]})]})]}),"\n",(0,n.jsx)(s.h4,{id:"message-arrays-json-storage",children:"Message Arrays (JSON Storage)"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Field"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"messages_array"})}),(0,n.jsx)(s.td,{children:"TEXT"}),(0,n.jsx)(s.td,{children:"JSON array of log messages"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"warnings_array"})}),(0,n.jsx)(s.td,{children:"TEXT"}),(0,n.jsx)(s.td,{children:"JSON array of warning messages"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"errors_array"})}),(0,n.jsx)(s.td,{children:"TEXT"}),(0,n.jsx)(s.td,{children:"JSON array of error messages"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"available_backups"})}),(0,n.jsx)(s.td,{children:"TEXT"}),(0,n.jsx)(s.td,{children:"JSON array of available backup versions"})]})]})]}),"\n",(0,n.jsx)(s.h4,{id:"file-operation-fields",children:"File Operation Fields"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Field"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"examined_files"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Files examined during backup"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"opened_files"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Files opened for backup"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"added_files"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"New files added to backup"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"modified_files"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Files modified in backup"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"deleted_files"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Files deleted from backup"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"deleted_folders"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Folders deleted from backup"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"added_folders"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Folders added to backup"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"modified_folders"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Folders modified in backup"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"not_processed_files"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Files not processed"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"too_large_files"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Files too large to process"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"files_with_error"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Files with errors"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"added_symlinks"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Symbolic links added"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"modified_symlinks"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Symbolic links modified"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"deleted_symlinks"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Symbolic links deleted"})]})]})]}),"\n",(0,n.jsx)(s.h4,{id:"file-size-fields",children:"File Size Fields"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Field"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"size_of_examined_files"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Size of files examined during backup"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"size_of_opened_files"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Size of files opened for backup"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"size_of_added_files"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Size of new files added to backup"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"size_of_modified_files"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Size of files modified in backup"})]})]})]}),"\n",(0,n.jsx)(s.h4,{id:"operation-status-fields",children:"Operation Status Fields"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Field"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"parsed_result"})}),(0,n.jsx)(s.td,{children:"TEXT NOT NULL"}),(0,n.jsx)(s.td,{children:"Parsed operation result"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"main_operation"})}),(0,n.jsx)(s.td,{children:"TEXT NOT NULL"}),(0,n.jsx)(s.td,{children:"Main operation type"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"interrupted"})}),(0,n.jsx)(s.td,{children:"BOOLEAN"}),(0,n.jsx)(s.td,{children:"Whether backup was interrupted"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"partial_backup"})}),(0,n.jsx)(s.td,{children:"BOOLEAN"}),(0,n.jsx)(s.td,{children:"Whether backup was partial"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"dryrun"})}),(0,n.jsx)(s.td,{children:"BOOLEAN"}),(0,n.jsx)(s.td,{children:"Whether backup was a dry run"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"version"})}),(0,n.jsx)(s.td,{children:"TEXT"}),(0,n.jsx)(s.td,{children:"Duplicati version used"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"begin_time"})}),(0,n.jsx)(s.td,{children:"DATETIME NOT NULL"}),(0,n.jsx)(s.td,{children:"Backup start time"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"end_time"})}),(0,n.jsx)(s.td,{children:"DATETIME NOT NULL"}),(0,n.jsx)(s.td,{children:"Backup end time"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"warnings_actual_length"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Actual warnings count"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"errors_actual_length"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Actual errors count"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"messages_actual_length"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Actual messages count"})]})]})]}),"\n",(0,n.jsx)(s.h4,{id:"backend-statistics-fields",children:"Backend Statistics Fields"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Field"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"bytes_downloaded"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Bytes downloaded from destination"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"known_file_size"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Known file size on destination"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"last_backup_date"})}),(0,n.jsx)(s.td,{children:"DATETIME"}),(0,n.jsx)(s.td,{children:"Last backup date on destination"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"backup_list_count"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Number of backup versions"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"reported_quota_error"})}),(0,n.jsx)(s.td,{children:"BOOLEAN"}),(0,n.jsx)(s.td,{children:"Quota error reported"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"reported_quota_warning"})}),(0,n.jsx)(s.td,{children:"BOOLEAN"}),(0,n.jsx)(s.td,{children:"Quota warning reported"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"backend_main_operation"})}),(0,n.jsx)(s.td,{children:"TEXT"}),(0,n.jsx)(s.td,{children:"Backend main operation"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"backend_parsed_result"})}),(0,n.jsx)(s.td,{children:"TEXT"}),(0,n.jsx)(s.td,{children:"Backend parsed result"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"backend_interrupted"})}),(0,n.jsx)(s.td,{children:"BOOLEAN"}),(0,n.jsx)(s.td,{children:"Backend operation interrupted"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"backend_version"})}),(0,n.jsx)(s.td,{children:"TEXT"}),(0,n.jsx)(s.td,{children:"Backend version"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"backend_begin_time"})}),(0,n.jsx)(s.td,{children:"DATETIME"}),(0,n.jsx)(s.td,{children:"Backend operation start time"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"backend_duration"})}),(0,n.jsx)(s.td,{children:"TEXT"}),(0,n.jsx)(s.td,{children:"Backend operation duration"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"backend_warnings_actual_length"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Backend warnings count"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"backend_errors_actual_length"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Backend errors count"})]})]})]}),"\n",(0,n.jsx)(s.h3,{id:"configurations-table",children:"Configurations Table"}),"\n",(0,n.jsx)(s.p,{children:"Stores application configuration settings."}),"\n",(0,n.jsx)(s.h4,{id:"fields-1",children:"Fields"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Field"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"key"})}),(0,n.jsx)(s.td,{children:"TEXT PRIMARY KEY NOT NULL"}),(0,n.jsx)(s.td,{children:"Configuration key"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"value"})}),(0,n.jsx)(s.td,{children:"TEXT"}),(0,n.jsx)(s.td,{children:"Configuration value (JSON)"})]})]})]}),"\n",(0,n.jsx)(s.h4,{id:"common-configuration-keys",children:"Common Configuration Keys"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"email_config"}),": Email notification settings"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"ntfy_config"}),": NTFY notification settings"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"overdue_tolerance"}),": Overdue backup tolerance settings"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"notification_templates"}),": Notification message templates"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"audit_retention_days"}),": Audit log retention period (default: 90 days)"]}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"database-version-table",children:"Database Version Table"}),"\n",(0,n.jsx)(s.p,{children:"Tracks database schema version for migration purposes."}),"\n",(0,n.jsx)(s.h4,{id:"fields-2",children:"Fields"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Field"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"version"})}),(0,n.jsx)(s.td,{children:"TEXT PRIMARY KEY"}),(0,n.jsx)(s.td,{children:"Database version"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"applied_at"})}),(0,n.jsx)(s.td,{children:"DATETIME"}),(0,n.jsx)(s.td,{children:"When migration was applied"})]})]})]}),"\n",(0,n.jsx)(s.h3,{id:"users-table",children:"Users Table"}),"\n",(0,n.jsx)(s.p,{children:"Stores user account information for authentication and access control."}),"\n",(0,n.jsx)(s.h4,{id:"fields-3",children:"Fields"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Field"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"id"})}),(0,n.jsx)(s.td,{children:"TEXT PRIMARY KEY"}),(0,n.jsx)(s.td,{children:"Unique user identifier"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"username"})}),(0,n.jsx)(s.td,{children:"TEXT UNIQUE NOT NULL"}),(0,n.jsx)(s.td,{children:"Username for login"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"password_hash"})}),(0,n.jsx)(s.td,{children:"TEXT NOT NULL"}),(0,n.jsx)(s.td,{children:"Bcrypt hashed password"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"is_admin"})}),(0,n.jsx)(s.td,{children:"BOOLEAN NOT NULL"}),(0,n.jsx)(s.td,{children:"Whether user has admin privileges"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"must_change_password"})}),(0,n.jsx)(s.td,{children:"BOOLEAN"}),(0,n.jsx)(s.td,{children:"Whether password change is required"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"created_at"})}),(0,n.jsx)(s.td,{children:"DATETIME"}),(0,n.jsx)(s.td,{children:"Account creation timestamp"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"updated_at"})}),(0,n.jsx)(s.td,{children:"DATETIME"}),(0,n.jsx)(s.td,{children:"Last update timestamp"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"last_login_at"})}),(0,n.jsx)(s.td,{children:"DATETIME"}),(0,n.jsx)(s.td,{children:"Last successful login timestamp"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"last_login_ip"})}),(0,n.jsx)(s.td,{children:"TEXT"}),(0,n.jsx)(s.td,{children:"IP address of last login"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"failed_login_attempts"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Count of failed login attempts"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"locked_until"})}),(0,n.jsx)(s.td,{children:"DATETIME"}),(0,n.jsx)(s.td,{children:"Account lock expiration (if locked)"})]})]})]}),"\n",(0,n.jsx)(s.h3,{id:"sessions-table",children:"Sessions Table"}),"\n",(0,n.jsx)(s.p,{children:"Stores user session data for authentication and security."}),"\n",(0,n.jsx)(s.h4,{id:"fields-4",children:"Fields"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Field"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"id"})}),(0,n.jsx)(s.td,{children:"TEXT PRIMARY KEY"}),(0,n.jsx)(s.td,{children:"Session identifier"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"user_id"})}),(0,n.jsx)(s.td,{children:"TEXT"}),(0,n.jsx)(s.td,{children:"Reference to users table (nullable for unauthenticated sessions)"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"created_at"})}),(0,n.jsx)(s.td,{children:"DATETIME"}),(0,n.jsx)(s.td,{children:"Session creation timestamp"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"last_accessed"})}),(0,n.jsx)(s.td,{children:"DATETIME"}),(0,n.jsx)(s.td,{children:"Last access timestamp"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"expires_at"})}),(0,n.jsx)(s.td,{children:"DATETIME NOT NULL"}),(0,n.jsx)(s.td,{children:"Session expiration timestamp"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"ip_address"})}),(0,n.jsx)(s.td,{children:"TEXT"}),(0,n.jsx)(s.td,{children:"IP address of session origin"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"user_agent"})}),(0,n.jsx)(s.td,{children:"TEXT"}),(0,n.jsx)(s.td,{children:"User agent string"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"csrf_token"})}),(0,n.jsx)(s.td,{children:"TEXT"}),(0,n.jsx)(s.td,{children:"CSRF token for the session"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"csrf_expires_at"})}),(0,n.jsx)(s.td,{children:"DATETIME"}),(0,n.jsx)(s.td,{children:"CSRF token expiration"})]})]})]}),"\n",(0,n.jsx)(s.h3,{id:"audit-log-table",children:"Audit Log Table"}),"\n",(0,n.jsx)(s.p,{children:"Stores audit trail of user actions and system events."}),"\n",(0,n.jsx)(s.h4,{id:"fields-5",children:"Fields"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Field"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"id"})}),(0,n.jsx)(s.td,{children:"INTEGER PRIMARY KEY AUTOINCREMENT"}),(0,n.jsx)(s.td,{children:"Unique audit log entry identifier"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"timestamp"})}),(0,n.jsx)(s.td,{children:"DATETIME"}),(0,n.jsx)(s.td,{children:"Event timestamp"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"user_id"})}),(0,n.jsx)(s.td,{children:"TEXT"}),(0,n.jsx)(s.td,{children:"Reference to users table (nullable)"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"username"})}),(0,n.jsx)(s.td,{children:"TEXT"}),(0,n.jsx)(s.td,{children:"Username at time of action"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"action"})}),(0,n.jsx)(s.td,{children:"TEXT NOT NULL"}),(0,n.jsx)(s.td,{children:"Action performed"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"category"})}),(0,n.jsx)(s.td,{children:"TEXT NOT NULL"}),(0,n.jsx)(s.td,{children:"Category of action (e.g., 'authentication', 'settings', 'backup')"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"target_type"})}),(0,n.jsx)(s.td,{children:"TEXT"}),(0,n.jsx)(s.td,{children:"Type of target (e.g., 'server', 'backup', 'user')"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"target_id"})}),(0,n.jsx)(s.td,{children:"TEXT"}),(0,n.jsx)(s.td,{children:"Identifier of target"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"details"})}),(0,n.jsx)(s.td,{children:"TEXT"}),(0,n.jsx)(s.td,{children:"Additional details (JSON)"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"ip_address"})}),(0,n.jsx)(s.td,{children:"TEXT"}),(0,n.jsx)(s.td,{children:"IP address of requester"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"user_agent"})}),(0,n.jsx)(s.td,{children:"TEXT"}),(0,n.jsx)(s.td,{children:"User agent string"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"status"})}),(0,n.jsx)(s.td,{children:"TEXT NOT NULL"}),(0,n.jsx)(s.td,{children:"Status of action ('success', 'failure', 'error')"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"error_message"})}),(0,n.jsx)(s.td,{children:"TEXT"}),(0,n.jsx)(s.td,{children:"Error message if action failed"})]})]})]}),"\n",(0,n.jsx)(s.h2,{id:"session-management",children:"Session Management"}),"\n",(0,n.jsx)(s.h3,{id:"database-backed-session-storage",children:"Database-Backed Session Storage"}),"\n",(0,n.jsx)(s.p,{children:"Sessions are stored in the database with in-memory fallback:"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Primary Storage"}),": Database-backed sessions table"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Fallback"}),": In-memory storage (legacy support or error cases)"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Session ID"}),": Cryptographically secure random string"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Expiration"}),": Configurable session timeout"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"CSRF Protection"}),": Cross-site request forgery protection"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Automatic Cleanup"}),": Expired sessions are automatically removed"]}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"session-api-endpoints",children:"Session API Endpoints"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"POST /api/session"}),": Create new session"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"GET /api/session"}),": Validate existing session"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"DELETE /api/session"}),": Destroy session"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"GET /api/csrf"}),": Get CSRF token"]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"indexes",children:"Indexes"}),"\n",(0,n.jsx)(s.p,{children:"The database includes several indexes for optimal query performance:"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Primary Keys"}),": All tables have primary key indexes"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Foreign Keys"}),": Server references in backups table, user references in sessions and audit_log"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Query Optimisation"}),": Indexes on frequently queried fields"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Date Indexes"}),": Indexes on date fields for time-based queries"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"User Indexes"}),": Username index for fast user lookups"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Session Indexes"}),": Expiration and user_id indexes for session management"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Audit Indexes"}),": Timestamp, user_id, action, category, and status indexes for audit queries"]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"relationships",children:"Relationships"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Servers \u2192 Backups"}),": One-to-many relationship"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Users \u2192 Sessions"}),": One-to-many relationship (sessions can exist without users)"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Users \u2192 Audit Log"}),": One-to-many relationship (audit entries can exist without users)"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Backups \u2192 Messages"}),": Embedded JSON arrays"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Configurations"}),": Key-value storage"]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"data-types",children:"Data Types"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"TEXT"}),": String data, JSON arrays"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"INTEGER"}),": Numeric data, file counts, sizes"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"REAL"}),": Floating-point numbers, durations"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"DATETIME"}),": Timestamp data"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"BOOLEAN"}),": True/false values"]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"backup-status-values",children:"Backup Status Values"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Success"}),": Backup completed successfully"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Warning"}),": Backup completed with warnings"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Error"}),": Backup completed with errors"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Fatal"}),": Backup failed fatally"]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"common-queries",children:"Common Queries"}),"\n",(0,n.jsx)(s.h3,{id:"get-latest-backup-for-a-server",children:"Get Latest Backup for a Server"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-sql",children:"SELECT * FROM backups \nWHERE server_id = ? \nORDER BY date DESC \nLIMIT 1;\n"})}),"\n",(0,n.jsx)(s.h3,{id:"get-all-backups-for-a-server",children:"Get All Backups for a Server"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-sql",children:"SELECT * FROM backups \nWHERE server_id = ? \nORDER BY date DESC;\n"})}),"\n",(0,n.jsx)(s.h3,{id:"get-server-summary",children:"Get Server Summary"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-sql",children:"SELECT \n  s.name,\n  s.alias,\n  COUNT(b.id) as backup_count,\n  MAX(b.date) as last_backup,\n  b.status as last_status\nFROM servers s\nLEFT JOIN backups b ON s.id = b.server_id\nGROUP BY s.id;\n"})}),"\n",(0,n.jsx)(s.h3,{id:"get-overall-summary",children:"Get Overall Summary"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-sql",children:"SELECT \n  COUNT(DISTINCT s.id) as total_servers,\n  COUNT(b.id) as total_backups_runs,\n  COUNT(DISTINCT s.id || ':' || b.backup_name) as total_backups,\n  COALESCE(SUM(b.uploaded_size), 0) as total_uploaded_size,\n  (\n    SELECT COALESCE(SUM(b2.known_file_size), 0)\n    FROM backups b2\n    INNER JOIN (\n      SELECT server_id, MAX(date) as max_date\n      FROM backups\n      GROUP BY server_id\n    ) latest ON b2.server_id = latest.server_id AND b2.date = latest.max_date\n  ) as total_storage_used,\n  (\n    SELECT COALESCE(SUM(b2.size_of_examined_files), 0)\n    FROM backups b2\n    INNER JOIN (\n      SELECT server_id, MAX(date) as max_date\n      FROM backups\n      GROUP BY server_id\n    ) latest ON b2.server_id = latest.server_id AND b2.date = latest.max_date\n  ) as total_backuped_size\nFROM servers s\nLEFT JOIN backups b ON b.server_id = s.id;\n"})}),"\n",(0,n.jsx)(s.h3,{id:"database-cleanup",children:"Database Cleanup"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-sql",children:"-- Delete old backups (older than 30 days)\nDELETE FROM backups \nWHERE date < datetime('now', '-30 days');\n\n-- Delete servers with no backups\nDELETE FROM servers \nWHERE id NOT IN (SELECT DISTINCT server_id FROM backups);\n"})}),"\n",(0,n.jsx)(s.h2,{id:"json-to-database-mapping",children:"JSON to Database Mapping"}),"\n",(0,n.jsx)(s.h3,{id:"api-request-body-to-database-columns-mapping",children:"API Request Body to Database Columns Mapping"}),"\n",(0,n.jsx)(s.p,{children:"When Duplicati sends backup data via HTTP POST, the JSON structure is mapped to database columns:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-json",children:'{\n  "Data": {\n    "ExaminedFiles": 15399,           // \u2192 examined_files\n    "OpenedFiles": 1861,              // \u2192 opened_files\n    "AddedFiles": 1861,               // \u2192 added_files\n    "SizeOfExaminedFiles": 11086692615, // \u2192 size_of_examined_files\n    "SizeOfOpenedFiles": 13450481,    // \u2192 size_of_opened_files\n    "SizeOfAddedFiles": 13450481,     // \u2192 size_of_added_files\n    "SizeOfModifiedFiles": 0,         // \u2192 size_of_modified_files\n    "ParsedResult": "Success",        // \u2192 status\n    "BeginTime": "2025-04-21T23:45:46.9712217Z", // \u2192 begin_time and date\n    "Duration": "00:00:51.3856057",   // \u2192 duration_seconds (calculated)\n    "WarningsActualLength": 0,        // \u2192 warnings_actual_length\n    "ErrorsActualLength": 0           // \u2192 errors_actual_length\n  },\n  "Extra": {\n    "machine-id": "66f5ffc7ff474a73a3c9cba4ac7bfb65", // \u2192 server_id\n    "machine-name": "WSJ-SER5",       // \u2192 server name\n    "backup-name": "WSJ-SER5 Local files", // \u2192 backup_name\n    "backup-id": "DB-2"               // \u2192 backup_id\n  }\n}\n'})}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"Note"}),": The ",(0,n.jsx)(s.code,{children:"size"})," field in the backups table stores ",(0,n.jsx)(s.code,{children:"SizeOfExaminedFiles"})," and ",(0,n.jsx)(s.code,{children:"uploaded_size"})," stores the actual uploaded/transferred size from the backup operation."]})]})}function x(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},6493(e,s,d){d.d(s,{R:()=>l,x:()=>t});var i=d(2128);const n={},r=i.createContext(n);function l(e){const s=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:l(e.components),i.createElement(r.Provider,{value:s},e.children)}}}]);