"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[463],{17440(e,s,a){a.r(s),a.d(s,{assets:()=>d,contentTitle:()=>o,default:()=>p,frontMatter:()=>t,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"development/test-scripts","title":"Scripts de Teste","description":"test-scripts}","source":"@site/i18n/pt-BR/docusaurus-plugin-content-docs/current/development/test-scripts.md","sourceDirName":"development","slug":"/development/test-scripts","permalink":"/duplistatus/pt-BR/development/test-scripts","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"translation_last_updated":"2026-02-16T00:13:40.635Z","source_file_mtime":"2026-02-01T03:16:19.469Z","source_file_hash":"6f3df4c1ef3576bd","translation_language":"pt-BR","source_file_path":"development/test-scripts.md"},"sidebar":"mainSidebar","previous":{"title":"Gerenciamento de Lan\xe7amentos","permalink":"/duplistatus/pt-BR/development/release-management"},"next":{"title":"Scripts e Comandos do Admin do Workspace","permalink":"/duplistatus/pt-BR/development/workspace-admin-scripts-commands"}}');var r=a(36259),i=a(73230);const t={translation_last_updated:"2026-02-16T00:13:40.635Z",source_file_mtime:"2026-02-01T03:16:19.469Z",source_file_hash:"6f3df4c1ef3576bd",translation_language:"pt-BR",source_file_path:"development/test-scripts.md"},o="Scripts de Teste {#test-scripts}",d={},c=[{value:"Gerar Dados de Testar",id:"generate-test-data",level:2},{value:"Mostrar o conte\xfado das notifica\xe7\xf5es atrasadas (para depurar o sistema de notifica\xe7\xf5es)",id:"show-the-overdue-notifications-contents-to-debug-notification-system",level:2},{value:"Executar verifica\xe7\xe3o de atrasado em uma data/hora espec\xedfica (para depurar o sistema de notifica\xe7\xe3o)",id:"run-overdue-check-at-a-specific-datetime-to-debug-notification-system",level:2},{value:"Testar conectividade da porta do servi\xe7o cron",id:"test-cron-service-port-connectivity",level:2},{value:"Testar detec\xe7\xe3o de atrasado",id:"test-overdue-detection",level:2},{value:"Validar exporta\xe7\xe3o CSV",id:"validate-csv-export",level:2},{value:"Bloquear temporariamente o servidor NTFY (para testes)",id:"temporarily-block-ntfy-server-for-testing",level:2},{value:"Testes de Migra\xe7\xe3o de Banco de Dados",id:"database-migration-testing",level:2},{value:"Gerar Dados de Teste de Migra\xe7\xe3o",id:"generate-migration-test-data",level:3},{value:"Migra\xe7\xf5es de Banco de Dados de Teste",id:"test-database-migrations",level:3},{value:"Configurar Teste de SMTP",id:"set-smtp-test-configuration",level:2},{value:"Testar Tipo de conex\xe3o SMTP Cross-Compatibility",id:"test-smtp-connection-type-cross-compatibility",level:2},{value:"Testar Script de Entrypoint Docker",id:"test-docker-entrypoint-script",level:2}];function l(e){const s={code:"code",div:"div",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"test-scripts",children:"Scripts de Teste"})}),"\n",(0,r.jsx)(s.p,{children:"O projeto inclui v\xe1rios scripts de teste para ajudar no desenvolvimento e testes:"}),"\n",(0,r.jsx)(s.h2,{id:"generate-test-data",children:"Gerar Dados de Testar"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"pnpm generate-test-data --servers=N\n"})}),"\n",(0,r.jsx)(s.p,{children:"Este script gera dados de backup de teste para m\xfaltiplos servidores e backups."}),"\n",(0,r.jsxs)(s.p,{children:["O par\xe2metro ",(0,r.jsx)(s.code,{children:"--servers=N"})," \xe9 ",(0,r.jsx)(s.strong,{children:"obrigat\xf3rio"})," e especifica o n\xfamero de servidores a gerar (1-30)."]}),"\n",(0,r.jsxs)(s.p,{children:["Use a op\xe7\xe3o ",(0,r.jsx)(s.code,{children:"--upload"})," para enviar os dados gerados para ",(0,r.jsx)(s.code,{children:"/api/upload"})]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"pnpm generate-test-data --servers=N --upload\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Exemplos:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"# Generate data for 5 servers\npnpm generate-test-data --servers=5\n\n# Generate data for 1 server with upload mode\npnpm generate-test-data --upload --servers=1\n\n# Generate data for all 30 servers\npnpm generate-test-data --servers=30\n"})}),"\n",(0,r.jsxs)(s.div,{className:"markdown-alert markdown-alert-caution",children:["\n",(0,r.jsxs)(s.p,{className:"markdown-alert-title",children:[(0,r.jsx)(s.span,{className:"octicon octicon-caution",style:{"--oct-icon":"url(\"data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' class='octicon octicon-stop mr-2' viewBox='0 0 16 16' version='1.1' width='16' height='16' aria-hidden='true'%3E%3Cpath d='M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z'%3E%3C/path%3E%3C/svg%3E\")"}}),"Caution"]}),"\n",(0,r.jsx)(s.p,{children:"Este script deleta todos os dados anteriores no banco de dados e os substitui por dados de teste.\nFa\xe7a backup do seu banco de dados antes de executar este script."}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"show-the-overdue-notifications-contents-to-debug-notification-system",children:"Mostrar o conte\xfado das notifica\xe7\xf5es atrasadas (para depurar o sistema de notifica\xe7\xf5es)"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"pnpm show-overdue-notifications\n"})}),"\n",(0,r.jsx)(s.h2,{id:"run-overdue-check-at-a-specific-datetime-to-debug-notification-system",children:"Executar verifica\xe7\xe3o de atrasado em uma data/hora espec\xedfica (para depurar o sistema de notifica\xe7\xe3o)"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:'pnpm run-overdue-check "YYYY-MM-DD HH:MM:SS"\n'})}),"\n",(0,r.jsx)(s.h2,{id:"test-cron-service-port-connectivity",children:"Testar conectividade da porta do servi\xe7o cron"}),"\n",(0,r.jsx)(s.p,{children:"Para testar a conectividade do servi\xe7o cron, voc\xea pode:"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"Verificar se o servi\xe7o cron est\xe1 em execu\xe7\xe3o:"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"curl http://localhost:8667/health\n"})}),"\n",(0,r.jsxs)(s.ol,{start:"2",children:["\n",(0,r.jsx)(s.li,{children:"Ou use os endpoints da API do servi\xe7o cron diretamente atrav\xe9s da aplica\xe7\xe3o principal:"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"curl http://localhost:8666/api/cron/health\n"})}),"\n",(0,r.jsxs)(s.ol,{start:"3",children:["\n",(0,r.jsx)(s.li,{children:"Use o script de teste para verificar a conectividade da porta:"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"pnpm test-cron-port\n"})}),"\n",(0,r.jsx)(s.p,{children:"Este script testa a conectividade com a porta do servi\xe7o cron e fornece informa\xe7\xf5es detalhadas sobre o status da conex\xe3o."}),"\n",(0,r.jsx)(s.h2,{id:"test-overdue-detection",children:"Testar detec\xe7\xe3o de atrasado"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"pnpm test-overdue-detection\n"})}),"\n",(0,r.jsx)(s.p,{children:"Este script testa a l\xf3gica de detec\xe7\xe3o de backup atrasado. Ele verifica:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Identifica\xe7\xe3o de backup atrasado"}),"\n",(0,r.jsx)(s.li,{children:"Acionamento de notifica\xe7\xf5es"}),"\n",(0,r.jsx)(s.li,{children:"C\xe1lculos de data/hora para status de atraso"}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"\xdatil para depura\xe7\xe3o de sistemas de detec\xe7\xe3o e notifica\xe7\xe3o de backup atrasado."}),"\n",(0,r.jsx)(s.h2,{id:"validate-csv-export",children:"Validar exporta\xe7\xe3o CSV"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"pnpm validate-csv-export\n"})}),"\n",(0,r.jsx)(s.p,{children:"Este script valida a funcionalidade de exporta\xe7\xe3o CSV. Ele:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Testa a gera\xe7\xe3o de exporta\xe7\xe3o CSV"}),"\n",(0,r.jsx)(s.li,{children:"Verifica o formato e a estrutura dos dados"}),"\n",(0,r.jsx)(s.li,{children:"Verifica a integridade dos dados nos arquivos exportados"}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"\xdatil para garantir que as exporta\xe7\xf5es de CSV funcionem corretamente antes dos lan\xe7amentos."}),"\n",(0,r.jsx)(s.h2,{id:"temporarily-block-ntfy-server-for-testing",children:"Bloquear temporariamente o servidor NTFY (para testes)"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"sudo ./scripts/temporary_ntfy.sh_block.sh\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Este script bloqueia temporariamente o acesso de rede de sa\xedda para o Servidor NTFY (",(0,r.jsx)(s.code,{children:"ntfy.sh"}),") para testar o mecanismo de tentar novamente de notifica\xe7\xf5es. Ele:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Resolve o Endere\xe7o IP do Servidor NTFY"}),"\n",(0,r.jsx)(s.li,{children:"Adiciona uma regra de iptables para bloquear o tr\xe1fego de sa\xedda"}),"\n",(0,r.jsx)(s.li,{children:"Bloqueia por 10 segundos (configur\xe1vel)"}),"\n",(0,r.jsx)(s.li,{children:"Remove automaticamente a regra de bloqueio ao sair"}),"\n",(0,r.jsx)(s.li,{children:"Requer privil\xe9gios de root (sudo)"}),"\n"]}),"\n",(0,r.jsxs)(s.div,{className:"markdown-alert markdown-alert-caution",children:["\n",(0,r.jsxs)(s.p,{className:"markdown-alert-title",children:[(0,r.jsx)(s.span,{className:"octicon octicon-caution",style:{"--oct-icon":"url(\"data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' class='octicon octicon-stop mr-2' viewBox='0 0 16 16' version='1.1' width='16' height='16' aria-hidden='true'%3E%3Cpath d='M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z'%3E%3C/path%3E%3C/svg%3E\")"}}),"Caution"]}),"\n",(0,r.jsx)(s.p,{children:"Este script modifica regras de iptables e requer privil\xe9gios de root. Use apenas para testar mecanismos de tentar novamente de notifica\xe7\xf5es."}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"database-migration-testing",children:"Testes de Migra\xe7\xe3o de Banco de Dados"}),"\n",(0,r.jsx)(s.p,{children:"O projeto inclui scripts para testar migra\xe7\xf5es de banco de dados de vers\xf5es antigas para a vers\xe3o atual. Esses scripts garantem que as migra\xe7\xf5es de banco de dados funcionem corretamente e preservem a integridade dos dados."}),"\n",(0,r.jsx)(s.h3,{id:"generate-migration-test-data",children:"Gerar Dados de Teste de Migra\xe7\xe3o"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"./scripts/generate-migration-test-data.sh\n"})}),"\n",(0,r.jsx)(s.p,{children:"Este script gera bancos de dados de teste para m\xfaltiplas vers\xf5es hist\xf3ricas da aplica\xe7\xe3o. Ele:"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Para e remove"})," qualquer container Docker existente"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Para cada vers\xe3o"})," (v0.4.0, v0.5.0, v0.6.1, 0.7.27, 0.8.21):","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Remove arquivos de banco de dados existentes"}),"\n",(0,r.jsx)(s.li,{children:"Cria um arquivo de tag de vers\xe3o"}),"\n",(0,r.jsx)(s.li,{children:"Inicia um container Docker com a vers\xe3o espec\xedfica"}),"\n",(0,r.jsx)(s.li,{children:"Aguarda o container estar pronto"}),"\n",(0,r.jsxs)(s.li,{children:["Gera dados de teste usando ",(0,r.jsx)(s.code,{children:"pnpm generate-test-data"})]}),"\n",(0,r.jsx)(s.li,{children:"Tira uma captura de tela da UI com dados de teste"}),"\n",(0,r.jsx)(s.li,{children:"Para e remove o container"}),"\n",(0,r.jsx)(s.li,{children:"Libera arquivos WAL e salva o esquema do banco de dados"}),"\n",(0,r.jsxs)(s.li,{children:["Copia o arquivo de banco de dados para ",(0,r.jsx)(s.code,{children:"scripts/migration_test_data/"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Requisitos:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Docker deve estar instalado e configurado"}),"\n",(0,r.jsx)(s.li,{children:"Google Chrome (via Puppeteer) deve estar instalado"}),"\n",(0,r.jsx)(s.li,{children:"Acesso root/sudo para opera\xe7\xf5es do Docker"}),"\n",(0,r.jsxs)(s.li,{children:["O volume do Docker ",(0,r.jsx)(s.code,{children:"duplistatus_data"})," deve existir"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Sa\xedda:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Arquivos de banco de dados: ",(0,r.jsx)(s.code,{children:"scripts/migration_test_data/backups_<VERSION>.db"})]}),"\n",(0,r.jsxs)(s.li,{children:["Arquivos de esquema: ",(0,r.jsx)(s.code,{children:"scripts/migration_test_data/backups_<VERSION>.schema"})]}),"\n",(0,r.jsxs)(s.li,{children:["Capturas de tela: ",(0,r.jsx)(s.code,{children:"scripts/migration_test_data/duplistatus_test_data_<VERSION>.png"})]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Configura\xe7\xe3o:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["N\xfamero de servidores: Definido via vari\xe1vel ",(0,r.jsx)(s.code,{children:"SERVERS"})," (padr\xe3o: 3)"]}),"\n",(0,r.jsxs)(s.li,{children:["Diret\xf3rio de dados: ",(0,r.jsx)(s.code,{children:"/var/lib/docker/volumes/duplistatus_data/_data"})]}),"\n",(0,r.jsx)(s.li,{children:"Porta: 9666 (porta do cont\xeainer Docker)"}),"\n"]}),"\n",(0,r.jsxs)(s.div,{className:"markdown-alert markdown-alert-caution",children:["\n",(0,r.jsxs)(s.p,{className:"markdown-alert-title",children:[(0,r.jsx)(s.span,{className:"octicon octicon-caution",style:{"--oct-icon":"url(\"data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' class='octicon octicon-stop mr-2' viewBox='0 0 16 16' version='1.1' width='16' height='16' aria-hidden='true'%3E%3Cpath d='M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z'%3E%3C/path%3E%3C/svg%3E\")"}}),"Caution"]}),"\n",(0,r.jsxs)(s.p,{children:["Este script requer Docker e ir\xe1 parar/remover cont\xeaineres existentes. Tamb\xe9m requer acesso sudo para opera\xe7\xf5es do Docker e acesso ao sistema de arquivos. \xc9 necess\xe1rio executar o script ",(0,r.jsx)(s.code,{children:"pnpm take-screenshots"})," primeiro para instalar o Google Chrome, caso ainda n\xe3o tenha feito."]}),"\n"]}),"\n",(0,r.jsxs)(s.div,{className:"markdown-alert markdown-alert-important",children:["\n",(0,r.jsxs)(s.p,{className:"markdown-alert-title",children:[(0,r.jsx)(s.span,{className:"octicon octicon-important",style:{"--oct-icon":"url(\"data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' class='octicon octicon-report mr-2' viewBox='0 0 16 16' version='1.1' width='16' height='16' aria-hidden='true'%3E%3Cpath d='M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z'%3E%3C/path%3E%3C/svg%3E\")"}}),"Important"]}),"\n",(0,r.jsxs)(s.p,{children:["Este script deveria ser executado apenas uma vez. Nas novas vers\xf5es, o desenvolvedor pode copiar o arquivo de banco de dados e as capturas de tela diretamente para o diret\xf3rio ",(0,r.jsx)(s.code,{children:"scripts/migration_test_data/"}),". Durante o desenvolvimento, basta executar o script ",(0,r.jsx)(s.code,{children:"./scripts/test-migrations.sh"})," para testar as migra\xe7\xf5es."]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"test-database-migrations",children:"Migra\xe7\xf5es de Banco de Dados de Teste"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"./scripts/test-migrations.sh\n"})}),"\n",(0,r.jsx)(s.p,{children:"Este script testa migra\xe7\xf5es de banco de dados de vers\xf5es antigas para a vers\xe3o atual (4.0). Ele:"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Para cada vers\xe3o"})," (v0.4.0, v0.5.0, v0.6.1, 0.7.27, 0.8.21):","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Cria uma c\xf3pia tempor\xe1ria de banco de dados de teste"}),"\n",(0,r.jsxs)(s.li,{children:["Executa o processo de migra\xe7\xe3o usando ",(0,r.jsx)(s.code,{children:"test-migration.ts"})]}),"\n",(0,r.jsx)(s.li,{children:"Valida a estrutura do banco de dados migrado"}),"\n",(0,r.jsx)(s.li,{children:"Verifica tabelas e colunas obrigat\xf3rias"}),"\n",(0,r.jsx)(s.li,{children:"Verifica se a vers\xe3o do banco de dados \xe9 4.0"}),"\n",(0,r.jsx)(s.li,{children:"Limpa arquivos tempor\xe1rios"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Requisitos:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Os bancos de dados de teste devem existir em ",(0,r.jsx)(s.code,{children:"scripts/migration_test_data/"})]}),"\n",(0,r.jsxs)(s.li,{children:["Gerados executando ",(0,r.jsx)(s.code,{children:"generate-migration-test-data.sh"})," primeiro"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Sa\xedda:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Resultados de testes com c\xf3digo de cores (verde para aprovado, vermelho para falha)"}),"\n",(0,r.jsx)(s.li,{children:"Resumo de vers\xf5es aprovadas e com falha"}),"\n",(0,r.jsx)(s.li,{children:"Mensagens de erro detalhadas para migra\xe7\xf5es com falha"}),"\n",(0,r.jsx)(s.li,{children:"C\xf3digo de sa\xedda 0 se todos os testes forem aprovados, 1 se algum falhar"}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"O que valida:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"A vers\xe3o do banco de dados \xe9 4.0 ap\xf3s a migra\xe7\xe3o"}),"\n",(0,r.jsxs)(s.li,{children:["Todas as tabelas obrigat\xf3rias existem: ",(0,r.jsx)(s.code,{children:"servers"}),", ",(0,r.jsx)(s.code,{children:"backups"}),", ",(0,r.jsx)(s.code,{children:"configurations"}),", ",(0,r.jsx)(s.code,{children:"users"}),", ",(0,r.jsx)(s.code,{children:"sessions"}),", ",(0,r.jsx)(s.code,{children:"audit_log"}),", ",(0,r.jsx)(s.code,{children:"db_version"})]}),"\n",(0,r.jsx)(s.li,{children:"As colunas obrigat\xf3rias existem em cada tabela"}),"\n",(0,r.jsx)(s.li,{children:"A estrutura do banco de dados est\xe1 correta"}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Sa\xedda de exemplo:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"==========================================\nDatabase Migration Test Suite\n==========================================\n\nTesting migrations from old versions to version 4.0\nTest data directory: /path/to/migration_test_data\nTemporary directory: /path/to/migration_test_data/.tmp\n\n----------------------------------------\nTesting version: v0.4.0\n----------------------------------------\n  Copying database file to temporary location...\n  Running migration test...\n\u2705 Version v0.4.0: Migration test PASSED\n\n==========================================\nTest Summary\n==========================================\n\n\u2705 Passed versions (5):\n  \u2713 v0.4.0\n  \u2713 v0.5.0\n  \u2713 v0.6.1\n  \u2713 0.7.27\n  \u2713 0.8.21\n\nAll migration tests passed!\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Uso:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"# Run all migration tests\n./scripts/test-migrations.sh\n\n# Check exit code\necho $?  # 0 = all passed, 1 = some failed\n"})}),"\n",(0,r.jsxs)(s.div,{className:"markdown-alert markdown-alert-note",children:["\n",(0,r.jsxs)(s.p,{className:"markdown-alert-title",children:[(0,r.jsx)(s.span,{className:"octicon octicon-note",style:{"--oct-icon":"url(\"data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' class='octicon octicon-info mr-2' viewBox='0 0 16 16' version='1.1' width='16' height='16' aria-hidden='true'%3E%3Cpath d='M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z'%3E%3C/path%3E%3C/svg%3E\")"}}),"Note"]}),"\n",(0,r.jsxs)(s.p,{children:["Este script usa internamente o script de teste de migra\xe7\xe3o TypeScript (",(0,r.jsx)(s.code,{children:"test-migration.ts"}),"). O script de teste valida a estrutura do banco de dados ap\xf3s a migra\xe7\xe3o e garante a integridade dos dados."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"set-smtp-test-configuration",children:"Configurar Teste de SMTP"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"pnpm set-smtp-test-config <connectionType>\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Este script define a configura\xe7\xe3o de teste SMTP a partir de vari\xe1veis de ambiente. Ele aceita um par\xe2metro ",(0,r.jsx)(s.code,{children:"connectionType"})," (",(0,r.jsx)(s.code,{children:"plain"}),", ",(0,r.jsx)(s.code,{children:"starttls"})," ou ",(0,r.jsx)(s.code,{children:"ssl"}),") e l\xea vari\xe1veis de ambiente correspondentes com prefixos (",(0,r.jsx)(s.code,{children:"PLAIN_"}),", ",(0,r.jsx)(s.code,{children:"STARTTLS_"}),", ",(0,r.jsx)(s.code,{children:"SSL_"}),") para atualizar a configura\xe7\xe3o SMTP no banco de dados."]}),"\n",(0,r.jsxs)(s.p,{children:["Para conex\xf5es simples, o script l\xea a vari\xe1vel de ambiente ",(0,r.jsx)(s.code,{children:"PLAIN_SMTP_FROM"})," para definir o Endere\xe7o do remetente obrigat\xf3rio. Isso facilita o teste de diferentes tipos de conex\xe3o SMTP sem atualiza\xe7\xf5es manuais do banco de dados."]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Uso:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"# Set Plain SMTP configuration\nPLAIN_SMTP_HOST=smtp.example.com \\\nPLAIN_SMTP_PORT=25 \\\nPLAIN_SMTP_FROM=noreply@example.com \\\npnpm set-smtp-test-config plain\n\n# Set STARTTLS configuration\nSTARTTLS_SMTP_HOST=smtp.example.com \\\nSTARTTLS_SMTP_PORT=587 \\\nSTARTTLS_SMTP_USERNAME=user@example.com \\\nSTARTTLS_SMTP_PASSWORD=password \\\npnpm set-smtp-test-config starttls\n\n# Set Direct SSL/TLS configuration\nSSL_SMTP_HOST=smtp.example.com \\\nSSL_SMTP_PORT=465 \\\nSSL_SMTP_USERNAME=user@example.com \\\nSSL_SMTP_PASSWORD=password \\\npnpm set-smtp-test-config ssl\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Requisitos:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"A aplica\xe7\xe3o deve estar em execu\xe7\xe3o"}),"\n",(0,r.jsx)(s.li,{children:"As vari\xe1veis de ambiente devem ser definidas com o prefixo apropriado para o tipo de conex\xe3o"}),"\n",(0,r.jsxs)(s.li,{children:["Para conex\xf5es simples, ",(0,r.jsx)(s.code,{children:"PLAIN_SMTP_FROM"})," \xe9 obrigat\xf3rio"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"test-smtp-connection-type-cross-compatibility",children:"Testar Tipo de conex\xe3o SMTP Cross-Compatibility"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"pnpm test-smtp-connections\n"})}),"\n",(0,r.jsx)(s.p,{children:"Este script realiza um teste abrangente de matriz 3x3 que valida se as configura\xe7\xf5es destinadas a um tipo de conex\xe3o funcionam corretamente com diferentes tipos de conex\xe3o. Para cada tipo de configura\xe7\xe3o base (plain, starttls, ssl), o script:"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["L\xea vari\xe1veis de ambiente com prefixos correspondentes (",(0,r.jsx)(s.code,{children:"PLAIN_*"}),", ",(0,r.jsx)(s.code,{children:"STARTTLS_*"}),", ",(0,r.jsx)(s.code,{children:"SSL_*"}),")"]}),"\n",(0,r.jsxs)(s.li,{children:["Testa todos os tr\xeas tipos de conex\xe3o modificando apenas o campo ",(0,r.jsx)(s.code,{children:"connectionType"})]}),"\n",(0,r.jsx)(s.li,{children:"Envia emails de teste via API"}),"\n",(0,r.jsx)(s.li,{children:"Registra resultados em formato de matriz"}),"\n",(0,r.jsx)(s.li,{children:"Exibe uma tabela de resumo"}),"\n",(0,r.jsxs)(s.li,{children:["Salva resultados detalhados em ",(0,r.jsx)(s.code,{children:"smtp-test-results.json"})]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Uso:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"# Set environment variables for all three connection types\nPLAIN_SMTP_HOST=smtp.example.com \\\nPLAIN_SMTP_PORT=25 \\\nPLAIN_SMTP_FROM=noreply@example.com \\\nSTARTTLS_SMTP_HOST=smtp.example.com \\\nSTARTTLS_SMTP_PORT=587 \\\nSTARTTLS_SMTP_USERNAME=user@example.com \\\nSTARTTLS_SMTP_PASSWORD=password \\\nSSL_SMTP_HOST=smtp.example.com \\\nSSL_SMTP_PORT=465 \\\nSSL_SMTP_USERNAME=user@example.com \\\nSSL_SMTP_PASSWORD=password \\\npnpm test-smtp-connections\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Requisitos:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"A aplica\xe7\xe3o deve estar em execu\xe7\xe3o"}),"\n",(0,r.jsx)(s.li,{children:"Vari\xe1veis de ambiente devem ser definidas para todos os tr\xeas tipos de conex\xe3o"}),"\n",(0,r.jsx)(s.li,{children:"O script valida a configura\xe7\xe3o sendo usada atrav\xe9s de registros detalhados"}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Comportamento Esperado:"}),"\nAs configura\xe7\xf5es devem funcionar apenas com seu tipo de conex\xe3o pretendido (por exemplo, configura\xe7\xe3o simples funciona com connectionType simples, mas falha com STARTTLS/ssl)."]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Sa\xedda:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Sa\xedda do console com uma tabela de resumo mostrando resultados dos testes"}),"\n",(0,r.jsxs)(s.li,{children:["Arquivo ",(0,r.jsx)(s.code,{children:"smtp-test-results.json"})," com resultados detalhados dos testes para cada combina\xe7\xe3o de configura\xe7\xe3o e tipo de conex\xe3o"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"test-docker-entrypoint-script",children:"Testar Script de Entrypoint Docker"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"pnpm test-entrypoint\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Este script fornece um wrapper de teste para ",(0,r.jsx)(s.code,{children:"docker-entrypoint.sh"})," no desenvolvimento local. Ele configura o ambiente para testar a funcionalidade de logging do entrypoint e garante que os logs sejam gravados em ",(0,r.jsx)(s.code,{children:"data/logs/"})," para que a aplica\xe7\xe3o possa acess\xe1-los."]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"O que faz:"})}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Sempre constr\xf3i uma vers\xe3o atualizada"}),": Executa automaticamente ",(0,r.jsx)(s.code,{children:"pnpm build-local"})," para criar uma compila\xe7\xe3o atualizada antes dos testes (sem necessidade de compilar manualmente primeiro)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Constr\xf3i o servi\xe7o cron"}),": Garante que o servi\xe7o cron seja compilado (",(0,r.jsx)(s.code,{children:"dist/cron-service.cjs"}),")"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Configura estrutura semelhante ao Docker"}),": Cria symlinks e estrutura de diret\xf3rios necess\xe1rios para simular o ambiente Docker"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Executa script de ponto de entrada"}),": Executa ",(0,r.jsx)(s.code,{children:"docker-entrypoint.sh"})," com vari\xe1veis de ambiente apropriadas"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Limpa"}),": Remove automaticamente arquivos tempor\xe1rios ao sair"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Uso:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"# Run the test (builds fresh version automatically)\npnpm test-entrypoint\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Vari\xe1veis de Ambiente:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"PORT=8666"})," - Porta para o servidor Next.js (corresponde a ",(0,r.jsx)(s.code,{children:"start-local"}),")"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"CRON_PORT=8667"})," - Porta para o servi\xe7o cron"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"VERSION"})," - Definida automaticamente no formato ",(0,r.jsx)(s.code,{children:"test-YYYYMMDD-HHMMSS"})]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Sa\xedda:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Os logs s\xe3o escritos em ",(0,r.jsx)(s.code,{children:"data/logs/application.log"})," (acess\xedvel pela aplica\xe7\xe3o)"]}),"\n",(0,r.jsx)(s.li,{children:"A sa\xedda do console mostra a execu\xe7\xe3o do script de ponto de entrada"}),"\n",(0,r.jsx)(s.li,{children:"Pressione Ctrl+C para parar e testar o despejo de logs"}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Requisitos:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"O script deve ser executado a partir do diret\xf3rio raiz do reposit\xf3rio (pnpm faz isso automaticamente)"}),"\n",(0,r.jsx)(s.li,{children:"O script trata automaticamente todos os pr\xe9-requisitos (build, servi\xe7o cron, etc.)"}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Casos de Uso:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Testar altera\xe7\xf5es de script de entrypoint localmente antes da implanta\xe7\xe3o Docker"}),"\n",(0,r.jsx)(s.li,{children:"Verificar rota\xe7\xe3o de logs e funcionalidade de logging"}),"\n",(0,r.jsx)(s.li,{children:"Testar encerramento gracioso e tratamento de sinais"}),"\n",(0,r.jsx)(s.li,{children:"Depurar o comportamento do script de entrypoint em um ambiente local"}),"\n"]})]})}function p(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},73230(e,s,a){a.d(s,{R:()=>t,x:()=>o});var n=a(71299);const r={},i=n.createContext(r);function t(e){const s=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),n.createElement(i.Provider,{value:s},e.children)}}}]);